var Comarch;
(function (Comarch) {
    var Utils;
    (function (Utils) {
        var TreeUtils;
        (function (TreeUtils) {
            class TreeTraversalIteratorFactoryBase {
            }
            TreeUtils.TreeTraversalIteratorFactoryBase = TreeTraversalIteratorFactoryBase;
            class ForwardTreeTraversalIteratorFactory extends TreeTraversalIteratorFactoryBase {
                Create(list) { return new FrowardTreeTraversalIterator(list); }
            }
            TreeUtils.ForwardTreeTraversalIteratorFactory = ForwardTreeTraversalIteratorFactory;
            class BackwardTreeTraversalIteratorFactory extends TreeTraversalIteratorFactoryBase {
                Create(list) { return new BackwardTreeTraversalIterator(list); }
            }
            TreeUtils.BackwardTreeTraversalIteratorFactory = BackwardTreeTraversalIteratorFactory;
            class TreeTraversalIteratorBase {
                constructor(list) {
                    this._list = list;
                }
                get Current() { return this._list[this._currentIndex]; }
                get CurrentIndex() { return this._currentIndex; }
            }
            TreeUtils.TreeTraversalIteratorBase = TreeTraversalIteratorBase;
            class FrowardTreeTraversalIterator extends TreeTraversalIteratorBase {
                constructor(list) {
                    super(list);
                    this._currentIndex = -1;
                }
                MoveNext() {
                    this._currentIndex++;
                    return this._currentIndex < this._list.length;
                }
            }
            TreeUtils.FrowardTreeTraversalIterator = FrowardTreeTraversalIterator;
            class BackwardTreeTraversalIterator extends TreeTraversalIteratorBase {
                constructor(list) {
                    super(list);
                    this._currentIndex = list.length;
                }
                MoveNext() {
                    this._currentIndex--;
                    return this._currentIndex >= 0;
                }
            }
            TreeUtils.BackwardTreeTraversalIterator = BackwardTreeTraversalIterator;
            class TreeHelpers {
                static TraverseListPreorder(list, childrenSelector, operation, iteratorFactory = new BackwardTreeTraversalIteratorFactory(), trackPath = false) {
                    var iterator = iteratorFactory.Create(list);
                    while (iterator.MoveNext()) {
                        TreeHelpers.TraversePreorder(iterator.Current, childrenSelector, operation, iteratorFactory, null, 0, iterator.CurrentIndex, trackPath, []);
                    }
                }
                static TraversePreorder(currentItem, childrenSelector, operation, iteratorFactory = new BackwardTreeTraversalIteratorFactory(), parent = null, level = 0, index = 0, trackPath = false, path = []) {
                    const canContinue = operation(currentItem, parent, level, index, path);
                    if (!canContinue)
                        return false;
                    if (trackPath) {
                        path.push(currentItem);
                    }
                    const children = childrenSelector(currentItem);
                    if (children) {
                        var iterator = iteratorFactory.Create(children);
                        while (iterator.MoveNext()) {
                            var nextLevel = level + 1;
                            TreeHelpers.TraversePreorder(iterator.Current, childrenSelector, operation, iteratorFactory, currentItem, nextLevel, iterator.CurrentIndex, trackPath, path.slice(0));
                        }
                    }
                    return true;
                }
                static TraverseListPostOrder(list, childrenSelector, operation, iteratorFactory = new BackwardTreeTraversalIteratorFactory(), canContinueProcessing = () => true) {
                    var iterator = iteratorFactory.Create(list);
                    while (iterator.MoveNext()) {
                        TreeHelpers.TraversePostOrder(iterator.Current, childrenSelector, operation, iteratorFactory, canContinueProcessing, null, 0, iterator.CurrentIndex);
                    }
                }
                static TraversePostOrder(currentItem, childrenSelector, operation, iteratorFactory = new BackwardTreeTraversalIteratorFactory(), canContinueProcessing = () => true, parent = null, level = 0, index = 0) {
                    const canContinue = canContinueProcessing(currentItem, parent, level, index);
                    if (!canContinue)
                        return false;
                    const children = childrenSelector(currentItem);
                    if (children) {
                        var iterator = iteratorFactory.Create(children);
                        while (iterator.MoveNext()) {
                            var nextLevel = level + 1;
                            TreeHelpers
                                .TraversePostOrder(iterator.Current, childrenSelector, operation, iteratorFactory, canContinueProcessing, currentItem, nextLevel, iterator.CurrentIndex);
                        }
                    }
                    operation(currentItem, parent, level, index);
                    return true;
                }
                static Convert(currentItem, childrenSelector, resultChildrenSelector, convertOperation, addChildrenOperation = null, parent = null, convertedParent = null, level = 0, index = 0) {
                    const convertedCurrentItem = convertOperation(currentItem, parent, convertedParent, level, index);
                    if (!convertedCurrentItem)
                        return null;
                    const children = childrenSelector(currentItem);
                    if (children) {
                        for (let i = 0; i < children.length; i++) {
                            const chi = children[i];
                            const nextLevel = level + 1;
                            const childConverted = TreeHelpers
                                .Convert(chi, childrenSelector, resultChildrenSelector, convertOperation, addChildrenOperation, currentItem, convertedCurrentItem, nextLevel, i);
                            if (childConverted) {
                                if (addChildrenOperation) {
                                    addChildrenOperation(convertedCurrentItem, childConverted);
                                }
                                else {
                                    resultChildrenSelector(convertedCurrentItem).push(childConverted);
                                }
                            }
                        }
                    }
                    return convertedCurrentItem;
                }
                static ConvertListToLookup(list, childrenSelector, keySelector) {
                    var result = new collections.Dictionary();
                    list.forEach(x => {
                        this.ConvertToLookup(x, childrenSelector, keySelector, result);
                    });
                    return result;
                }
                static ConvertToLookup(root, childrenSelector, keySelector, result = new collections.Dictionary()) {
                    TreeHelpers.TraversePreorder(root, childrenSelector, (x) => {
                        result.setValue(keySelector(x), x);
                        return true;
                    });
                    return result;
                }
                static GetByPredicate(input, childrenSelector, predicate, deepCopyFunction) {
                    var result = [];
                    TreeHelpers.TraversePreorder(input, childrenSelector, (x) => {
                        if (predicate(x)) {
                            result.push(deepCopyFunction(x));
                        }
                        return true;
                    });
                    return result;
                }
                static ReconstructFromLeafs(leafsList, fullHierarchyLookup, itemUniqueNameSelector, itemParentUniqueNameSelector, childrenSelector, deepCopyFunction) {
                    var lookup = new collections.Dictionary();
                    leafsList.forEach(x => {
                        var currentItem = null;
                        var uniqueName = itemUniqueNameSelector(x);
                        currentItem = fullHierarchyLookup.getValue(uniqueName);
                        if (currentItem) {
                            currentItem = deepCopyFunction(currentItem, false);
                            lookup.setValue(uniqueName, currentItem);
                            var parentUniqueName = itemParentUniqueNameSelector(currentItem);
                            currentItem = fullHierarchyLookup.getValue(parentUniqueName);
                            while (currentItem) {
                                currentItem = deepCopyFunction(currentItem, false);
                                lookup.setValue(parentUniqueName, currentItem);
                                var parentUniqueName = itemParentUniqueNameSelector(currentItem);
                                currentItem = fullHierarchyLookup.getValue(parentUniqueName);
                            }
                        }
                    });
                    lookup.forEach((key, value) => {
                        var parent = lookup.getValue(itemParentUniqueNameSelector(value));
                        if (parent) {
                            childrenSelector(parent).push(value);
                        }
                    });
                    return lookup.getValue(TreeHelpers.HIERARCHY_ROOT_UNIQUE_NAME);
                }
                static Union(rootA, rootB, itemUniqueNameSelector, childrenSelector, parentPropertyName, deepCopyFunction) {
                    const rootUniqueName = itemUniqueNameSelector(rootA);
                    var lookup = new collections.Dictionary();
                    var lookupFillFunction = (i, parent, level, index) => {
                        if (parent) {
                            i[parentPropertyName] = itemUniqueNameSelector(parent);
                        }
                        lookup.setValue(itemUniqueNameSelector(i), deepCopyFunction(i, false));
                        return true;
                    };
                    TreeHelpers.TraversePreorder(rootA, childrenSelector, (i, parent, level, index) => {
                        return lookupFillFunction(i, parent, level, index);
                    });
                    TreeHelpers.TraversePreorder(rootB, childrenSelector, (i, parent, level, index) => {
                        return lookupFillFunction(i, parent, level, index);
                    });
                    lookup.forEach((key, value) => {
                        var parentUniqueName = value[parentPropertyName];
                        if (parentUniqueName) {
                            const parent = lookup.getValue(parentUniqueName);
                            if (parent) {
                                childrenSelector(parent).push(value);
                            }
                        }
                    });
                    return lookup.getValue(rootUniqueName);
                }
                static IntersectChildren(a, b, uniqueNameSelector) {
                    var result = [];
                    var aSet = new collections.Dictionary();
                    a.forEach(x => aSet.setValue(uniqueNameSelector(x), x));
                    var bSet = new collections.Dictionary();
                    b.forEach(x => bSet.setValue(uniqueNameSelector(x), x));
                    aSet.keys().forEach((key) => {
                        var value = bSet.getValue(key);
                        if (value) {
                            result.push(new IntersectionPair(aSet.getValue(key), value));
                        }
                    });
                    return result;
                }
                static Intersection(a, b, uniqueNameSelector, childrenSelector, childrenAppender, deepCopy) {
                    if (a == null)
                        return null;
                    if (b == null)
                        return null;
                    if (uniqueNameSelector(a) !== uniqueNameSelector(b))
                        return null;
                    if (childrenSelector(a).length === 0)
                        return deepCopy(b, true);
                    if (childrenSelector(b).length === 0)
                        return deepCopy(a, true);
                    const pairs = TreeHelpers.IntersectChildren(childrenSelector(a), childrenSelector(b), uniqueNameSelector);
                    if (pairs.length === 0)
                        return null;
                    var children = [];
                    pairs.forEach((pair) => {
                        var child = TreeHelpers.Intersection(pair.A, pair.B, uniqueNameSelector, childrenSelector, childrenAppender, deepCopy);
                        if (child != null) {
                            children.push(child);
                        }
                    });
                    if (children.length === 0)
                        return null;
                    var result = deepCopy(a, false);
                    children.forEach(child => { childrenAppender(result, child); });
                    return result;
                }
                static Flatten(root, childrenSelector, includePredicate = (x) => { return true; }) {
                    return TreeHelpers.FlattenInternal([], childrenSelector(root), childrenSelector, includePredicate);
                }
                static FlattenArray(rootList, childrenSelector, includePredicate = (x) => { return true; }) {
                    return TreeHelpers.FlattenInternal([], rootList, childrenSelector, includePredicate);
                }
                static FlattenInternal(result, list, childrenSelector, includePredicate = (x) => { return true; }) {
                    var stack = new collections.Stack();
                    list.forEach(i => { stack.push(i); });
                    while (!stack.isEmpty()) {
                        const current = stack.pop();
                        if (includePredicate(current))
                            result.push(current);
                        const children = childrenSelector(current);
                        if (children) {
                            children.forEach(i => { stack.push(i); });
                        }
                    }
                    return result;
                }
                static TraverseListBFS(list, childrenSelector, operation, trackVisited = false) {
                    TreeHelpers.TraverseBFS(null, childrenSelector, operation, list.slice());
                }
                static TraverseBFS(currentItem, childrenSelector, operation, queue) {
                    var iterationIndex = 0;
                    if (currentItem)
                        queue.push(currentItem);
                    var canContinue = true;
                    while (queue.length > 0 && canContinue) {
                        var current = queue.shift();
                        childrenSelector(current).forEach(c => queue.push(c));
                        canContinue = operation(current, iterationIndex);
                        iterationIndex++;
                    }
                }
            }
            TreeHelpers.HIERARCHY_ROOT_UNIQUE_NAME = "HierarchyRoot_297473E5-182B-43E5-BBD0-C7A994992778";
            TreeUtils.TreeHelpers = TreeHelpers;
            class IntersectionPair {
                constructor(A, B) {
                    this.A = A;
                    this.B = B;
                }
            }
            TreeUtils.IntersectionPair = IntersectionPair;
        })(TreeUtils = Utils.TreeUtils || (Utils.TreeUtils = {}));
    })(Utils = Comarch.Utils || (Comarch.Utils = {}));
})(Comarch || (Comarch = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHJlZUhlbHBlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJUcmVlSGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFPLE9BQU8sQ0F5WGI7QUF6WEQsV0FBTyxPQUFPO0lBQUMsSUFBQSxLQUFLLENBeVhuQjtJQXpYYyxXQUFBLEtBQUs7UUFBQyxJQUFBLFNBQVMsQ0F5WDdCO1FBelhvQixXQUFBLFNBQVM7WUFPMUI7YUFHQztZQUhzQiwwQ0FBZ0MsbUNBR3RELENBQUE7WUFFRCx5Q0FBb0QsU0FBUSxnQ0FBbUM7Z0JBQzNGLE1BQU0sQ0FBQyxJQUFTLElBQStCLE1BQU0sQ0FBQyxJQUFJLDRCQUE0QixDQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNyRztZQUZZLDZDQUFtQyxzQ0FFL0MsQ0FBQTtZQUNELDBDQUFxRCxTQUFRLGdDQUFtQztnQkFDNUYsTUFBTSxDQUFDLElBQVMsSUFBK0IsTUFBTSxDQUFDLElBQUksNkJBQTZCLENBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ3RHO1lBRlksOENBQW9DLHVDQUVoRCxDQUFBO1lBUUQ7Z0JBR0ksWUFBWSxJQUFjO29CQUN0QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztnQkFDdEIsQ0FBQztnQkFDRCxJQUFJLE9BQU8sS0FBUSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUEsQ0FBQyxDQUFDO2dCQUMxRCxJQUFJLFlBQVksS0FBYSxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7YUFFNUQ7WUFUcUIsbUNBQXlCLDRCQVM5QyxDQUFBO1lBRUQsa0NBQTZDLFNBQVEseUJBQTRCO2dCQUM3RSxZQUFZLElBQWM7b0JBQ3RCLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDWixJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUM1QixDQUFDO2dC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UUF5WGIiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUgQ29tYXJjaC5VdGlscy5UcmVlVXRpbHMge1xyXG4gICAgZXhwb3J0IGludGVyZmFjZSBJVHJhdmVyc2VQcmVPcmRlck9wZXJhdGlvbiB7XHJcbiAgICAgICAgT3BlcmF0aW9uOiAoaSwgcGFyZW50LCBsZXZlbCwgaW5kZXgpID0+IGJvb2xlYW47XHJcbiAgICB9XHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5PFQ+IHtcclxuICAgICAgICBDcmVhdGUobGlzdDogQXJyYXk8VD4pOiBJVHJlZVRyYXZlcnNhbEl0ZXJhdG9yPFQ+O1xyXG4gICAgfVxyXG4gICAgZXhwb3J0IGFic3RyYWN0ICBjbGFzcyBUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5QmFzZTxUPiBpbXBsZW1lbnRzIElUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5PFQ+XHJcbiAgICB7XHJcbiAgICAgICAgYWJzdHJhY3QgQ3JlYXRlKGxpc3Q6IEFycmF5PFQ+KTogSVRyZWVUcmF2ZXJzYWxJdGVyYXRvcjxUPjtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgRm9yd2FyZFRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3Rvcnk8VD4gZXh0ZW5kcyBUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5QmFzZTxUPiB7XHJcbiAgICAgICAgQ3JlYXRlKGxpc3Q6IFRbXSk6IElUcmVlVHJhdmVyc2FsSXRlcmF0b3I8VD4geyByZXR1cm4gbmV3IEZyb3dhcmRUcmVlVHJhdmVyc2FsSXRlcmF0b3I8VD4obGlzdCk7IH1cclxuICAgIH1cclxuICAgIGV4cG9ydCBjbGFzcyBCYWNrd2FyZFRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3Rvcnk8VD4gZXh0ZW5kcyBUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5QmFzZTxUPiB7XHJcbiAgICAgICAgQ3JlYXRlKGxpc3Q6IFRbXSk6IElUcmVlVHJhdmVyc2FsSXRlcmF0b3I8VD4geyByZXR1cm4gbmV3IEJhY2t3YXJkVHJlZVRyYXZlcnNhbEl0ZXJhdG9yPFQ+KGxpc3QpOyB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGludGVyZmFjZSBJVHJlZVRyYXZlcnNhbEl0ZXJhdG9yPFQ+IHtcclxuICAgICAgICBDdXJyZW50OiBUO1xyXG4gICAgICAgIEN1cnJlbnRJbmRleDogbnVtYmVyO1xyXG4gICAgICAgIE1vdmVOZXh0KCk6IGJvb2xlYW47XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGFic3RyYWN0IGNsYXNzIFRyZWVUcmF2ZXJzYWxJdGVyYXRvckJhc2U8VD4gaW1wbGVtZW50cyBJVHJlZVRyYXZlcnNhbEl0ZXJhdG9yPFQ+IHtcclxuICAgICAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgX2xpc3Q6IEFycmF5PFQ+O1xyXG4gICAgICAgIHByb3RlY3RlZCBfY3VycmVudEluZGV4OiBudW1iZXI7XHJcbiAgICAgICAgY29uc3RydWN0b3IobGlzdDogQXJyYXk8VD4pIHtcclxuICAgICAgICAgICAgdGhpcy5fbGlzdCA9IGxpc3Q7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGdldCBDdXJyZW50KCk6IFQgeyByZXR1cm4gdGhpcy5fbGlzdFt0aGlzLl9jdXJyZW50SW5kZXhdIH1cclxuICAgICAgICBnZXQgQ3VycmVudEluZGV4KCk6IG51bWJlciB7IHJldHVybiB0aGlzLl9jdXJyZW50SW5kZXg7IH1cclxuICAgICAgICBhYnN0cmFjdCBNb3ZlTmV4dCgpOiBib29sZWFuO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBGcm93YXJkVHJlZVRyYXZlcnNhbEl0ZXJhdG9yPFQ+IGV4dGVuZHMgVHJlZVRyYXZlcnNhbEl0ZXJhdG9yQmFzZTxUPiB7XHJcbiAgICAgICAgY29uc3RydWN0b3IobGlzdDogQXJyYXk8VD4pIHtcclxuICAgICAgICAgICAgc3VwZXIobGlzdCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRJbmRleCA9IC0xO1xyXG4gICAgICAgIH1cclxuICAgICAgICBNb3ZlTmV4dCgpOiBib29sZWFuIHtcclxuICAgICAgICAgICAgdGhpcy5fY3VycmVudEluZGV4Kys7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50SW5kZXggPCB0aGlzLl9saXN0Lmxlbmd0aDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEJhY2t3YXJkVHJlZVRyYXZlcnNhbEl0ZXJhdG9yPFQ+IGV4dGVuZHMgVHJlZVRyYXZlcnNhbEl0ZXJhdG9yQmFzZTxUPiB7XHJcbiAgICAgICAgY29uc3RydWN0b3IobGlzdDogQXJyYXk8VD4pIHtcclxuICAgICAgICAgICAgc3VwZXIobGlzdCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRJbmRleCA9IGxpc3QubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBNb3ZlTmV4dCgpOiBib29sZWFuIHtcclxuICAgICAgICAgICAgdGhpcy5fY3VycmVudEluZGV4LS07XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50SW5kZXggPj0gMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIFRyZWVIZWxwZXJzIHtcclxuXHJcbiAgICAgICAgc3RhdGljIEhJRVJBUkNIWV9ST09UX1VOSVFVRV9OQU1FID0gXCJIaWVyYXJjaHlSb290XzI5NzQ3M0U1LTE4MkItNDNFNS1CQkQwLUM3QTk5NDk5Mjc3OFwiO1xyXG4gICAgICAgIHN0YXRpYyBUcmF2ZXJzZUxpc3RQcmVvcmRlcjxUPihsaXN0OiBUW10sXHJcbiAgICAgICAgICAgIGNoaWxkcmVuU2VsZWN0b3I6ICh4OiBUKSA9PiBBcnJheTxUPixcclxuICAgICAgICAgICAgb3BlcmF0aW9uOiAoeDogVCwgcGFyZW50PzogVCwgbGV2ZWw/OiBudW1iZXIsIGluZGV4PzogbnVtYmVyLHBhdGg/OlRbXSkgPT4gYm9vbGVhbixcclxuICAgICAgICAgICAgaXRlcmF0b3JGYWN0b3J5OiBJVHJlZVRyYXZlcnNhbEl0ZXJhdG9yRmFjdG9yeTxUPiA9IG5ldyBCYWNrd2FyZFRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3Rvcnk8VD4oKSxcclxuICAgICAgICAgICAgdHJhY2tQYXRoID0gZmFsc2UsXHJcbiAgICAgICAgICAgICkgOiB2b2lkIHtcclxuICAgICAgICAgICAgdmFyIGl0ZXJhdG9yID0gaXRlcmF0b3JGYWN0b3J5LkNyZWF0ZShsaXN0KTtcclxuICAgICAgICAgICAgd2hpbGUgKGl0ZXJhdG9yLk1vdmVOZXh0KCkpIHtcclxuICAgICAgICAgICAgICAgIFRyZWVIZWxwZXJzLlRyYXZlcnNlUHJlb3JkZXI8VD4oaXRlcmF0b3IuQ3VycmVudCwgY2hpbGRyZW5TZWxlY3Rvciwgb3BlcmF0aW9uLCBpdGVyYXRvckZhY3RvcnksIG51bGwsIDAsIGl0ZXJhdG9yLkN1cnJlbnRJbmRleCx0cmFja1BhdGgsW10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHN0YXRpYyBUcmF2ZXJzZVByZW9yZGVyPFQ+KGN1cnJlbnRJdGVtOiBULFxyXG4gICAgICAgICAgICBjaGlsZHJlblNlbGVjdG9yOiAoeDogVCkgPT4gQXJyYXk8VD4sXHJcbiAgICAgICAgICAgIG9wZXJhdGlvbjogKHg6IFQsIHBhcmVudD86IFQsIGxldmVsPzogbnVtYmVyLCBpbmRleD86IG51bWJlcixwYXRoPzpUW10pID0+IGJvb2xlYW4sXHJcbiAgICAgICAgICAgIGl0ZXJhdG9yRmFjdG9yeTogSVRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3Rvcnk8VD4gPSBuZXcgQmFja3dhcmRUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5PFQ+KCksXHJcbiAgICAgICAgICAgIHBhcmVudDogVCA9IG51bGwsXHJcbiAgICAgICAgICAgIGxldmVsOiBudW1iZXIgPSAwLFxyXG4gICAgICAgICAgICBpbmRleDogbnVtYmVyID0gMCxcclxuICAgICAgICAgICAgdHJhY2tQYXRoID0gZmFsc2UsXHJcbiAgICAgICAgICAgIHBhdGg6VFtdPVtdXHJcbiAgICAgICAgKSA6IGJvb2xlYW4ge1xyXG4gICAgICAgICAgICBjb25zdCBjYW5Db250aW51ZSA9IG9wZXJhdGlvbihjdXJyZW50SXRlbSwgcGFyZW50LCBsZXZlbCwgaW5kZXgscGF0aCk7XHJcbiAgICAgICAgICAgIGlmICghY2FuQ29udGludWUpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHRyYWNrUGF0aCkge1xyXG4gICAgICAgICAgICAgICAgcGF0aC5wdXNoKGN1cnJlbnRJdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IGNoaWxkcmVuU2VsZWN0b3IoY3VycmVudEl0ZW0pO1xyXG4gICAgICAgICAgICBpZiAoY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVyYXRvciA9IGl0ZXJhdG9yRmFjdG9yeS5DcmVhdGUoY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGl0ZXJhdG9yLk1vdmVOZXh0KCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dExldmVsID0gbGV2ZWwgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFRyZWVIZWxwZXJzLlRyYXZlcnNlUHJlb3JkZXIoaXRlcmF0b3IuQ3VycmVudCwgY2hpbGRyZW5TZWxlY3Rvciwgb3BlcmF0aW9uLCBpdGVyYXRvckZhY3RvcnksIGN1cnJlbnRJdGVtLCBuZXh0TGV2ZWwsIGl0ZXJhdG9yLkN1cnJlbnRJbmRleCx0cmFja1BhdGgscGF0aC5zbGljZSgwKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgVHJhdmVyc2VMaXN0UG9zdE9yZGVyPFQ+KGxpc3Q6IFRbXSxcclxuICAgICAgICAgICAgY2hpbGRyZW5TZWxlY3RvcjogKHg6IFQpID0+IEFycmF5PFQ+LFxyXG4gICAgICAgICAgICBvcGVyYXRpb246ICh4OiBULCBwYXJlbnQ6IFQsIGxldmVsOiBudW1iZXIsIGluZGV4OiBudW1iZXIpID0+IHZvaWQsXHJcbiAgICAgICAgICAgIGl0ZXJhdG9yRmFjdG9yeTogSVRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3Rvcnk8VD4gPSBuZXcgQmFja3dhcmRUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5PFQ+KCksXHJcbiAgICAgICAgICAgIGNhbkNvbnRpbnVlUHJvY2Vzc2luZzogKHg6IFQsIHBhcmVudDogVCwgbGV2ZWw6IG51bWJlciwgaW5kZXg6IG51bWJlcikgPT4gYm9vbGVhbj0oKT0+dHJ1ZSxcclxuICAgICAgICAgICApOnZvaWQge1xyXG4gICAgICAgICAgICB2YXIgaXRlcmF0b3IgPSBpdGVyYXRvckZhY3RvcnkuQ3JlYXRlKGxpc3QpO1xyXG4gICAgICAgICAgICB3aGlsZSAoaXRlcmF0b3IuTW92ZU5leHQoKSkge1xyXG4gICAgICAgICAgICAgICAgVHJlZUhlbHBlcnMuVHJhdmVyc2VQb3N0T3JkZXI8VD4oaXRlcmF0b3IuQ3VycmVudCwgY2hpbGRyZW5TZWxlY3Rvciwgb3BlcmF0aW9uLCBpdGVyYXRvckZhY3RvcnksIGNhbkNvbnRpbnVlUHJvY2Vzc2luZyxudWxsLDAsaXRlcmF0b3IuQ3VycmVudEluZGV4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIFRyYXZlcnNlUG9zdE9yZGVyPFQ+KGN1cnJlbnRJdGVtOiBULFxyXG4gICAgICAgICAgICBjaGlsZHJlblNlbGVjdG9yOiAoeDogVCkgPT4gQXJyYXk8VD4sXHJcbiAgICAgICAgICAgIG9wZXJhdGlvbjogKHg6IFQsIHBhcmVudDogVCwgbGV2ZWw6IG51bWJlciwgaW5kZXg6IG51bWJlcikgPT4gdm9pZCxcclxuICAgICAgICAgICAgaXRlcmF0b3JGYWN0b3J5OiBJVHJlZVRyYXZlcnNhbEl0ZXJhdG9yRmFjdG9yeTxUPiA9IG5ldyBCYWNrd2FyZFRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3Rvcnk8VD4oKSxcclxuICAgICAgICAgICAgY2FuQ29udGludWVQcm9jZXNzaW5nOiAoeDogVCwgcGFyZW50OiBULCBsZXZlbDogbnVtYmVyLCBpbmRleDogbnVtYmVyKSA9PiBib29sZWFuID0gKCkgPT4gdHJ1ZSAsXHJcbiAgICAgICAgICAgIHBhcmVudDogVCA9IG51bGwsXHJcbiAgICAgICAgICAgIGxldmVsOiBudW1iZXIgPSAwLFxyXG4gICAgICAgICAgICBpbmRleDogbnVtYmVyID0gMCxcclxuICAgICAgICAgICAgKTpib29sZWFuIHtcclxuICAgICAgICAgICAgY29uc3QgY2FuQ29udGludWUgPSBjYW5Db250aW51ZVByb2Nlc3NpbmcoY3VycmVudEl0ZW0sIHBhcmVudCwgbGV2ZWwsIGluZGV4KTtcclxuICAgICAgICAgICAgaWYgKCFjYW5Db250aW51ZSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IGNoaWxkcmVuU2VsZWN0b3IoY3VycmVudEl0ZW0pO1xyXG4gICAgICAgICAgICBpZiAoY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVyYXRvciA9IGl0ZXJhdG9yRmFjdG9yeS5DcmVhdGUoY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGl0ZXJhdG9yLk1vdmVOZXh0KCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dExldmVsID0gbGV2ZWwgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFRyZWVIZWxwZXJzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5UcmF2ZXJzZVBvc3RPcmRlcihpdGVyYXRvci5DdXJyZW50LCBjaGlsZHJlblNlbGVjdG9yLCBvcGVyYXRpb24sIGl0ZXJhdG9yRmFjdG9yeSwgY2FuQ29udGludWVQcm9jZXNzaW5nLCBjdXJyZW50SXRlbSwgbmV4dExldmVsLCBpdGVyYXRvci5DdXJyZW50SW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wZXJhdGlvbihjdXJyZW50SXRlbSwgcGFyZW50LCBsZXZlbCwgaW5kZXgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBDb252ZXJ0PFQsIFRSZXN1bHQ+KFxyXG4gICAgICAgICAgICBjdXJyZW50SXRlbTogVCxcclxuICAgICAgICAgICAgY2hpbGRyZW5TZWxlY3RvcjogKHg6IFQpID0+IEFycmF5PFQ+LFxyXG4gICAgICAgICAgICByZXN1bHRDaGlsZHJlblNlbGVjdG9yOiAoeDogVFJlc3VsdCkgPT4gQXJyYXk8VFJlc3VsdD4sXHJcbiAgICAgICAgICAgIGNvbnZlcnRPcGVyYXRpb246ICh4OiBULCBwYXJlbnQ6IFQsIGNvbnZlcnRlZFBhcmVudDogVFJlc3VsdCwgbGV2ZWw6IG51bWJlciwgaW5kZXg6IG51bWJlcikgPT4gVFJlc3VsdCxcclxuICAgICAgICAgICAgYWRkQ2hpbGRyZW5PcGVyYXRpb246IChwYXJlbnQ6VFJlc3VsdCxjaGlsZDogVFJlc3VsdCkgPT4gdm9pZD1udWxsLFxyXG4gICAgICAgICAgICBwYXJlbnQ6IFQgPSBudWxsLFxyXG4gICAgICAgICAgICBjb252ZXJ0ZWRQYXJlbnQ6IFRSZXN1bHQgPSBudWxsLFxyXG4gICAgICAgICAgICBsZXZlbDogbnVtYmVyID0gMCxcclxuICAgICAgICAgICAgaW5kZXg6IG51bWJlciA9IDApOiBUUmVzdWx0IHtcclxuICAgICAgICAgICAgY29uc3QgY29udmVydGVkQ3VycmVudEl0ZW0gPSBjb252ZXJ0T3BlcmF0aW9uKGN1cnJlbnRJdGVtLCBwYXJlbnQsIGNvbnZlcnRlZFBhcmVudCwgbGV2ZWwsIGluZGV4KTtcclxuICAgICAgICAgICAgaWYgKCFjb252ZXJ0ZWRDdXJyZW50SXRlbSkgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gY2hpbGRyZW5TZWxlY3RvcihjdXJyZW50SXRlbSk7XHJcbiAgICAgICAgICAgIGlmIChjaGlsZHJlbikge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaSA9IGNoaWxkcmVuW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRMZXZlbCA9IGxldmVsICsgMTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGlsZENvbnZlcnRlZCA9IFRyZWVIZWxwZXJzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5Db252ZXJ0PFQsIFRSZXN1bHQ+KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5TZWxlY3RvcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdENoaWxkcmVuU2VsZWN0b3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJ0T3BlcmF0aW9uLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZENoaWxkcmVuT3BlcmF0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEl0ZW0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJ0ZWRDdXJyZW50SXRlbSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRMZXZlbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZENvbnZlcnRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWRkQ2hpbGRyZW5PcGVyYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZENoaWxkcmVuT3BlcmF0aW9uKGNvbnZlcnRlZEN1cnJlbnRJdGVtLGNoaWxkQ29udmVydGVkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdENoaWxkcmVuU2VsZWN0b3IoY29udmVydGVkQ3VycmVudEl0ZW0pLnB1c2goY2hpbGRDb252ZXJ0ZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjb252ZXJ0ZWRDdXJyZW50SXRlbTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBDb252ZXJ0TGlzdFRvTG9va3VwPFQ+KGxpc3Q6IFRbXSwgY2hpbGRyZW5TZWxlY3RvcjogKHg6IFQpID0+IEFycmF5PFQ+LCBrZXlTZWxlY3RvcjogKHg6IFQpID0+IHN0cmluZyk6IGNvbGxlY3Rpb25zLkRpY3Rpb25hcnk8c3RyaW5nLCBUPiB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgY29sbGVjdGlvbnMuRGljdGlvbmFyeTxzdHJpbmcsIFQ+KCk7XHJcbiAgICAgICAgICAgIGxpc3QuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuQ29udmVydFRvTG9va3VwKHgsIGNoaWxkcmVuU2VsZWN0b3IsIGtleVNlbGVjdG9yLHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIENvbnZlcnRUb0xvb2t1cDxUPihyb290OiBULCBjaGlsZHJlblNlbGVjdG9yOiAoeDogVCkgPT4gQXJyYXk8VD4sIGtleVNlbGVjdG9yOiAoeDogVCkgPT4gc3RyaW5nLHJlc3VsdDpjb2xsZWN0aW9ucy5EaWN0aW9uYXJ5PHN0cmluZywgVD49IG5ldyBjb2xsZWN0aW9ucy5EaWN0aW9uYXJ5PHN0cmluZywgVD4oKSk6IGNvbGxlY3Rpb25zLkRpY3Rpb25hcnk8c3RyaW5nLCBUPiB7XHJcbiAgICAgICAgICAgIFRyZWVIZWxwZXJzLlRyYXZlcnNlUHJlb3JkZXIocm9vdCxcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuU2VsZWN0b3IsXHJcbiAgICAgICAgICAgICAgICAoeCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zZXRWYWx1ZShrZXlTZWxlY3Rvcih4KSwgeCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBHZXRCeVByZWRpY2F0ZTxUPihpbnB1dDogVCwgY2hpbGRyZW5TZWxlY3RvcjogKHg6IFQpID0+IEFycmF5PFQ+LCBwcmVkaWNhdGU6ICh4OiBUKSA9PiBib29sZWFuLCBkZWVwQ29weUZ1bmN0aW9uOiAoeDogVCkgPT4gVCk6IEFycmF5PFQ+IHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdDogQXJyYXk8VD4gPSBbXTtcclxuICAgICAgICAgICAgVHJlZUhlbHBlcnMuVHJhdmVyc2VQcmVvcmRlcihpbnB1dCxcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuU2VsZWN0b3IsXHJcbiAgICAgICAgICAgICAgICAoeCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoeCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZGVlcENvcHlGdW5jdGlvbih4KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIFJlY29uc3RydWN0RnJvbUxlYWZzPFQ+KGxlYWZzTGlzdDogQXJyYXk8VD4sXHJcbiAgICAgICAgICAgIGZ1bGxIaWVyYXJjaHlMb29rdXA6IGNvbGxlY3Rpb25zLkRpY3Rpb25hcnk8c3RyaW5nLCBUPixcclxuICAgICAgICAgICAgaXRlbVVuaXF1ZU5hbWVTZWxlY3RvcjogKHg6IFQpID0+IHN0cmluZyxcclxuICAgICAgICAgICAgaXRlbVBhcmVudFVuaXF1ZU5hbWVTZWxlY3RvcjogKHg6IFQpID0+IHN0cmluZyxcclxuICAgICAgICAgICAgY2hpbGRyZW5TZWxlY3RvcjogKHg6IFQpID0+IEFycmF5PFQ+LFxyXG4gICAgICAgICAgICBkZWVwQ29weUZ1bmN0aW9uOiAoVCwgYm9vbGVhbikgPT4gVCk6IFQge1xyXG4gICAgICAgICAgICB2YXIgbG9va3VwID0gbmV3IGNvbGxlY3Rpb25zLkRpY3Rpb25hcnk8c3RyaW5nLCBUPigpO1xyXG4gICAgICAgICAgICBsZWFmc0xpc3QuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50SXRlbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB2YXIgdW5pcXVlTmFtZSA9IGl0ZW1VbmlxdWVOYW1lU2VsZWN0b3IoeCk7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50SXRlbSA9IGZ1bGxIaWVyYXJjaHlMb29rdXAuZ2V0VmFsdWUodW5pcXVlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50SXRlbSA9IGRlZXBDb3B5RnVuY3Rpb24oY3VycmVudEl0ZW0sIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBsb29rdXAuc2V0VmFsdWUodW5pcXVlTmFtZSwgY3VycmVudEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnRVbmlxdWVOYW1lID0gaXRlbVBhcmVudFVuaXF1ZU5hbWVTZWxlY3RvcihjdXJyZW50SXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudEl0ZW0gPSBmdWxsSGllcmFyY2h5TG9va3VwLmdldFZhbHVlKHBhcmVudFVuaXF1ZU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChjdXJyZW50SXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50SXRlbSA9IGRlZXBDb3B5RnVuY3Rpb24oY3VycmVudEl0ZW0sIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9va3VwLnNldFZhbHVlKHBhcmVudFVuaXF1ZU5hbWUsIGN1cnJlbnRJdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudFVuaXF1ZU5hbWUgPSBpdGVtUGFyZW50VW5pcXVlTmFtZVNlbGVjdG9yKGN1cnJlbnRJdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEl0ZW0gPSBmdWxsSGllcmFyY2h5TG9va3VwLmdldFZhbHVlKHBhcmVudFVuaXF1ZU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsb29rdXAuZm9yRWFjaCgoa2V5LCB2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IGxvb2t1cC5nZXRWYWx1ZShpdGVtUGFyZW50VW5pcXVlTmFtZVNlbGVjdG9yKHZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5TZWxlY3RvcihwYXJlbnQpLnB1c2godmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGxvb2t1cC5nZXRWYWx1ZShUcmVlSGVscGVycy5ISUVSQVJDSFlfUk9PVF9VTklRVUVfTkFNRSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAqIFJldHVybnMgZGVlcENvcHkgb2YgdW5pb24gb2YgdHdvIHRyZWVzIHdpdGggY29tbW9uIHJvb3QgYW5kIHNhbWUgZGVwdGhcclxuICAgICAgICAqL1xyXG4gICAgICAgIHN0YXRpYyBVbmlvbjxUPihyb290QTogVCxcclxuICAgICAgICAgICAgcm9vdEI6IFQsXHJcbiAgICAgICAgICAgIGl0ZW1VbmlxdWVOYW1lU2VsZWN0b3I6ICh4OiBUKSA9PiBzdHJpbmcsXHJcbiAgICAgICAgICAgIGNoaWxkcmVuU2VsZWN0b3I6ICh4OiBUKSA9PiBBcnJheTxUPixcclxuICAgICAgICAgICAgcGFyZW50UHJvcGVydHlOYW1lOiBzdHJpbmcsXHJcbiAgICAgICAgICAgIGRlZXBDb3B5RnVuY3Rpb246IChULCBib29sZWFuKSA9PiBUKTogVCB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJvb3RVbmlxdWVOYW1lID0gaXRlbVVuaXF1ZU5hbWVTZWxlY3Rvcihyb290QSk7XHJcbiAgICAgICAgICAgIHZhciBsb29rdXAgPSBuZXcgY29sbGVjdGlvbnMuRGljdGlvbmFyeTxzdHJpbmcsIFQ+KCk7XHJcbiAgICAgICAgICAgIHZhciBsb29rdXBGaWxsRnVuY3Rpb24gPSAoaSwgcGFyZW50LCBsZXZlbCwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpW3BhcmVudFByb3BlcnR5TmFtZV0gPSBpdGVtVW5pcXVlTmFtZVNlbGVjdG9yKHBhcmVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsb29rdXAuc2V0VmFsdWUoaXRlbVVuaXF1ZU5hbWVTZWxlY3RvcihpKSwgZGVlcENvcHlGdW5jdGlvbihpLCBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFRyZWVIZWxwZXJzLlRyYXZlcnNlUHJlb3JkZXI8VD4ocm9vdEEsXHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlblNlbGVjdG9yLFxyXG4gICAgICAgICAgICAgICAgKGksIHBhcmVudCwgbGV2ZWwsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvb2t1cEZpbGxGdW5jdGlvbihpLCBwYXJlbnQsIGxldmVsLCBpbmRleCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgVHJlZUhlbHBlcnMuVHJhdmVyc2VQcmVvcmRlcjxUPihyb290QixcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuU2VsZWN0b3IsXHJcbiAgICAgICAgICAgICAgICAoaSwgcGFyZW50LCBsZXZlbCwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9va3VwRmlsbEZ1bmN0aW9uKGksIHBhcmVudCwgbGV2ZWwsIGluZGV4KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBsb29rdXAuZm9yRWFjaCgoa2V5LCB2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudFVuaXF1ZU5hbWUgPSB2YWx1ZVtwYXJlbnRQcm9wZXJ0eU5hbWVdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudFVuaXF1ZU5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBsb29rdXAuZ2V0VmFsdWUocGFyZW50VW5pcXVlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlblNlbGVjdG9yKHBhcmVudCkucHVzaCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGxvb2t1cC5nZXRWYWx1ZShyb290VW5pcXVlTmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIEludGVyc2VjdENoaWxkcmVuPFQ+KGE6IEFycmF5PFQ+LCBiOiBBcnJheTxUPiwgdW5pcXVlTmFtZVNlbGVjdG9yOiAoeDogVCkgPT4gc3RyaW5nKTogQXJyYXk8SW50ZXJzZWN0aW9uUGFpcjxUPj4ge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgIHZhciBhU2V0ID0gbmV3IGNvbGxlY3Rpb25zLkRpY3Rpb25hcnk8c3RyaW5nLCBUPigpO1xyXG4gICAgICAgICAgICBhLmZvckVhY2goeCA9PiBhU2V0LnNldFZhbHVlKHVuaXF1ZU5hbWVTZWxlY3Rvcih4KSwgeCkpO1xyXG4gICAgICAgICAgICB2YXIgYlNldCA9IG5ldyBjb2xsZWN0aW9ucy5EaWN0aW9uYXJ5PHN0cmluZywgVD4oKTtcclxuICAgICAgICAgICAgYi5mb3JFYWNoKHggPT4gYlNldC5zZXRWYWx1ZSh1bmlxdWVOYW1lU2VsZWN0b3IoeCksIHgpKTtcclxuICAgICAgICAgICAgYVNldC5rZXlzKCkuZm9yRWFjaCgoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJTZXQuZ2V0VmFsdWUoa2V5KTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBJbnRlcnNlY3Rpb25QYWlyKGFTZXQuZ2V0VmFsdWUoa2V5KSwgdmFsdWUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBkZWVwQ29weSBvZiBpbnRlcnNlY3Rpb24gb2YgdHdvIHRyZWVzIHdpdGggY29tbW9uIHJvb3QsIHRyZWUgY2FuIGhhdmUgZGlmZnJlbnQgZGVwdGhcclxuICAgICAqL1xyXG4gICAgICAgIHN0YXRpYyBJbnRlcnNlY3Rpb248VD4oYTogVCxcclxuICAgICAgICAgICAgYjogVCxcclxuICAgICAgICAgICAgdW5pcXVlTmFtZVNlbGVjdG9yOiAoeDogVCkgPT4gc3RyaW5nLFxyXG4gICAgICAgICAgICBjaGlsZHJlblNlbGVjdG9yOiAoeDogVCkgPT4gQXJyYXk8VD4sXHJcbiAgICAgICAgICAgIGNoaWxkcmVuQXBwZW5kZXI6IChub2RlOiBULCBjaGlsZDogVCkgPT4gdm9pZCxcclxuICAgICAgICAgICAgZGVlcENvcHk6IChULCBib29sZWFuKSA9PiBUKTogVCB7XHJcbiAgICAgICAgICAgIGlmIChhID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgaWYgKGIgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICBpZiAodW5pcXVlTmFtZVNlbGVjdG9yKGEpICE9PSB1bmlxdWVOYW1lU2VsZWN0b3IoYikpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgaWYgKGNoaWxkcmVuU2VsZWN0b3IoYSkubGVuZ3RoID09PSAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZXBDb3B5KGIsIHRydWUpO1xyXG4gICAgICAgICAgICBpZiAoY2hpbGRyZW5TZWxlY3RvcihiKS5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVlcENvcHkoYSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhaXJzID0gVHJlZUhlbHBlcnMuSW50ZXJzZWN0Q2hpbGRyZW4oY2hpbGRyZW5TZWxlY3RvcihhKSwgY2hpbGRyZW5TZWxlY3RvcihiKSwgdW5pcXVlTmFtZVNlbGVjdG9yKTtcclxuICAgICAgICAgICAgaWYgKHBhaXJzLmxlbmd0aCA9PT0gMClcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB2YXIgY2hpbGRyZW46IEFycmF5PFQ+ID0gW107XHJcbiAgICAgICAgICAgIHBhaXJzLmZvckVhY2goKHBhaXIpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IFRyZWVIZWxwZXJzLkludGVyc2VjdGlvbjxUPihwYWlyLkEsIHBhaXIuQiwgdW5pcXVlTmFtZVNlbGVjdG9yLCBjaGlsZHJlblNlbGVjdG9yLCBjaGlsZHJlbkFwcGVuZGVyLCBkZWVwQ29weSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMClcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gZGVlcENvcHkoYSwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IHsgY2hpbGRyZW5BcHBlbmRlcihyZXN1bHQsIGNoaWxkKTsgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN0YXRpYyBGbGF0dGVuPFQ+KHJvb3Q6IFQsIGNoaWxkcmVuU2VsZWN0b3I6ICh4OiBUKSA9PiBBcnJheTxUPiwgaW5jbHVkZVByZWRpY2F0ZTogKHg6IFQpID0+IGJvb2xlYW4gPSAoeCkgPT4geyByZXR1cm4gdHJ1ZTsgfSk6IEFycmF5PFQ+IHtcclxuICAgICAgICAgICAgcmV0dXJuIFRyZWVIZWxwZXJzLkZsYXR0ZW5JbnRlcm5hbChbXSwgY2hpbGRyZW5TZWxlY3Rvcihyb290KSwgY2hpbGRyZW5TZWxlY3RvciwgaW5jbHVkZVByZWRpY2F0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgRmxhdHRlbkFycmF5PFQ+KHJvb3RMaXN0OiBBcnJheTxUPixcclxuICAgICAgICAgICAgY2hpbGRyZW5TZWxlY3RvcjogKHg6IFQpID0+IEFycmF5PFQ+LFxyXG4gICAgICAgICAgICBpbmNsdWRlUHJlZGljYXRlOiAoeDogVCkgPT4gYm9vbGVhbiA9ICh4KSA9PiB7IHJldHVybiB0cnVlOyB9KTogQXJyYXk8VD4ge1xyXG4gICAgICAgICAgICByZXR1cm4gVHJlZUhlbHBlcnMuRmxhdHRlbkludGVybmFsKFtdLCByb290TGlzdCwgY2hpbGRyZW5TZWxlY3RvciwgaW5jbHVkZVByZWRpY2F0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBGbGF0dGVuSW50ZXJuYWw8VD4ocmVzdWx0OiBBcnJheTxUPixcclxuICAgICAgICAgICAgbGlzdDogQXJyYXk8VD4sXHJcbiAgICAgICAgICAgIGNoaWxkcmVuU2VsZWN0b3I6ICh4OiBUKSA9PiBBcnJheTxUPixcclxuICAgICAgICAgICAgaW5jbHVkZVByZWRpY2F0ZTogKHg6IFQpID0+IGJvb2xlYW4gPSAoeCkgPT4geyByZXR1cm4gdHJ1ZTsgfSk6IEFycmF5PFQ+IHtcclxuXHJcbiAgICAgICAgICAgIHZhciBzdGFjayA9IG5ldyBjb2xsZWN0aW9ucy5TdGFjazxUPigpO1xyXG4gICAgICAgICAgICBsaXN0LmZvckVhY2goaSA9PiB7IHN0YWNrLnB1c2goaSkgfSk7XHJcbiAgICAgICAgICAgIHdoaWxlICghc3RhY2suaXNFbXB0eSgpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gc3RhY2sucG9wKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZVByZWRpY2F0ZShjdXJyZW50KSkgcmVzdWx0LnB1c2goY3VycmVudCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IGNoaWxkcmVuU2VsZWN0b3IoY3VycmVudCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGkgPT4geyBzdGFjay5wdXNoKGkpIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVHJhdmVyc2VMaXN0QkZTPFQ+KGxpc3Q6IFRbXSwgY2hpbGRyZW5TZWxlY3RvcjogKHg6IFQpID0+IEFycmF5PFQ+LCBvcGVyYXRpb246IChjdXJyZW50OiBULCBpbmRleDogbnVtYmVyKSA9PiBib29sZWFuLCB0cmFja1Zpc2l0ZWQ6IGJvb2xlYW49IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIFRyZWVIZWxwZXJzLlRyYXZlcnNlQkZTKG51bGwsY2hpbGRyZW5TZWxlY3RvcixvcGVyYXRpb24sbGlzdC5zbGljZSgpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVHJhdmVyc2VCRlM8VD4oY3VycmVudEl0ZW06IFQsIGNoaWxkcmVuU2VsZWN0b3I6ICh4OiBUKSA9PiBBcnJheTxUPiwgb3BlcmF0aW9uOiAoY3VycmVudDogVCwgaW5kZXg6IG51bWJlcikgPT4gYm9vbGVhbixxdWV1ZTpUW10pIHtcclxuICAgICAgICAgICAgdmFyIGl0ZXJhdGlvbkluZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudEl0ZW0pXHJcbiAgICAgICAgICAgICAgICBxdWV1ZS5wdXNoKGN1cnJlbnRJdGVtKTtcclxuICAgICAgICAgICAgdmFyIGNhbkNvbnRpbnVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDAgJiYgY2FuQ29udGludWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50ID0gcXVldWUuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuU2VsZWN0b3IoY3VycmVudCkuZm9yRWFjaChjID0+IHF1ZXVlLnB1c2goYykpO1xyXG4gICAgICAgICAgICAgICAgY2FuQ29udGludWUgPSBvcGVyYXRpb24oY3VycmVudCwgaXRlcmF0aW9uSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgaXRlcmF0aW9uSW5kZXgrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgSW50ZXJzZWN0aW9uUGFpcjxUPiB7XHJcbiAgICAgICAgY29uc3RydWN0b3IocHVibGljIEE6IFQsIHB1YmxpYyBCOiBUKSB7fVxyXG4gICAgfVxyXG59Il19