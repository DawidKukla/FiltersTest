var Comarch;
(function (Comarch) {
    var Controls;
    (function (Controls) {
        var FilterControlModule;
        (function (FilterControlModule) {
            var MockServiceModule;
            (function (MockServiceModule) {
                var TestNodeHelper = FilterControlModule.Common.MemberNodesHelper;
                var MemberFilterType = FilterControlModule.Common.MemberFilterType;
                var MetadataResponse = FilterControlModule.Common.MetadataResponse;
                var FilterMetadata = FilterControlModule.Common.FilterMetadata;
                var FilterLevel = FilterControlModule.Common.FilterLevel;
                var FiltredElementsChildrenCountResponse = Controls.FilterControlModule.Common.FiltredElementsChildrenCountResponse;
                var SelectionMode = Controls.FilterControlModule.FilterStateManagerModule.SelectionMode;
                var FilterItemState = Controls.FilterControlModule.Common.FilterItemState;
                class FilterControlServiceMockFactory {
                    Create(_connectionString) { return new MockService(window["_fakeTree"], window["_fakeDefaultMember"]); }
                }
                MockServiceModule.FilterControlServiceMockFactory = FilterControlServiceMockFactory;
                class MockService {
                    constructor(_testTree, _defaultMember) {
                        this._testTree = _testTree;
                        this._defaultMember = _defaultMember;
                        this._totalElementsCount = 0;
                        this._testSortedLevels = [new FilterLevel("Year", "Year"), new FilterLevel("Quater", "Quater"), new FilterLevel("Month", "Month"), new FilterLevel("Day", "Day")];
                        this._childrenTotalCountLookup = {};
                        this.AllMembersLookup = {};
                        this.CreateIds(_testTree);
                        this.AddParentUniqueNames_Levels_ChildCount_AndCalculateTotalElementsCount(_testTree, true);
                        if (this._defaultMember) {
                            this.CreateIds([_defaultMember]);
                            this.AddParentUniqueNames_Levels_ChildCount_AndCalculateTotalElementsCount([_defaultMember], false);
                        }
                    }
                    get CleanedState() {
                        return window["_fakeCleanedState"];
                    }
                    ;
                    GetLevelNumberFromUniqueName(uniqueName) {
                        return this._testSortedLevels.map(x => x.UniqueName).indexOf(uniqueName);
                    }
                    async GetMetadata(request) {
                        var defaultMemberInfo = null;
                        if (this._defaultMember) {
                            defaultMemberInfo = {
                                ParentsLookup: {},
                                LastLevelNodes: [],
                                HasMoreMembers: false
                            };
                            Comarch.Utils.TreeUtils.TreeHelpers.TraversePreorder(this._defaultMember, (x) => x.children, (current) => {
                                if (!current.children.length) {
                                    defaultMemberInfo.LastLevelNodes.push(current);
                                    return false;
                                }
                                else {
                                    defaultMemberInfo.ParentsLookup[current.id] = current;
                                }
                                current.data.childrenTotalCount = this._childrenTotalCountLookup[current.id].ChildrenCount;
                                return true;
                            });
                            this.ClearParents(defaultMemberInfo.ParentsLookup);
                        }
                        var metadata = new FilterMetadata(request.FieldUniqueName, "Calendar Time", this._testSortedLevels, this._testTree.length, this._totalElementsCount, defaultMemberInfo);
                        return new MetadataResponse(metadata, this.CleanedState);
                    }
                    async GetMembers(request) {
                        var result = this.GetMembersCore(this.GetLevelNumberFromUniqueName(request.FieldUniqueName), request.Start, request.Count, request.Filter, false);
                        return { FilterInfo: result };
                    }
                    async GetLeafMembers(request) {
                        var result = this.GetMembersCore(this.GetLevelNumberFromUniqueName(request.FieldUniqueName), request.Start, request.Count, request.Filter, true);
                        return { FilterInfo: result };
                    }
                    async GetChildren(request) {
                        var result = null;
                        var temp = this.GetCopyOfWorkingTree();
                        Comarch.Utils.TreeUtils.TreeHelpers.TraverseListPreorder(temp, (x) => x.children, (x) => {
                            if (x.id === request.Parent) {
                                result = x;
                                return false;
                            }
                            return true;
                        });
                        result = this.SelectSpecyficElements(this.MakeLazyLoaded(result.children), request.Start, request.Count + 1);
                        var hasMoreNodes = this.HasMoreMembers(request.Count, result);
                        if (hasMoreNodes) {
                            result.pop();
                        }
                        result = this.ClearNotNeededData(result, {}, hasMoreNodes);
                        return { FilterInfo: result };
                    }
                    async GetFiltredElementsChildrenCount(request) {
                        var result = new FiltredElementsChildrenCountResponse();
                        var temp = this.GetCopyOfWorkingTree();
                        temp = this.SearchMembersCore(temp, this.GetLevelNumberFromUniqueName(request.FieldUniqueName), request.Filter);
                        Comarch.Utils.TreeUtils.TreeHelpers.TraverseListPreorder(temp, (x) => x.children, (x, parent, level, index) => {
                            if (request.NodesUniqueNames.indexOf(x.id) !== -1) {
                                result.ChildrenCountInfoLookup[x.id] = { ChildrenCount: x.children.length };
                            }
                            return true;
                        }, new Comarch.Utils.TreeUtils.ForwardTreeTraversalIteratorFactory());
                        return result;
                    }
                    async GetMembersByStatus(request, stateManager) {
                        var temp = this.GetCopyOfWorkingTree();
                        var allParentsLookup = {};
                        var targetLevelElementsList = [];
                        Comarch.Utils.TreeUtils.TreeHelpers.TraverseListPreorder(temp, (x) => x.children, (current, parent, level, index, parents) => {
                            if (current.data && current.data.level === this.GetLevelNumberFromUniqueName(request.FieldUniqueName)) {
                                if (current.children.length) {
                                    current.children = true;
                                }
                                let selectionStatus = stateManager.GetSelectionStatus(parents.map(x => x.id).reverse(), current.id);
                                if (selectionStatus === SelectionMode.Selected && request.Status === FilterItemState.Checked) {
                                    targetLevelElementsList.push(current);
                                }
                                else if (selectionStatus === SelectionMode.Deselected && request.Status === FilterItemState.Unchecked) {
                                    targetLevelElementsList.push(current);
                                }
                            }
                            if (parent) {
                                allParentsLookup[parent.id] = parent;
                            }
                            return true;
                        }, new Comarch.Utils.TreeUtils.ForwardTreeTraversalIteratorFactory(), true);
                        return { FilterInfo: this.GetPackage(allParentsLookup, targetLevelElementsList, request.Start, request.Count) };
                    }
                    GetCopyOfWorkingTree() {
                        return this.GetCopyOfTree(this._testTree);
                    }
                    GetCopyOfTree(tree) {
                        return JSON.parse(JSON.stringify(tree));
                    }
                    MakeLazyLoaded(nodes) {
                        nodes.forEach(node => {
                            if (node.children.length) {
                                node.children = true;
                                delete node.state;
                            }
                        });
                        return nodes;
                    }
                    SelectSpecyficElements(nodes, startIndex, numberOfElements) {
                        var result = [];
                        for (var i = startIndex; i < nodes.length && result.length <= numberOfElements - 1; i++) {
                            result.push(nodes[i]);
                        }
                        return result;
                    }
                    GetMembersCore(targetLevelNumber, start, count, filter, onlyLeafs = false) {
                        var temp = this.GetCopyOfWorkingTree();
                        temp = this.SearchMembersCore(temp, targetLevelNumber, filter);
                        var allParentsLookup = {};
                        var targetLevelElementsList = [];
                        Comarch.Utils.TreeUtils.TreeHelpers.TraverseListPreorder(temp, (x) => x.children, (x, parent, level, index) => {
                            if (onlyLeafs) {
                                if (x.data && x.data.childrenTotalCount === 0) {
                                    targetLevelElementsList.push(x);
                                }
                            }
                            else if (x.data && x.data.level === targetLevelNumber) {
                                if (x.children.length) {
                                    x.children = true;
                                }
                                targetLevelElementsList.push(x);
                            }
                            if (parent) {
                                allParentsLookup[parent.id] = parent;
                            }
                            return true;
                        }, new Comarch.Utils.TreeUtils.ForwardTreeTraversalIteratorFactory());
                        return this.GetPackage(allParentsLookup, targetLevelElementsList, start, count);
                    }
                    GetPackage(allParentsLookup, targetLevelElementsList, start, count) {
                        var targetParentsLookup = {};
                        this.ClearParents(allParentsLookup);
                        var temp = this.SelectSpecyficElements(targetLevelElementsList, start, count + 1);
                        var hasMoreMembers = this.HasMoreMembers(count, temp);
                        if (hasMoreMembers) {
                            temp.pop();
                        }
                        temp.forEach(x => {
                            TestNodeHelper.GetAllParentsNames(allParentsLookup, x).forEach(parentName => {
                                targetParentsLookup[parentName] = true;
                            });
                        });
                        for (let key in allParentsLookup) {
                            if (!targetParentsLookup[key]) {
                                delete allParentsLookup[key];
                            }
                        }
                        return this.ClearNotNeededData(temp, allParentsLookup, hasMoreMembers);
                    }
                    ClearParents(allParentsLookup) {
                        for (let key in allParentsLookup) {
                            if (allParentsLookup.hasOwnProperty(key)) {
                                let memberNode = allParentsLookup[key];
                                if (memberNode && typeof memberNode.children !== "boolean") {
                                    memberNode.children.length = 0;
                                }
                            }
                        }
                    }
                    ClearNotNeededData(lastLevelNodes, allParentsLookup, hasMoreMembers) {
                        lastLevelNodes.forEach(x => delete x.data.level);
                        for (var parentKey in allParentsLookup) {
                            delete allParentsLookup[parentKey].data.level;
                        }
                        return { LastLevelNodes: lastLevelNodes, ParentsLookup: allParentsLookup, HasMoreMembers: hasMoreMembers };
                    }
                    SearchMembersCore(input, targetLevelNumber, filter) {
                        if (!filter || !filter.Value)
                            return input;
                        var result = input;
                        var matchFound = false;
                        var matchCounter = 0;
                        Comarch.Utils.TreeUtils.TreeHelpers.TraverseListPreorder(result, (x) => x.children, (x, parent, level, index) => {
                            if (level === targetLevelNumber) {
                                switch (filter.Type) {
                                    case MemberFilterType.Contains:
                                        matchFound = x.text.toLowerCase().indexOf(filter.Value.toLowerCase()) !== -1;
                                        break;
                                    case MemberFilterType.BeginsWith:
                                        matchFound = x.text.toLowerCase().startsWith(filter.Value.toLowerCase());
                                        break;
                                    case MemberFilterType.EndsWith:
                                        matchFound = x.text.toLowerCase().endsWith(filter.Value.toLowerCase());
                                        break;
                                }
                                if (!matchFound) {
                                    if (parent) {
                                        parent.children.splice(index, 1);
                                    }
                                    else {
                                        result.splice(index, 1);
                                    }
                                }
                                else {
                                    matchCounter++;
                                }
                            }
                            return true;
                        });
                        if (!matchCounter)
                            return [];
                        Comarch.Utils.TreeUtils.TreeHelpers.TraverseListPreorder(result, (x) => x.children, (x, parent, level, index) => {
                            if (level < targetLevelNumber && !x.children.length) {
                                if (parent) {
                                    parent.children.splice(index, 1);
                                    return false;
                                }
                                else {
                                    result.splice(index, 1);
                                    return false;
                                }
                            }
                            return true;
                        });
                        return result;
                    }
                    CreateIds(input) {
                        var result = input;
                        Comarch.Utils.TreeUtils.TreeHelpers.TraverseListPreorder(result, (x) => x.children, (x, parent, level, index) => {
                            var parts = [];
                            var parentPart = "";
                            if (parent) {
                                parentPart = parent.id;
                                parts.push(parentPart);
                            }
                            parts.push(`[${x.text}]`);
                            x["id"] = parts.join(".");
                            return true;
                        });
                        return result;
                    }
                    AddParentUniqueNames_Levels_ChildCount_AndCalculateTotalElementsCount(input, storeGlobal) {
                        var result = input;
                        Comarch.Utils.TreeUtils.TreeHelpers.TraverseListPreorder(result, (x) => x.children, (x, parent, level, index) => {
                            var parentUniqueName = null;
                            if (parent) {
                                parentUniqueName = parent.id;
                            }
                            x.data = {
                                parentUniqueName: parentUniqueName,
                                level: level,
                                childrenTotalCount: x.children.length
                            };
                            if (storeGlobal) {
                                this._childrenTotalCountLookup[x.id] = { ChildrenCount: x.children.length };
                                this._totalElementsCount++;
                                let copy = JSON.parse(JSON.stringify(x));
                                copy.children.length = 0;
                                this.AllMembersLookup[x.id] = copy;
                            }
                            return true;
                        }, new Comarch.Utils.TreeUtils.ForwardTreeTraversalIteratorFactory());
                        return result;
                    }
                    static CreateFakeTimeHierarchy(numberOfYears) {
                        var result = [];
                        var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                        for (var y = 0; y < numberOfYears; y++) {
                            var yearItem = { text: (2000 + y).toString(), children: [] };
                            result.push(yearItem);
                            for (var q = 0; q < 4; q++) {
                                var quaterItem = { text: "Q" + (q + 1).toString(), children: [] };
                                yearItem.children.push(quaterItem);
                                for (var m = q * 3; m < q * 3 + 3; m++) {
                                    var monthItem = { text: months[m], children: [] };
                                    quaterItem.children.push(monthItem);
                                    for (var d = 0; d < 30; d++) {
                                        var dayItem = { text: (d + 1).toString(), children: [] };
                                        monthItem.children.push(dayItem);
                                    }
                                }
                            }
                        }
                        return result;
                    }
                    HasMoreMembers(count, loadedLastLevelNodes) {
                        return loadedLastLevelNodes.length === count + 1;
                    }
                    GetFullData() {
                        return JSON.parse(JSON.stringify(this._testTree));
                    }
                    TestPathTracking() {
                        Comarch.Utils.TreeUtils.TreeHelpers.TraverseListPreorder(this.GetCopyOfWorkingTree(), (x) => x.children, (x, parent, level, index, path) => {
                            console.log(x.id, "(", path.map(x => x.id), ")");
                            return true;
                        }, new Comarch.Utils.TreeUtils.ForwardTreeTraversalIteratorFactory(), true);
                    }
                }
                MockServiceModule.MockService = MockService;
            })(MockServiceModule = FilterControlModule.MockServiceModule || (FilterControlModule.MockServiceModule = {}));
        })(FilterControlModule = Controls.FilterControlModule || (Controls.FilterControlModule = {}));
    })(Controls = Comarch.Controls || (Comarch.Controls = {}));
})(Comarch || (Comarch = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTW9ja1NlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJNb2NrU2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFVLE9BQU8sQ0FxWlo7QUFyWkwsV0FBVSxPQUFPO0lBQUMsSUFBQSxRQUFRLENBcVpyQjtJQXJaYSxXQUFBLFFBQVE7UUFBQyxJQUFBLG1CQUFtQixDQXFaekM7UUFyWnNCLFdBQUEsbUJBQW1CO1lBQUMsSUFBQSxpQkFBaUIsQ0FxWjNEO1lBclowQyxXQUFBLGlCQUFpQjtnQkFHNUQsSUFBTyxjQUFjLEdBQUcsb0JBQUEsTUFBTSxDQUFDLGlCQUFpQixDQUFDO2dCQUVqRCxJQUFPLGdCQUFnQixHQUFHLG9CQUFBLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFHbEQsSUFBTyxnQkFBZ0IsR0FBRyxvQkFBQSxNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ2xELElBQU8sY0FBYyxHQUFHLG9CQUFBLE1BQU0sQ0FBQyxjQUFjLENBQUM7Z0JBQzlDLElBQU8sV0FBVyxHQUFHLG9CQUFBLE1BQU0sQ0FBQyxXQUFXLENBQUM7Z0JBT3hDLElBQU8sb0NBQW9DLEdBQUcsUUFBUSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxvQ0FBb0MsQ0FBQztnQkFFdkgsSUFBTyxhQUFhLEdBQUcsUUFBUSxDQUFDLG1CQUFtQixDQUFDLHdCQUF3QixDQUFDLGFBQWEsQ0FBQztnQkFDM0YsSUFBTyxlQUFlLEdBQUcsUUFBUSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUM7Z0JBTTdFO29CQUNJLE1BQU0sQ0FBQyxpQkFBeUIsSUFBMkIsTUFBTSxDQUFDLElBQUksV0FBVyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBQyxNQUFNLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDekk7Z0JBRmEsaURBQStCLGtDQUU1QyxDQUFBO2dCQUNEO29CQVNJLFlBQW9CLFNBQXdCLEVB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YSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFDLElBQUksRUFBRSxFQUFFOzRCQUMxQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUMsR0FBRyxFQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBLEVBQUUsQ0FBQSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsR0FBRyxDQUFDLENBQUM7NEJBQzVDLE1BQU0sQ0FBQyxJQUFJLENBQUM7d0JBQ2YsQ0FBQyxFQUNELElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsbUNBQW1DLEVBQUUsRUFDakUsSUFBSSxDQUNQLENBQUM7b0JBRU4sQ0FBQztpQkFDQTtnQkF2WFEsNkJBQVcsY0F1WG5CLENBQUE7WUFDTCxDQUFDLEVBclowQyxpQkFBaUIsR0FBakIscUNBQWlCLEtBQWpCLHFDQUFpQixRQXFaM0Q7UUFBRCxDQUFDLEVBclpzQixtQkFBbUIsR0FBbkIsNEJBQW1CLEtBQW5CLDRCQUFtQixRQXFaekM7SUFBRCxDQUFDLEVBclphLFFBQVEsR0FBUixnQkFBUSxLQUFSLGdCQUFRLFFBcVpyQjtBQUFELENBQUMsRUFyWkssT0FBTyxLQUFQLE9BQU8sUUFxWloiLCJzb3VyY2VzQ29udGVudCI6WyJuYW1lc3BhY2UgQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLk1vY2tTZXJ2aWNlTW9kdWxlIHtcclxuICAgIGltcG9ydCBJTWVtYmVyTm9kZSA9IENvbW1vbi5JTWVtYmVyTm9kZTtcclxuICAgIGltcG9ydCBJTWVtYmVyTm9kZUxvb2t1cCA9IENvbW1vbi5JTWVtYmVyTm9kZUxvb2t1cDtcclxuICAgIGltcG9ydCBUZXN0Tm9kZUhlbHBlciA9IENvbW1vbi5NZW1iZXJOb2Rlc0hlbHBlcjtcclxuICAgIGltcG9ydCBNZW1iZXJGaWx0ZXIgPSBDb21tb24uTWVtYmVyRmlsdGVyO1xyXG4gICAgaW1wb3J0IE1lbWJlckZpbHRlclR5cGUgPSBDb21tb24uTWVtYmVyRmlsdGVyVHlwZTtcclxuICAgIGltcG9ydCBNZXRhZGF0YVJlcXVlc3QgPSBDb21tb24uTWV0YWRhdGFSZXF1ZXN0O1xyXG4gICAgaW1wb3J0IElGaWx0ZXJJbmZvID0gQ29tbW9uLklGaWx0ZXJJbmZvO1xyXG4gICAgaW1wb3J0IE1ldGFkYXRhUmVzcG9uc2UgPSBDb21tb24uTWV0YWRhdGFSZXNwb25zZTtcclxuICAgIGltcG9ydCBGaWx0ZXJNZXRhZGF0YSA9IENvbW1vbi5GaWx0ZXJNZXRhZGF0YTtcclxuICAgIGltcG9ydCBGaWx0ZXJMZXZlbCA9IENvbW1vbi5GaWx0ZXJMZXZlbDtcclxuICAgIGltcG9ydCBNZW1iZXJzUmVxdWVzdCA9IENvbW1vbi5NZW1iZXJzUmVxdWVzdDtcclxuICAgIGltcG9ydCBNZW1iZXJzUmVzcG9uc2UgPSBDb21tb24uTWVtYmVyc1Jlc3BvbnNlO1xyXG4gICAgaW1wb3J0IExlYWZNZW1iZXJzUmVxdWVzdCA9IENvbW1vbi5MZWFmTWVtYmVyc1JlcXVlc3Q7XHJcbiAgICBpbXBvcnQgQ2hpbGRyZW5SZXF1ZXN0ID0gQ29tbW9uLkNoaWxkcmVuUmVxdWVzdDtcclxuICAgIGltcG9ydCBJRmlsdGVyQ29udHJvbFNlcnZpY2UgPSBDb21tb24uSUZpbHRlckNvbnRyb2xTZXJ2aWNlO1xyXG4gICAgaW1wb3J0IEZpbHRyZWRFbGVtZW50c0NoaWxkcmVuQ291bnRSZXF1ZXN0ID0gQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5Db21tb24uRmlsdHJlZEVsZW1lbnRzQ2hpbGRyZW5Db3VudFJlcXVlc3Q7XHJcbiAgICBpbXBvcnQgRmlsdHJlZEVsZW1lbnRzQ2hpbGRyZW5Db3VudFJlc3BvbnNlID0gQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5Db21tb24uRmlsdHJlZEVsZW1lbnRzQ2hpbGRyZW5Db3VudFJlc3BvbnNlO1xyXG4gICAgaW1wb3J0IEdldE1lbWJlcnNCeVN0YXR1c1JlcXVlc3QgPSBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkNvbW1vbi5HZXRNZW1iZXJzQnlTdGF0dXNSZXF1ZXN0O1xyXG4gICAgaW1wb3J0IFNlbGVjdGlvbk1vZGUgPSBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5TZWxlY3Rpb25Nb2RlO1xyXG4gICAgaW1wb3J0IEZpbHRlckl0ZW1TdGF0ZSA9IENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuQ29tbW9uLkZpbHRlckl0ZW1TdGF0ZTtcclxuICAgIGltcG9ydCBJQ2hpbGRyZW5Db3VudEluZm9Mb29rdXAgPSBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkNvbW1vbi5JQ2hpbGRyZW5Db3VudEluZm9Mb29rdXA7XHJcbiAgICBpbXBvcnQgSUNsZWFuZWRTdGF0ZUluZm8gPSBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkNvbW1vbi5JQ2xlYW5lZFN0YXRlSW5mbztcclxuICAgIGltcG9ydCBJRmlsdGVyU3RhdGVNYW5hZ2VyID0gQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuSUZpbHRlclN0YXRlTWFuYWdlcjtcclxuICAgIGltcG9ydCBJRmlsdGVyQ29udHJvbFNlcnZpY2VGYWN0b3J5ID0gQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5Db21tb24uSUZpbHRlckNvbnRyb2xTZXJ2aWNlRmFjdG9yeTtcclxuXHJcbiAgICBleHBvcnQgIGNsYXNzIEZpbHRlckNvbnRyb2xTZXJ2aWNlTW9ja0ZhY3RvcnkgaW1wbGVtZW50cyBJRmlsdGVyQ29udHJvbFNlcnZpY2VGYWN0b3J5IHtcclxuICAgICAgICBDcmVhdGUoX2Nvbm5lY3Rpb25TdHJpbmc6IHN0cmluZyk6IElGaWx0ZXJDb250cm9sU2VydmljZSB7IHJldHVybiBuZXcgTW9ja1NlcnZpY2Uod2luZG93W1wiX2Zha2VUcmVlXCJdLHdpbmRvd1tcIl9mYWtlRGVmYXVsdE1lbWJlclwiXSk7IH1cclxuICAgIH1cclxuICAgIGV4cG9ydCBjbGFzcyBNb2NrU2VydmljZSBpbXBsZW1lbnRzIElGaWx0ZXJDb250cm9sU2VydmljZSB7XHJcbiAgICAgICAgcHJpdmF0ZSBfdG90YWxFbGVtZW50c0NvdW50PTA7XHJcbiAgICAgICAgcHJpdmF0ZSBfdGVzdFNvcnRlZExldmVsczpGaWx0ZXJMZXZlbFtdPVtuZXcgRmlsdGVyTGV2ZWwoXCJZZWFyXCIsXCJZZWFyXCIpLG5ldyBGaWx0ZXJMZXZlbChcIlF1YXRlclwiLFwiUXVhdGVyXCIpLG5ldyBGaWx0ZXJMZXZlbChcIk1vbnRoXCIsXCJNb250aFwiKSxuZXcgRmlsdGVyTGV2ZWwoXCJEYXlcIixcIkRheVwiKV07XHJcbiAgICAgICAgcHJpdmF0ZSBfY2hpbGRyZW5Ub3RhbENvdW50TG9va3VwOiBJQ2hpbGRyZW5Db3VudEluZm9Mb29rdXAgPSB7fVxyXG4gICAgICAgIEFsbE1lbWJlcnNMb29rdXA6IElNZW1iZXJOb2RlTG9va3VwID0ge31cclxuICAgICAgICBnZXQgQ2xlYW5lZFN0YXRlKCk6IElDbGVhbmVkU3RhdGVJbmZvIHtcclxuICAgICAgICAgICAgcmV0dXJuIHdpbmRvd1tcIl9mYWtlQ2xlYW5lZFN0YXRlXCJdO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX3Rlc3RUcmVlOiBJTWVtYmVyTm9kZVtdLHByaXZhdGUgX2RlZmF1bHRNZW1iZXI6IElNZW1iZXJOb2RlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuQ3JlYXRlSWRzKF90ZXN0VHJlZSk7XHJcbiAgICAgICAgICAgIHRoaXMuQWRkUGFyZW50VW5pcXVlTmFtZXNfTGV2ZWxzX0NoaWxkQ291bnRfQW5kQ2FsY3VsYXRlVG90YWxFbGVtZW50c0NvdW50KF90ZXN0VHJlZSx0cnVlKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2RlZmF1bHRNZW1iZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuQ3JlYXRlSWRzKFtfZGVmYXVsdE1lbWJlcl0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5BZGRQYXJlbnRVbmlxdWVOYW1lc19MZXZlbHNfQ2hpbGRDb3VudF9BbmRDYWxjdWxhdGVUb3RhbEVsZW1lbnRzQ291bnQoW19kZWZhdWx0TWVtYmVyXSxmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlICBHZXRMZXZlbE51bWJlckZyb21VbmlxdWVOYW1lKHVuaXF1ZU5hbWU6c3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZXN0U29ydGVkTGV2ZWxzLm1hcCh4PT54LlVuaXF1ZU5hbWUpLmluZGV4T2YodW5pcXVlTmFtZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYXN5bmMgR2V0TWV0YWRhdGEocmVxdWVzdDogTWV0YWRhdGFSZXF1ZXN0KTogUHJvbWlzZTxNZXRhZGF0YVJlc3BvbnNlPiB7XHJcbiAgICAgICAgICAgIHZhciBkZWZhdWx0TWVtYmVySW5mbzogSUZpbHRlckluZm8gPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fZGVmYXVsdE1lbWJlcikge1xyXG4gICAgICAgICAgICAgICAgIGRlZmF1bHRNZW1iZXJJbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFBhcmVudHNMb29rdXA6IHt9LFxyXG4gICAgICAgICAgICAgICAgICAgIExhc3RMZXZlbE5vZGVzOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICBIYXNNb3JlTWVtYmVyczogZmFsc2VcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIENvbWFyY2guVXRpbHMuVHJlZVV0aWxzLlRyZWVIZWxwZXJzLlRyYXZlcnNlUHJlb3JkZXI8SU1lbWJlck5vZGU+KHRoaXMuX2RlZmF1bHRNZW1iZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgKHgpID0+IHguY2hpbGRyZW4gYXMgSU1lbWJlck5vZGVbXSxcclxuICAgICAgICAgICAgICAgICAgICAoY3VycmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnQuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TWVtYmVySW5mby5MYXN0TGV2ZWxOb2Rlcy5wdXNoKGN1cnJlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lbWJlckluZm8uUGFyZW50c0xvb2t1cFtjdXJyZW50LmlkXSA9IGN1cnJlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC5kYXRhLmNoaWxkcmVuVG90YWxDb3VudCA9IHRoaXMuX2NoaWxkcmVuVG90YWxDb3VudExvb2t1cFtjdXJyZW50LmlkXS5DaGlsZHJlbkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuQ2xlYXJQYXJlbnRzKGRlZmF1bHRNZW1iZXJJbmZvLlBhcmVudHNMb29rdXApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBtZXRhZGF0YSA9IG5ldyBGaWx0ZXJNZXRhZGF0YShyZXF1ZXN0LkZpZWxkVW5pcXVlTmFtZSwgXCJDYWxlbmRhciBUaW1lXCIsIHRoaXMuX3Rlc3RTb3J0ZWRMZXZlbHMsIHRoaXMuX3Rlc3RUcmVlLmxlbmd0aCwgdGhpcy5fdG90YWxFbGVtZW50c0NvdW50LGRlZmF1bHRNZW1iZXJJbmZvKTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBNZXRhZGF0YVJlc3BvbnNlKG1ldGFkYXRhLCB0aGlzLkNsZWFuZWRTdGF0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYXN5bmMgR2V0TWVtYmVycyhyZXF1ZXN0OiBNZW1iZXJzUmVxdWVzdCk6IFByb21pc2U8TWVtYmVyc1Jlc3BvbnNlPiB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLkdldE1lbWJlcnNDb3JlKHRoaXMuR2V0TGV2ZWxOdW1iZXJGcm9tVW5pcXVlTmFtZShyZXF1ZXN0LkZpZWxkVW5pcXVlTmFtZSksIHJlcXVlc3QuU3RhcnQsIHJlcXVlc3QuQ291bnQsIHJlcXVlc3QuRmlsdGVyLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHJldHVybiB7IEZpbHRlckluZm86IHJlc3VsdCB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGFzeW5jIEdldExlYWZNZW1iZXJzKHJlcXVlc3Q6IExlYWZNZW1iZXJzUmVxdWVzdCk6IFByb21pc2U8TWVtYmVyc1Jlc3BvbnNlPiB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLkdldE1lbWJlcnNDb3JlKHRoaXMuR2V0TGV2ZWxOdW1iZXJGcm9tVW5pcXVlTmFtZShyZXF1ZXN0LkZpZWxkVW5pcXVlTmFtZSksIHJlcXVlc3QuU3RhcnQsIHJlcXVlc3QuQ291bnQsIHJlcXVlc3QuRmlsdGVyLCB0cnVlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgRmlsdGVySW5mbzogcmVzdWx0IH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhc3luYyBHZXRDaGlsZHJlbihyZXF1ZXN0OiBDaGlsZHJlblJlcXVlc3QpOiBQcm9taXNlPE1lbWJlcnNSZXNwb25zZT4ge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcclxuICAgICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLkdldENvcHlPZldvcmtpbmdUcmVlKCk7XHJcbiAgICAgICAgICAgIENvbWFyY2guVXRpbHMuVHJlZVV0aWxzLlRyZWVIZWxwZXJzLlRyYXZlcnNlTGlzdFByZW9yZGVyPElNZW1iZXJOb2RlPih0ZW1wLFxyXG4gICAgICAgICAgICAgICAgKHgpID0+IHguY2hpbGRyZW4gYXMgSU1lbWJlck5vZGVbXSxcclxuICAgICAgICAgICAgICAgICh4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHguaWQgPT09IHJlcXVlc3QuUGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5TZWxlY3RTcGVjeWZpY0VsZW1lbnRzKHRoaXMuTWFrZUxhenlMb2FkZWQocmVzdWx0LmNoaWxkcmVuKSwgcmVxdWVzdC5TdGFydCwgcmVxdWVzdC5Db3VudCsxKTtcclxuICAgICAgICAgICAgdmFyIGhhc01vcmVOb2RlcyA9IHRoaXMuSGFzTW9yZU1lbWJlcnMocmVxdWVzdC5Db3VudCwgcmVzdWx0KTtcclxuICAgICAgICAgICAgaWYgKGhhc01vcmVOb2Rlcykge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnBvcCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLkNsZWFyTm90TmVlZGVkRGF0YShyZXN1bHQsIHt9LCBoYXNNb3JlTm9kZXMpO1xyXG4gICAgICAgICAgICByZXR1cm4geyBGaWx0ZXJJbmZvOiByZXN1bHQgfTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYXN5bmMgR2V0RmlsdHJlZEVsZW1lbnRzQ2hpbGRyZW5Db3VudChyZXF1ZXN0OiBGaWx0cmVkRWxlbWVudHNDaGlsZHJlbkNvdW50UmVxdWVzdCk6IFByb21pc2U8RmlsdHJlZEVsZW1lbnRzQ2hpbGRyZW5Db3VudFJlc3BvbnNlPiB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgRmlsdHJlZEVsZW1lbnRzQ2hpbGRyZW5Db3VudFJlc3BvbnNlKCk7XHJcbiAgICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5HZXRDb3B5T2ZXb3JraW5nVHJlZSgpO1xyXG4gICAgICAgICAgICB0ZW1wID0gdGhpcy5TZWFyY2hNZW1iZXJzQ29yZSh0ZW1wLCB0aGlzLkdldExldmVsTnVtYmVyRnJvbVVuaXF1ZU5hbWUocmVxdWVzdC5GaWVsZFVuaXF1ZU5hbWUpLCByZXF1ZXN0LkZpbHRlcik7XHJcbiAgICAgICAgICAgIENvbWFyY2guVXRpbHMuVHJlZVV0aWxzLlRyZWVIZWxwZXJzLlRyYXZlcnNlTGlzdFByZW9yZGVyPElNZW1iZXJOb2RlPih0ZW1wLFxyXG4gICAgICAgICAgICAgICAgKHgpID0+IHguY2hpbGRyZW4gYXMgSU1lbWJlck5vZGVbXSwgXHJcbiAgICAgICAgICAgICAgICAoeCwgcGFyZW50LCBsZXZlbCwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5Ob2Rlc1VuaXF1ZU5hbWVzLmluZGV4T2YoeC5pZCkgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5DaGlsZHJlbkNvdW50SW5mb0xvb2t1cFt4LmlkXSA9IHsgQ2hpbGRyZW5Db3VudDp4LmNoaWxkcmVuLmxlbmd0aCB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsgICAgXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgbmV3IENvbWFyY2guVXRpbHMuVHJlZVV0aWxzLkZvcndhcmRUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5KCksXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhc3luYyBHZXRNZW1iZXJzQnlTdGF0dXMocmVxdWVzdDogR2V0TWVtYmVyc0J5U3RhdHVzUmVxdWVzdCwgc3RhdGVNYW5hZ2VyOiBJRmlsdGVyU3RhdGVNYW5hZ2VyKTogUHJvbWlzZTxNZW1iZXJzUmVzcG9uc2U+IHtcclxuICAgICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLkdldENvcHlPZldvcmtpbmdUcmVlKCk7XHJcbiAgICAgICAgICAgIHZhciBhbGxQYXJlbnRzTG9va3VwOklNZW1iZXJOb2RlTG9va3VwID0ge31cclxuICAgICAgICAgICAgdmFyIHRhcmdldExldmVsRWxlbWVudHNMaXN0OiBJTWVtYmVyTm9kZVtdID0gW107XHJcbiAgICAgICAgICAgIENvbWFyY2guVXRpbHMuVHJlZVV0aWxzLlRyZWVIZWxwZXJzLlRyYXZlcnNlTGlzdFByZW9yZGVyPElNZW1iZXJOb2RlPih0ZW1wLFxyXG4gICAgICAgICAgICAgICAgKHgpID0+IHguY2hpbGRyZW4gYXMgSU1lbWJlck5vZGVbXSwgXHJcbiAgICAgICAgICAgICAgICAoY3VycmVudCwgcGFyZW50LCBsZXZlbCwgaW5kZXgscGFyZW50cykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50LmRhdGEgJiYgY3VycmVudC5kYXRhLmxldmVsID09PSB0aGlzLkdldExldmVsTnVtYmVyRnJvbVVuaXF1ZU5hbWUocmVxdWVzdC5GaWVsZFVuaXF1ZU5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50LmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC5jaGlsZHJlbiA9IDxhbnk+dHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2VsZWN0aW9uU3RhdHVzID0gc3RhdGVNYW5hZ2VyLkdldFNlbGVjdGlvblN0YXR1cyhwYXJlbnRzLm1hcCh4PT54LmlkKS5yZXZlcnNlKCksIGN1cnJlbnQuaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0aW9uU3RhdHVzID09PSBTZWxlY3Rpb25Nb2RlLlNlbGVjdGVkICYmIHJlcXVlc3QuU3RhdHVzID09PSBGaWx0ZXJJdGVtU3RhdGUuQ2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TGV2ZWxFbGVtZW50c0xpc3QucHVzaChjdXJyZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzZWxlY3Rpb25TdGF0dXMgPT09IFNlbGVjdGlvbk1vZGUuRGVzZWxlY3RlZCAmJiByZXF1ZXN0LlN0YXR1cyA9PT0gRmlsdGVySXRlbVN0YXRlLlVuY2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TGV2ZWxFbGVtZW50c0xpc3QucHVzaChjdXJyZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsUGFyZW50c0xvb2t1cFtwYXJlbnQuaWRdID0gcGFyZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBuZXcgQ29tYXJjaC5VdGlscy5UcmVlVXRpbHMuRm9yd2FyZFRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3RvcnkoKSxcclxuICAgICAgICAgICAgICAgIHRydWVcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgRmlsdGVySW5mbzogdGhpcy5HZXRQYWNrYWdlKGFsbFBhcmVudHNMb29rdXAsdGFyZ2V0TGV2ZWxFbGVtZW50c0xpc3QsIHJlcXVlc3QuU3RhcnQsIHJlcXVlc3QuQ291bnQpIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIEdldENvcHlPZldvcmtpbmdUcmVlKCk6SU1lbWJlck5vZGVbXSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldENvcHlPZlRyZWUodGhpcy5fdGVzdFRyZWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBwcml2YXRlIEdldENvcHlPZlRyZWUodHJlZTpJTWVtYmVyTm9kZVtdKTpJTWVtYmVyTm9kZVtdIHtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodHJlZSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNYWtlTGF6eUxvYWRlZChub2RlczogSU1lbWJlck5vZGVbXSkge1xyXG4gICAgICAgICAgICBub2Rlcy5mb3JFYWNoKG5vZGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5jaGlsZHJlbiA9IDxhbnk+dHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgbm9kZS5zdGF0ZTtcclxuICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gbm9kZXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIFNlbGVjdFNwZWN5ZmljRWxlbWVudHMobm9kZXM6SU1lbWJlck5vZGVbXSxzdGFydEluZGV4OiBudW1iZXIsbnVtYmVyT2ZFbGVtZW50czpudW1iZXIpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gc3RhcnRJbmRleDsgaSA8IG5vZGVzLmxlbmd0aCAmJiByZXN1bHQubGVuZ3RoPD1udW1iZXJPZkVsZW1lbnRzLTE7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobm9kZXNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBwcml2YXRlIEdldE1lbWJlcnNDb3JlKHRhcmdldExldmVsTnVtYmVyOiBudW1iZXIsc3RhcnQ6IG51bWJlcixjb3VudDpudW1iZXIsZmlsdGVyOk1lbWJlckZpbHRlciwgb25seUxlYWZzOmJvb2xlYW49ZmFsc2UpOiBJRmlsdGVySW5mbyB7XHJcbiAgICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5HZXRDb3B5T2ZXb3JraW5nVHJlZSgpO1xyXG4gICAgICAgICAgICB0ZW1wID0gdGhpcy5TZWFyY2hNZW1iZXJzQ29yZSh0ZW1wLCB0YXJnZXRMZXZlbE51bWJlciwgZmlsdGVyKTtcclxuICAgICAgICAgICAgdmFyIGFsbFBhcmVudHNMb29rdXA6SU1lbWJlck5vZGVMb29rdXAgPSB7fVxyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0TGV2ZWxFbGVtZW50c0xpc3Q6IElNZW1iZXJOb2RlW10gPSBbXTtcclxuICAgICAgICAgICAgQ29tYXJjaC5VdGlscy5UcmVlVXRpbHMuVHJlZUhlbHBlcnMuVHJhdmVyc2VMaXN0UHJlb3JkZXI8SU1lbWJlck5vZGU+KHRlbXAsXHJcbiAgICAgICAgICAgICAgICAgICAgKHgpID0+IHguY2hpbGRyZW4gYXMgSU1lbWJlck5vZGVbXSwgXHJcbiAgICAgICAgICAgICAgICAgICAgKHgsIHBhcmVudCwgbGV2ZWwsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbmx5TGVhZnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4LmRhdGEgJiYgeC5kYXRhLmNoaWxkcmVuVG90YWxDb3VudD09PTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRMZXZlbEVsZW1lbnRzTGlzdC5wdXNoKHgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHguZGF0YSAmJiB4LmRhdGEubGV2ZWwgPT09IHRhcmdldExldmVsTnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeC5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LmNoaWxkcmVuID0gPGFueT50cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TGV2ZWxFbGVtZW50c0xpc3QucHVzaCh4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsUGFyZW50c0xvb2t1cFtwYXJlbnQuaWRdID0gcGFyZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIG5ldyBDb21hcmNoLlV0aWxzLlRyZWVVdGlscy5Gb3J3YXJkVHJlZVRyYXZlcnNhbEl0ZXJhdG9yRmFjdG9yeSgpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFBhY2thZ2UoYWxsUGFyZW50c0xvb2t1cCwgdGFyZ2V0TGV2ZWxFbGVtZW50c0xpc3QsIHN0YXJ0LCBjb3VudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHByaXZhdGUgR2V0UGFja2FnZShhbGxQYXJlbnRzTG9va3VwOiBJTWVtYmVyTm9kZUxvb2t1cCwgdGFyZ2V0TGV2ZWxFbGVtZW50c0xpc3Q6IElNZW1iZXJOb2RlW10sIHN0YXJ0OiBudW1iZXIsIGNvdW50OiBudW1iZXIpIHtcclxuICAgICAgICAgICAgdmFyIHRhcmdldFBhcmVudHNMb29rdXA6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbjsgfT17fVxyXG4gICAgICAgICAgICB0aGlzLkNsZWFyUGFyZW50cyhhbGxQYXJlbnRzTG9va3VwKTtcclxuICAgICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLlNlbGVjdFNwZWN5ZmljRWxlbWVudHModGFyZ2V0TGV2ZWxFbGVtZW50c0xpc3QsIHN0YXJ0LCBjb3VudCArIDEpO1xyXG4gICAgICAgICAgICB2YXIgaGFzTW9yZU1lbWJlcnMgPSB0aGlzLkhhc01vcmVNZW1iZXJzKGNvdW50LCB0ZW1wKTtcclxuICAgICAgICAgICAgaWYgKGhhc01vcmVNZW1iZXJzKSB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wLnBvcCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRlbXAuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgICAgIFRlc3ROb2RlSGVscGVyLkdldEFsbFBhcmVudHNOYW1lcyhhbGxQYXJlbnRzTG9va3VwLCB4KS5mb3JFYWNoKHBhcmVudE5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFBhcmVudHNMb29rdXBbcGFyZW50TmFtZV0gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gYWxsUGFyZW50c0xvb2t1cCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0YXJnZXRQYXJlbnRzTG9va3VwW2tleV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgYWxsUGFyZW50c0xvb2t1cFtrZXldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAgdGhpcy5DbGVhck5vdE5lZWRlZERhdGEodGVtcCwgYWxsUGFyZW50c0xvb2t1cCwgaGFzTW9yZU1lbWJlcnMpIDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgQ2xlYXJQYXJlbnRzKGFsbFBhcmVudHNMb29rdXA6IElNZW1iZXJOb2RlTG9va3VwKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiBhbGxQYXJlbnRzTG9va3VwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWxsUGFyZW50c0xvb2t1cC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1lbWJlck5vZGUgPSBhbGxQYXJlbnRzTG9va3VwW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lbWJlck5vZGUgJiYgdHlwZW9mIG1lbWJlck5vZGUuY2hpbGRyZW4gIT09IFwiYm9vbGVhblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lbWJlck5vZGUuY2hpbGRyZW4ubGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgQ2xlYXJOb3ROZWVkZWREYXRhKGxhc3RMZXZlbE5vZGVzOiBJTWVtYmVyTm9kZVtdLCBhbGxQYXJlbnRzTG9va3VwOiBJTWVtYmVyTm9kZUxvb2t1cCwgaGFzTW9yZU1lbWJlcnM6IGJvb2xlYW4pOiBJRmlsdGVySW5mbyB7XHJcbiAgICAgICAgICAgIGxhc3RMZXZlbE5vZGVzLmZvckVhY2goeD0+ZGVsZXRlIHguZGF0YS5sZXZlbCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIHBhcmVudEtleSBpbiBhbGxQYXJlbnRzTG9va3VwKSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgYWxsUGFyZW50c0xvb2t1cFtwYXJlbnRLZXldLmRhdGEubGV2ZWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHsgTGFzdExldmVsTm9kZXM6IGxhc3RMZXZlbE5vZGVzLCBQYXJlbnRzTG9va3VwOiBhbGxQYXJlbnRzTG9va3VwLCBIYXNNb3JlTWVtYmVyczogaGFzTW9yZU1lbWJlcnMgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgU2VhcmNoTWVtYmVyc0NvcmUoaW5wdXQ6IElNZW1iZXJOb2RlW10gLHRhcmdldExldmVsTnVtYmVyOiBudW1iZXIsZmlsdGVyOiBNZW1iZXJGaWx0ZXIpOiBJTWVtYmVyTm9kZVtdIHtcclxuICAgICAgICAgICAgaWYgKCFmaWx0ZXIgfHwgIWZpbHRlci5WYWx1ZSkgcmV0dXJuIGlucHV0O1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gaW5wdXQ7XHJcbiAgICAgICAgICAgIHZhciBtYXRjaEZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBtYXRjaENvdW50ZXIgPSAwO1xyXG4gICAgICAgICAgICBDb21hcmNoLlV0aWxzLlRyZWVVdGlscy5UcmVlSGVscGVycy5UcmF2ZXJzZUxpc3RQcmVvcmRlcjxJTWVtYmVyTm9kZT4ocmVzdWx0LFxyXG4gICAgICAgICAgICAgICAgKHgpID0+IHguY2hpbGRyZW4gYXMgSU1lbWJlck5vZGVbXSxcclxuICAgICAgICAgICAgICAgICh4LCBwYXJlbnQsIGxldmVsLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsZXZlbCA9PT0gdGFyZ2V0TGV2ZWxOdW1iZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChmaWx0ZXIuVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1lbWJlckZpbHRlclR5cGUuQ29udGFpbnM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaEZvdW5kID0geC50ZXh0LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihmaWx0ZXIuVmFsdWUudG9Mb3dlckNhc2UoKSkgIT09IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTWVtYmVyRmlsdGVyVHlwZS5CZWdpbnNXaXRoOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hGb3VuZCA9IHgudGV4dC50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoZmlsdGVyLlZhbHVlLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTWVtYmVyRmlsdGVyVHlwZS5FbmRzV2l0aDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoRm91bmQgPSB4LnRleHQudG9Mb3dlckNhc2UoKS5lbmRzV2l0aChmaWx0ZXIuVmFsdWUudG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1hdGNoRm91bmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaENvdW50ZXIrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIGlmICghbWF0Y2hDb3VudGVyKSByZXR1cm4gW107XHJcbiAgICAgICAgICAgIENvbWFyY2guVXRpbHMuVHJlZVV0aWxzLlRyZWVIZWxwZXJzLlRyYXZlcnNlTGlzdFByZW9yZGVyPElNZW1iZXJOb2RlPihyZXN1bHQsXHJcbiAgICAgICAgICAgICAgICAoeCkgPT4geC5jaGlsZHJlbiBhcyBJTWVtYmVyTm9kZVtdLFxyXG4gICAgICAgICAgICAgICAgKHgsIHBhcmVudCwgbGV2ZWwsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxldmVsIDwgdGFyZ2V0TGV2ZWxOdW1iZXIgJiYgIXguY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHByaXZhdGUgQ3JlYXRlSWRzKGlucHV0OiBJTWVtYmVyTm9kZVtdKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBpbnB1dDtcclxuICAgICAgICAgICAgQ29tYXJjaC5VdGlscy5UcmVlVXRpbHMuVHJlZUhlbHBlcnMuVHJhdmVyc2VMaXN0UHJlb3JkZXI8SU1lbWJlck5vZGU+KHJlc3VsdCxcclxuICAgICAgICAgICAgICAgICh4KSA9PiB4LmNoaWxkcmVuIGFzIElNZW1iZXJOb2RlW10sXHJcbiAgICAgICAgICAgICAgICAoeCwgcGFyZW50LCBsZXZlbCwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFydHMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50UGFydCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRQYXJ0ID0gcGFyZW50LmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKHBhcmVudFBhcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKGBbJHt4LnRleHR9XWApO1xyXG4gICAgICAgICAgICAgICAgICAgIHhbXCJpZFwiXSA9IHBhcnRzLmpvaW4oXCIuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBBZGRQYXJlbnRVbmlxdWVOYW1lc19MZXZlbHNfQ2hpbGRDb3VudF9BbmRDYWxjdWxhdGVUb3RhbEVsZW1lbnRzQ291bnQoaW5wdXQ6IElNZW1iZXJOb2RlW10sc3RvcmVHbG9iYWw6Ym9vbGVhbikge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gaW5wdXQ7XHJcbiAgICAgICAgICAgIENvbWFyY2guVXRpbHMuVHJlZVV0aWxzLlRyZWVIZWxwZXJzLlRyYXZlcnNlTGlzdFByZW9yZGVyPElNZW1iZXJOb2RlPihyZXN1bHQsXHJcbiAgICAgICAgICAgICAgICAoeCkgPT4geC5jaGlsZHJlbiBhcyBJTWVtYmVyTm9kZVtdLFxyXG4gICAgICAgICAgICAgICAgKHg6SU1lbWJlck5vZGUsIHBhcmVudCwgbGV2ZWwsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudFVuaXF1ZU5hbWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50VW5pcXVlTmFtZSA9IHBhcmVudC5pZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgeC5kYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRVbmlxdWVOYW1lOiBwYXJlbnRVbmlxdWVOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogbGV2ZWwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuVG90YWxDb3VudDp4LmNoaWxkcmVuLmxlbmd0aFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RvcmVHbG9iYWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hpbGRyZW5Ub3RhbENvdW50TG9va3VwW3guaWRdID0ge0NoaWxkcmVuQ291bnQ6eC5jaGlsZHJlbi5sZW5ndGh9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90b3RhbEVsZW1lbnRzQ291bnQrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvcHkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29weS5jaGlsZHJlbi5sZW5ndGggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLkFsbE1lbWJlcnNMb29rdXBbeC5pZF09Y29weTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgbmV3IENvbWFyY2guVXRpbHMuVHJlZVV0aWxzLkZvcndhcmRUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5KClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgc3RhdGljIENyZWF0ZUZha2VUaW1lSGllcmFyY2h5KG51bWJlck9mWWVhcnM6IG51bWJlcik6SU1lbWJlck5vZGVbXSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQ6SU1lbWJlck5vZGVbXSA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgbW9udGhzID0gW1wiSmFudWFyeVwiLCBcIkZlYnJ1YXJ5XCIsIFwiTWFyY2hcIiwgXCJBcHJpbFwiLCBcIk1heVwiLCBcIkp1bmVcIiwgXCJKdWx5XCIsIFwiQXVndXN0XCIsIFwiU2VwdGVtYmVyXCIsIFwiT2N0b2JlclwiLCBcIk5vdmVtYmVyXCIsXCJEZWNlbWJlclwiXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbnVtYmVyT2ZZZWFyczsgeSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeWVhckl0ZW06IElNZW1iZXJOb2RlID0geyB0ZXh0OiAoMjAwMCArIHkpLnRvU3RyaW5nKCksIGNoaWxkcmVuOiBbXSB9O1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goeWVhckl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgcSA9IDA7IHEgPCA0OyBxKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcXVhdGVySXRlbTogSU1lbWJlck5vZGUgPSB7IHRleHQ6IFwiUVwiICsgKHErMSkudG9TdHJpbmcoKSwgY2hpbGRyZW46IFtdIH07XHJcbiAgICAgICAgICAgICAgICAgICAgeWVhckl0ZW0uY2hpbGRyZW4ucHVzaChxdWF0ZXJJdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBtID0gcSozOyBtIDwgcSozKzM7IG0rKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9udGhJdGVtOiBJTWVtYmVyTm9kZSA9IHsgdGV4dDogbW9udGhzW21dLCBjaGlsZHJlbjogW10gfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcXVhdGVySXRlbS5jaGlsZHJlbi5wdXNoKG1vbnRoSXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGQgPSAwOyBkIDwgMzA7IGQrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRheUl0ZW06IElNZW1iZXJOb2RlID0geyB0ZXh0OiAoZCsxKS50b1N0cmluZygpLCBjaGlsZHJlbjogW10gfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoSXRlbS5jaGlsZHJlbi5wdXNoKGRheUl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIEhhc01vcmVNZW1iZXJzKGNvdW50OiBudW1iZXIsIGxvYWRlZExhc3RMZXZlbE5vZGVzOklNZW1iZXJOb2RlW10pOiBib29sZWFuIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvYWRlZExhc3RMZXZlbE5vZGVzLmxlbmd0aCA9PT0gY291bnQrMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIEdldEZ1bGxEYXRhKCk6IE9iamVjdFtdIHtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5fdGVzdFRyZWUpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUZXN0UGF0aFRyYWNraW5nKCkge1xyXG4gICAgICAgICAgICBDb21hcmNoLlV0aWxzLlRyZWVVdGlscy5UcmVlSGVscGVycy5UcmF2ZXJzZUxpc3RQcmVvcmRlcjxJTWVtYmVyTm9kZT4odGhpcy5HZXRDb3B5T2ZXb3JraW5nVHJlZSgpLFxyXG4gICAgICAgICAgICAgICAgKHgpID0+IHguY2hpbGRyZW4gYXMgSU1lbWJlck5vZGVbXSxcclxuICAgICAgICAgICAgICAgICh4OklNZW1iZXJOb2RlLCBwYXJlbnQsIGxldmVsLCBpbmRleCxwYXRoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh4LmlkLFwiKFwiLHBhdGgubWFwKHg9PnguaWQpLFwiKVwiKTtcclxuICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIG5ldyBDb21hcmNoLlV0aWxzLlRyZWVVdGlscy5Gb3J3YXJkVHJlZVRyYXZlcnNhbEl0ZXJhdG9yRmFjdG9yeSgpLFxyXG4gICAgICAgICAgICAgICAgdHJ1ZVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG5cclxuIl19