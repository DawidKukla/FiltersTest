var Comarch;
(function (Comarch) {
    var Controls;
    (function (Controls) {
        var FilterControlModule;
        (function (FilterControlModule) {
            var Helpers;
            (function (Helpers) {
                var FilterType = Controls.FilterControlModule.FilterStateManagerModule.Common.FilterType;
                class IntersectionCalculatorFactory {
                    Create(a, b) { return new IntersectionCalculator(a, b); }
                }
                Helpers.IntersectionCalculatorFactory = IntersectionCalculatorFactory;
                class IntersectionPair {
                    constructor(A, B) {
                        this.A = A;
                        this.B = B;
                    }
                }
                class IntersectionCalculator {
                    constructor(a, b) {
                        this._b = b;
                        this._a = a;
                    }
                    Intersect() {
                        return this.IntersectCore(this._a, this._b);
                    }
                    IntersectCore(a, b) {
                        if (a == null)
                            return null;
                        if (b == null)
                            return null;
                        if (a.UniqueName !== b.UniqueName)
                            return null;
                        if (a.Children.length === 0)
                            return this.CloneFilterItem(b, true);
                        if (b.Children.length === 0)
                            return this.CloneFilterItem(a, true);
                        const pairs = this.IntersectChildren(a, b);
                        if (pairs.length === 0)
                            return null;
                        var children = [];
                        pairs.forEach((pair) => {
                            var child = this.IntersectCore(pair.A, pair.B);
                            if (child != null) {
                                children.push(child);
                            }
                        });
                        if (children.length === 0)
                            return null;
                        var result = this.CloneFilterItem(a, false);
                        children.forEach(child => { result.Children.push(child); });
                        return result;
                    }
                    IntersectChildren(a, b) {
                        var result;
                        var aSet = {};
                        a.Children.forEach(x => aSet[x.UniqueName] = x);
                        var bSet = {};
                        b.Children.forEach(x => bSet[x.UniqueName] = x);
                        if ((a.Type === FilterType.Included && b.Type === FilterType.Included)) {
                            result = Enumerable.from(a.Children).intersect(b.Children, x => x.UniqueName).select(x => new IntersectionPair(aSet[x.UniqueName], bSet[x.UniqueName])).toArray();
                        }
                        else if (a.Type === FilterType.Excluded && b.Type === FilterType.Excluded) {
                            result = Enumerable.from(a.Children).union(b.Children, x => x.UniqueName).select(x => new IntersectionPair(aSet[x.UniqueName], bSet[x.UniqueName])).toArray();
                        }
                        else {
                        }
                        return result;
                    }
                    CloneFilterItem(obj, deep) {
                        var clone = { UniqueName: obj.UniqueName, Type: obj.Type, Children: obj.Children };
                        if (deep) {
                            obj.Children.forEach(child => {
                                clone.Children.push(this.CloneFilterItem(child, deep));
                            });
                        }
                        return clone;
                    }
                }
                Helpers.IntersectionCalculator = IntersectionCalculator;
            })(Helpers = FilterControlModule.Helpers || (FilterControlModule.Helpers = {}));
        })(FilterControlModule = Controls.FilterControlModule || (Controls.FilterControlModule = {}));
    })(Controls = Comarch.Controls || (Comarch.Controls = {}));
})(Comarch || (Comarch = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJzZWN0aW9uQ2FsY3VsYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkludGVyc2VjdGlvbkNhbGN1bGF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBVSxPQUFPLENBOEdoQjtBQTlHRCxXQUFVLE9BQU87SUFBQyxJQUFBLFFBQVEsQ0E4R3pCO0lBOUdpQixXQUFBLFFBQVE7UUFBQyxJQUFBLG1CQUFtQixDQThHN0M7UUE5RzBCLFdBQUEsbUJBQW1CO1lBQUMsSUFBQSxPQUFPLENBOEdyRDtZQTlHOEMsV0FBQSxPQUFPO2dCQUVsRCxJQUFPLFVBQVUsR0FBRyxRQUFRLENBQUMsbUJBQW1CLENBQUMsd0JBQXdCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQztnQkFNNUY7b0JBQ0ksTUFBTSxDQUFDLENBQWMsRUFBRSxDQUFjLElBQTZCLE9BQU8sSUFBSSxzQkFBc0IsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUMvRztnQkFGYSxxQ0FBNkIsZ0NBRTFDLENBQUE7Z0JBTUQ7b0JBQ0ksWUFBbUIsQ0FBSSxFQUFTLENBQUk7d0JBQWpCLE1BQUMsR0FBRCxDQUFDLENBQUc7d0JBQVMsTUFBQyxHQUFELENBQUMsQ0FBRztvQkFBRyxDQUFDO2lCQUMzQztnQkFNRDtvQkFJSSxZQUFZLENBQWMsRUFBQyxDQUFhO3dCQUNwQyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQzt3QkFDWixJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztvQkFDaEIsQ0FBQztvQkFFTSxTQUFTO3dCQUNaLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztvQkFDaEQsQ0FBQztvQkFFTyxhQUFhLENBQUksQ0FBYSxFQUFDLENBQWM7d0JBQ2pELElBQUksQ0FBQyxJQUFJLElBQUk7NEJBQ1QsT0FBTyxJQUFJLENBQUM7d0JBQ2hC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QUFELENBQUMsRUE5R1MsT0FBTyxLQUFQLE9BQU8sUUE4R2hCIiwic291cmNlc0NvbnRlbnQiOlsibmFtZXNwYWNlIENvbWFyY2guQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5IZWxwZXJzIHtcclxuICAgIGltcG9ydCBJRmlsdGVySXRlbSA9IEZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vbi5JRmlsdGVySXRlbTtcclxuICAgIGltcG9ydCBGaWx0ZXJUeXBlID0gQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLkZpbHRlclR5cGU7XHJcblxyXG4gICAgZXhwb3J0IGludGVyZmFjZSBJSW50ZXJzZWN0aW9uQ2FsY3VsYXRvckZhY3Rvcnkge1xyXG4gICAgICAgIENyZWF0ZShhOiBJRmlsdGVySXRlbSxiOklGaWx0ZXJJdGVtKTpJSW50ZXJzZWN0aW9uQ2FsY3VsYXRvcjtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgIGNsYXNzIEludGVyc2VjdGlvbkNhbGN1bGF0b3JGYWN0b3J5IGltcGxlbWVudHMgSUludGVyc2VjdGlvbkNhbGN1bGF0b3JGYWN0b3J5IHtcclxuICAgICAgICBDcmVhdGUoYTogSUZpbHRlckl0ZW0sIGI6IElGaWx0ZXJJdGVtKTogSUludGVyc2VjdGlvbkNhbGN1bGF0b3IgeyByZXR1cm4gbmV3IEludGVyc2VjdGlvbkNhbGN1bGF0b3IoYSwgYik7IH1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElJbnRlcnNlY3Rpb25DYWxjdWxhdG9yIHtcclxuICAgICAgICBJbnRlcnNlY3QoKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGFzcyBJbnRlcnNlY3Rpb25QYWlyPFQ+IHtcclxuICAgICAgICBjb25zdHJ1Y3RvcihwdWJsaWMgQTogVCwgcHVibGljIEI6IFQpIHt9XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRmlsdGVySXRlbUxvb2t1cCB7XHJcbiAgICAgICAgW2tleTpzdHJpbmddOklGaWx0ZXJJdGVtXHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIEludGVyc2VjdGlvbkNhbGN1bGF0b3IgaW1wbGVtZW50cyBJSW50ZXJzZWN0aW9uQ2FsY3VsYXRvciB7XHJcbiAgICAgICAgcHJpdmF0ZSBfYjtcclxuICAgICAgICBwcml2YXRlIF9hO1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3RvcihhOiBJRmlsdGVySXRlbSxiOklGaWx0ZXJJdGVtKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2IgPSBiO1xyXG4gICAgICAgICAgICB0aGlzLl9hID0gYTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBJbnRlcnNlY3QoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLkludGVyc2VjdENvcmUodGhpcy5fYSwgdGhpcy5fYik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIEludGVyc2VjdENvcmU8VD4oYTpJRmlsdGVySXRlbSxiOiBJRmlsdGVySXRlbSkgOklGaWx0ZXJJdGVtIHtcclxuICAgICAgICAgICAgaWYgKGEgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICBpZiAoYiA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIGlmIChhLlVuaXF1ZU5hbWUgIT09IGIuVW5pcXVlTmFtZSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICBpZiAoYS5DaGlsZHJlbi5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5DbG9uZUZpbHRlckl0ZW0oYiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGlmIChiLkNoaWxkcmVuLmxlbmd0aCA9PT0gMClcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkNsb25lRmlsdGVySXRlbShhLCB0cnVlKTtcclxuICAgICAgICAgICAgY29uc3QgcGFpcnMgPSB0aGlzLkludGVyc2VjdENoaWxkcmVuKGEsIGIpO1xyXG4gICAgICAgICAgICBpZiAocGFpcnMubGVuZ3RoID09PSAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbjogQXJyYXk8SUZpbHRlckl0ZW0+ID0gW107XHJcbiAgICAgICAgICAgIHBhaXJzLmZvckVhY2goKHBhaXIpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IHRoaXMuSW50ZXJzZWN0Q29yZTxUPihwYWlyLkEsIHBhaXIuQik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMClcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5DbG9uZUZpbHRlckl0ZW0oYSwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IHsgcmVzdWx0LkNoaWxkcmVuLnB1c2goY2hpbGQpIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBJbnRlcnNlY3RDaGlsZHJlbjxUPihhOiBJRmlsdGVySXRlbSwgYjogSUZpbHRlckl0ZW0pOiBBcnJheTxJbnRlcnNlY3Rpb25QYWlyPElGaWx0ZXJJdGVtPj4ge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0OiBJbnRlcnNlY3Rpb25QYWlyPElGaWx0ZXJJdGVtPltdO1xyXG4gICAgICAgICAgICB2YXIgYVNldDogSUZpbHRlckl0ZW1Mb29rdXAgPSB7fTtcclxuICAgICAgICAgICAgYS5DaGlsZHJlbi5mb3JFYWNoKHggPT4gYVNldFt4LlVuaXF1ZU5hbWVdID0geCk7XHJcbiAgICAgICAgICAgIHZhciBiU2V0OiBJRmlsdGVySXRlbUxvb2t1cCA9IHt9O1xyXG4gICAgICAgICAgICBiLkNoaWxkcmVuLmZvckVhY2goeCA9PiBiU2V0W3guVW5pcXVlTmFtZV0gPSB4KTtcclxuXHJcbiAgICAgICAgICAgIGlmICgoYS5UeXBlID09PSBGaWx0ZXJUeXBlLkluY2x1ZGVkICYmIGIuVHlwZSA9PT0gRmlsdGVyVHlwZS5JbmNsdWRlZCkpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9ICBFbnVtZXJhYmxlLmZyb20oYS5DaGlsZHJlbikuaW50ZXJzZWN0KGIuQ2hpbGRyZW4sIHggPT4geC5VbmlxdWVOYW1lKS5zZWxlY3QoeCA9PiBuZXcgSW50ZXJzZWN0aW9uUGFpcihhU2V0W3guVW5pcXVlTmFtZV0sIGJTZXRbeC5VbmlxdWVOYW1lXSkpLnRvQXJyYXkoKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKGEuVHlwZSA9PT0gRmlsdGVyVHlwZS5FeGNsdWRlZCAmJiBiLlR5cGUgPT09IEZpbHRlclR5cGUuRXhjbHVkZWQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9ICBFbnVtZXJhYmxlLmZyb20oYS5DaGlsZHJlbikudW5pb24oYi5DaGlsZHJlbiwgeCA9PiB4LlVuaXF1ZU5hbWUpLnNlbGVjdCh4ID0+IG5ldyBJbnRlcnNlY3Rpb25QYWlyKGFTZXRbeC5VbmlxdWVOYW1lXSwgYlNldFt4LlVuaXF1ZU5hbWVdKSkudG9BcnJheSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy9pZiAoYS5UeXBlID09PSBGaWx0ZXJUeXBlLkluY2x1ZGVkICYmIGIuVHlwZSA9PT0gRmlsdGVyVHlwZS5FeGNsdWRlZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgaWYgKGEuQ2hpbGRyZW4ubGVuZ3RoID49IGIuQ2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICByZXN1bHQgPSBFbnVtZXJhYmxlLmZyb20oYS5DaGlsZHJlbikuZXhjZXB0KGIuQ2hpbGRyZW4seD0+eC5VbmlxdWVOYW1lKS5zZWxlY3QoeD0+bmV3IEludGVyc2VjdGlvblBhaXIoeCx4KSkudG9BcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICByZXN1bHQgPSBFbnVtZXJhYmxlLmZyb20oYi5DaGlsZHJlbikuZXhjZXB0KGEuQ2hpbGRyZW4seD0+eC5VbmlxdWVOYW1lKS5zZWxlY3QoeD0+bmV3IEludGVyc2VjdGlvblBhaXIoeCx4KSkudG9BcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgfVxyXG4gICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICAvL2lmIChhLlR5cGUgPT09IEZpbHRlclR5cGUuRXhjbHVkZWQgJiYgYi5UeXBlID09PSBGaWx0ZXJUeXBlLkluY2x1ZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBpZiAoYS5DaGlsZHJlbi5sZW5ndGggPj0gYi5DaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICByZXN1bHQgPSBFbnVtZXJhYmxlLmZyb20oYS5DaGlsZHJlbikuZXhjZXB0KGIuQ2hpbGRyZW4seD0+eC5VbmlxdWVOYW1lKS5zZWxlY3QoeD0+bmV3IEludGVyc2VjdGlvblBhaXIoeCx4KSkudG9BcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICByZXN1bHQgPSBFbnVtZXJhYmxlLmZyb20oYi5DaGlsZHJlbikuZXhjZXB0KGEuQ2hpbGRyZW4seD0+eC5VbmlxdWVOYW1lKS5zZWxlY3QoeD0+bmV3IEludGVyc2VjdGlvblBhaXIoeCx4KSkudG9BcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgfVxyXG4gICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIENsb25lRmlsdGVySXRlbShvYmo6SUZpbHRlckl0ZW0sZGVlcDogYm9vbGVhbik6SUZpbHRlckl0ZW0ge1xyXG4gICAgICAgICAgICB2YXIgY2xvbmU6IElGaWx0ZXJJdGVtID0geyBVbmlxdWVOYW1lOiBvYmouVW5pcXVlTmFtZSwgVHlwZTogb2JqLlR5cGUsIENoaWxkcmVuOiBvYmouQ2hpbGRyZW4gfTtcclxuICAgICAgICAgICAgaWYgKGRlZXApIHtcclxuICAgICAgICAgICAgICAgIG9iai5DaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjbG9uZS5DaGlsZHJlbi5wdXNoKHRoaXMuQ2xvbmVGaWx0ZXJJdGVtKGNoaWxkLCBkZWVwKSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY2xvbmU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgXHJcbn0iXX0=