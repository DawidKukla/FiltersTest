var Comarch;
(function (Comarch) {
    var Controls;
    (function (Controls) {
        var FilterControlModule;
        (function (FilterControlModule) {
            var Helpers;
            (function (Helpers) {
                var FilterType = Controls.FilterControlModule.FilterStateManagerModule.Common.FilterType;
                class IntersectionCalculatorFactory {
                    Create(a, b) { return new IntersectionCalculator(a, b); }
                }
                Helpers.IntersectionCalculatorFactory = IntersectionCalculatorFactory;
                class IntersectionPair {
                    constructor(A, B) {
                        this.A = A;
                        this.B = B;
                    }
                }
                class IntersectionCalculator {
                    constructor(a, b) {
                        this._b = b;
                        this._a = a;
                    }
                    Intersect() {
                        return this.IntersectCore(this._a, this._b);
                    }
                    IntersectCore(a, b) {
                        if (a == null)
                            return null;
                        if (b == null)
                            return null;
                        if (a.UniqueName !== b.UniqueName)
                            return null;
                        if (a.Children.length === 0)
                            return this.CloneFilterItem(b, true);
                        if (b.Children.length === 0)
                            return this.CloneFilterItem(a, true);
                        const pairs = this.IntersectChildren(a, b);
                        if (pairs.length === 0)
                            return null;
                        var children = [];
                        pairs.forEach((pair) => {
                            var child = this.IntersectCore(pair.A, pair.B);
                            if (child != null) {
                                children.push(child);
                            }
                        });
                        if (children.length === 0)
                            return null;
                        var result = this.CloneFilterItem(a, false);
                        children.forEach(child => { result.Children.push(child); });
                        return result;
                    }
                    IntersectChildren(a, b) {
                        var result;
                        var aSet = {};
                        a.Children.forEach(x => aSet[x.UniqueName] = x);
                        var bSet = {};
                        b.Children.forEach(x => bSet[x.UniqueName] = x);
                        if ((a.Type === FilterType.Included && b.Type === FilterType.Included)) {
                            result = Enumerable.from(a.Children).intersect(b.Children, x => x.UniqueName).select(x => new IntersectionPair(aSet[x.UniqueName], bSet[x.UniqueName])).toArray();
                        }
                        else if (a.Type === FilterType.Excluded && b.Type === FilterType.Excluded) {
                            result = Enumerable.from(a.Children).union(b.Children, x => x.UniqueName).select(x => new IntersectionPair(aSet[x.UniqueName], bSet[x.UniqueName])).toArray();
                        }
                        else {
                        }
                        return result;
                    }
                    CloneFilterItem(obj, deep) {
                        var clone = { UniqueName: obj.UniqueName, Type: obj.Type, Children: obj.Children };
                        if (deep) {
                            obj.Children.forEach(child => {
                                clone.Children.push(this.CloneFilterItem(child, deep));
                            });
                        }
                        return clone;
                    }
                }
                Helpers.IntersectionCalculator = IntersectionCalculator;
            })(Helpers = FilterControlModule.Helpers || (FilterControlModule.Helpers = {}));
        })(FilterControlModule = Controls.FilterControlModule || (Controls.FilterControlModule = {}));
    })(Controls = Comarch.Controls || (Comarch.Controls = {}));
})(Comarch || (Comarch = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJzZWN0aW9uQ2FsY3VsYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkludGVyc2VjdGlvbkNhbGN1bGF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBVSxPQUFPLENBOEdoQjtBQTlHRCxXQUFVLE9BQU87SUFBQyxJQUFBLFFBQVEsQ0E4R3pCO0lBOUdpQixXQUFBLFFBQVE7UUFBQyxJQUFBLG1CQUFtQixDQThHN0M7UUE5RzBCLFdBQUEsbUJBQW1CO1lBQUMsSUFBQSxPQUFPLENBOEdyRDtZQTlHOEMsV0FBQSxPQUFPO2dCQUVsRCxJQUFPLFVBQVUsR0FBRyxRQUFRLENBQUMsbUJBQW1CLENBQUMsd0JBQXdCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQztnQkFNNUY7b0JBQ0ksTUFBTSxDQUFDLENBQWMsRUFBRSxDQUFjLElBQTZCLE1BQU0sQ0FBQyxJQUFJLHNCQUFzQixDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQy9HO2dCQUZhLHFDQUE2QixnQ0FFMUMsQ0FBQTtnQkFNRDtvQkFDSSxZQUFtQixDQUFJLEVBQVMsQ0FBSTt3QkFBakIsTUFBQyxHQUFELENBQUMsQ0FBRzt3QkFBUyxNQUFDLEdBQUQsQ0FBQyxDQUFHO29CQUFHLENBQUM7aUJBQzNDO2dCQU1EO29CQUlJLFlBQVksQ0FBYyxFQUFDLENBQWE7d0JBQ3BDLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO3dCQUNaLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO29CQUNoQixDQUFDO29CQUVNLFNBQVM7d0JBQ1osTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7b0JBQ2hELENBQUM7b0JBRU8sYUFBYSxDQUFJLENBQWEsRUFBQyxDQUFjO3dCQUNqRCxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDOzRC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QyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQzs0QkFDM0QsQ0FBQyxDQUFDLENBQUM7d0JBQ1AsQ0FBQzt3QkFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO29CQUNqQixDQUFDO2lCQUVKO2dCQW5GWSw4QkFBc0IseUJBbUZsQyxDQUFBO1lBR0wsQ0FBQyxFQTlHOEMsT0FBTyxHQUFQLDJCQUFPLEtBQVAsMkJBQU8sUUE4R3JEO1FBQUQsQ0FBQyxFQTlHMEIsbUJBQW1CLEdBQW5CLDRCQUFtQixLQUFuQiw0QkFBbUIsUUE4RzdDO0lBQUQsQ0FBQyxFQTlHaUIsUUFBUSxHQUFSLGdCQUFRLEtBQVIsZ0JBQVEsUUE4R3pCO0FBQUQsQ0FBQyxFQTlHUyxPQUFPLEtBQVAsT0FBTyxRQThHaEIiLCJzb3VyY2VzQ29udGVudCI6WyJuYW1lc3BhY2UgQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkhlbHBlcnMge1xyXG4gICAgaW1wb3J0IElGaWx0ZXJJdGVtID0gRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLklGaWx0ZXJJdGVtO1xyXG4gICAgaW1wb3J0IEZpbHRlclR5cGUgPSBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uRmlsdGVyVHlwZTtcclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElJbnRlcnNlY3Rpb25DYWxjdWxhdG9yRmFjdG9yeSB7XHJcbiAgICAgICAgQ3JlYXRlKGE6IElGaWx0ZXJJdGVtLGI6SUZpbHRlckl0ZW0pOklJbnRlcnNlY3Rpb25DYWxjdWxhdG9yO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCAgY2xhc3MgSW50ZXJzZWN0aW9uQ2FsY3VsYXRvckZhY3RvcnkgaW1wbGVtZW50cyBJSW50ZXJzZWN0aW9uQ2FsY3VsYXRvckZhY3Rvcnkge1xyXG4gICAgICAgIENyZWF0ZShhOiBJRmlsdGVySXRlbSwgYjogSUZpbHRlckl0ZW0pOiBJSW50ZXJzZWN0aW9uQ2FsY3VsYXRvciB7IHJldHVybiBuZXcgSW50ZXJzZWN0aW9uQ2FsY3VsYXRvcihhLCBiKTsgfVxyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUludGVyc2VjdGlvbkNhbGN1bGF0b3Ige1xyXG4gICAgICAgIEludGVyc2VjdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsYXNzIEludGVyc2VjdGlvblBhaXI8VD4ge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBBOiBULCBwdWJsaWMgQjogVCkge31cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElGaWx0ZXJJdGVtTG9va3VwIHtcclxuICAgICAgICBba2V5OnN0cmluZ106SUZpbHRlckl0ZW1cclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgSW50ZXJzZWN0aW9uQ2FsY3VsYXRvciBpbXBsZW1lbnRzIElJbnRlcnNlY3Rpb25DYWxjdWxhdG9yIHtcclxuICAgICAgICBwcml2YXRlIF9iO1xyXG4gICAgICAgIHByaXZhdGUgX2E7XHJcblxyXG4gICAgICAgIGNvbnN0cnVjdG9yKGE6IElGaWx0ZXJJdGVtLGI6SUZpbHRlckl0ZW0pIHtcclxuICAgICAgICAgICAgdGhpcy5fYiA9IGI7XHJcbiAgICAgICAgICAgIHRoaXMuX2EgPSBhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEludGVyc2VjdCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuSW50ZXJzZWN0Q29yZSh0aGlzLl9hLCB0aGlzLl9iKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgSW50ZXJzZWN0Q29yZTxUPihhOklGaWx0ZXJJdGVtLGI6IElGaWx0ZXJJdGVtKSA6SUZpbHRlckl0ZW0ge1xyXG4gICAgICAgICAgICBpZiAoYSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIGlmIChiID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgaWYgKGEuVW5pcXVlTmFtZSAhPT0gYi5VbmlxdWVOYW1lKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIGlmIChhLkNoaWxkcmVuLmxlbmd0aCA9PT0gMClcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkNsb25lRmlsdGVySXRlbShiLCB0cnVlKTtcclxuICAgICAgICAgICAgaWYgKGIuQ2hpbGRyZW4ubGVuZ3RoID09PSAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQ2xvbmVGaWx0ZXJJdGVtKGEsIHRydWUpO1xyXG4gICAgICAgICAgICBjb25zdCBwYWlycyA9IHRoaXMuSW50ZXJzZWN0Q2hpbGRyZW4oYSwgYik7XHJcbiAgICAgICAgICAgIGlmIChwYWlycy5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgdmFyIGNoaWxkcmVuOiBBcnJheTxJRmlsdGVySXRlbT4gPSBbXTtcclxuICAgICAgICAgICAgcGFpcnMuZm9yRWFjaCgocGFpcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gdGhpcy5JbnRlcnNlY3RDb3JlPFQ+KHBhaXIuQSwgcGFpci5CKTtcclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLkNsb25lRmlsdGVySXRlbShhLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGNoaWxkcmVuLmZvckVhY2goY2hpbGQgPT4geyByZXN1bHQuQ2hpbGRyZW4ucHVzaChjaGlsZCkgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIEludGVyc2VjdENoaWxkcmVuPFQ+KGE6IElGaWx0ZXJJdGVtLCBiOiBJRmlsdGVySXRlbSk6IEFycmF5PEludGVyc2VjdGlvblBhaXI8SUZpbHRlckl0ZW0+PiB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQ6IEludGVyc2VjdGlvblBhaXI8SUZpbHRlckl0ZW0+W107XHJcbiAgICAgICAgICAgIHZhciBhU2V0OiBJRmlsdGVySXRlbUxvb2t1cCA9IHt9O1xyXG4gICAgICAgICAgICBhLkNoaWxkcmVuLmZvckVhY2goeCA9PiBhU2V0W3guVW5pcXVlTmFtZV0gPSB4KTtcclxuICAgICAgICAgICAgdmFyIGJTZXQ6IElGaWx0ZXJJdGVtTG9va3VwID0ge307XHJcbiAgICAgICAgICAgIGIuQ2hpbGRyZW4uZm9yRWFjaCh4ID0+IGJTZXRbeC5VbmlxdWVOYW1lXSA9IHgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKChhLlR5cGUgPT09IEZpbHRlclR5cGUuSW5jbHVkZWQgJiYgYi5UeXBlID09PSBGaWx0ZXJUeXBlLkluY2x1ZGVkKSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gIEVudW1lcmFibGUuZnJvbShhLkNoaWxkcmVuKS5pbnRlcnNlY3QoYi5DaGlsZHJlbiwgeCA9PiB4LlVuaXF1ZU5hbWUpLnNlbGVjdCh4ID0+IG5ldyBJbnRlcnNlY3Rpb25QYWlyKGFTZXRbeC5VbmlxdWVOYW1lXSwgYlNldFt4LlVuaXF1ZU5hbWVdKSkudG9BcnJheSgpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYoYS5UeXBlID09PSBGaWx0ZXJUeXBlLkV4Y2x1ZGVkICYmIGIuVHlwZSA9PT0gRmlsdGVyVHlwZS5FeGNsdWRlZCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gIEVudW1lcmFibGUuZnJvbShhLkNoaWxkcmVuKS51bmlvbihiLkNoaWxkcmVuLCB4ID0+IHguVW5pcXVlTmFtZSkuc2VsZWN0KHggPT4gbmV3IEludGVyc2VjdGlvblBhaXIoYVNldFt4LlVuaXF1ZU5hbWVdLCBiU2V0W3guVW5pcXVlTmFtZV0pKS50b0FycmF5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL2lmIChhLlR5cGUgPT09IEZpbHRlclR5cGUuSW5jbHVkZWQgJiYgYi5UeXBlID09PSBGaWx0ZXJUeXBlLkV4Y2x1ZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBpZiAoYS5DaGlsZHJlbi5sZW5ndGggPj0gYi5DaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgIHJlc3VsdCA9IEVudW1lcmFibGUuZnJvbShhLkNoaWxkcmVuKS5leGNlcHQoYi5DaGlsZHJlbix4PT54LlVuaXF1ZU5hbWUpLnNlbGVjdCh4PT5uZXcgSW50ZXJzZWN0aW9uUGFpcih4LHgpKS50b0FycmF5KCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIHJlc3VsdCA9IEVudW1lcmFibGUuZnJvbShiLkNoaWxkcmVuKS5leGNlcHQoYS5DaGlsZHJlbix4PT54LlVuaXF1ZU5hbWUpLnNlbGVjdCh4PT5uZXcgSW50ZXJzZWN0aW9uUGFpcih4LHgpKS50b0FycmF5KCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgICAgIC8vaWYgKGEuVHlwZSA9PT0gRmlsdGVyVHlwZS5FeGNsdWRlZCAmJiBiLlR5cGUgPT09IEZpbHRlclR5cGUuSW5jbHVkZWQpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIGlmIChhLkNoaWxkcmVuLmxlbmd0aCA+PSBiLkNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIHJlc3VsdCA9IEVudW1lcmFibGUuZnJvbShhLkNoaWxkcmVuKS5leGNlcHQoYi5DaGlsZHJlbix4PT54LlVuaXF1ZU5hbWUpLnNlbGVjdCh4PT5uZXcgSW50ZXJzZWN0aW9uUGFpcih4LHgpKS50b0FycmF5KCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIHJlc3VsdCA9IEVudW1lcmFibGUuZnJvbShiLkNoaWxkcmVuKS5leGNlcHQoYS5DaGlsZHJlbix4PT54LlVuaXF1ZU5hbWUpLnNlbGVjdCh4PT5uZXcgSW50ZXJzZWN0aW9uUGFpcih4LHgpKS50b0FycmF5KCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgQ2xvbmVGaWx0ZXJJdGVtKG9iajpJRmlsdGVySXRlbSxkZWVwOiBib29sZWFuKTpJRmlsdGVySXRlbSB7XHJcbiAgICAgICAgICAgIHZhciBjbG9uZTogSUZpbHRlckl0ZW0gPSB7IFVuaXF1ZU5hbWU6IG9iai5VbmlxdWVOYW1lLCBUeXBlOiBvYmouVHlwZSwgQ2hpbGRyZW46IG9iai5DaGlsZHJlbiB9O1xyXG4gICAgICAgICAgICBpZiAoZGVlcCkge1xyXG4gICAgICAgICAgICAgICAgb2JqLkNoaWxkcmVuLmZvckVhY2goY2hpbGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNsb25lLkNoaWxkcmVuLnB1c2godGhpcy5DbG9uZUZpbHRlckl0ZW0oY2hpbGQsIGRlZXApKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjbG9uZTtcclxuICAgICAgICB9XHJcbiAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBcclxufSJdfQ==