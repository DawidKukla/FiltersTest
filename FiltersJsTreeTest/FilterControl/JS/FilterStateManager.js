var Comarch;
(function (Comarch) {
    var Controls;
    (function (Controls) {
        var FilterControlModule;
        (function (FilterControlModule) {
            var FilterStateManagerModule;
            (function (FilterStateManagerModule) {
                var TreeHelpers = Comarch.Utils.TreeUtils.TreeHelpers;
                var ForwardTreeTraversalIteratorFactory = Comarch.Utils.TreeUtils.ForwardTreeTraversalIteratorFactory;
                var AffectedNodesSet = FilterControlModule.Common.AffectedNodesSet;
                var BackwardTreeTraversalIteratorFactory = Comarch.Utils.TreeUtils.BackwardTreeTraversalIteratorFactory;
                class FilterStateManagerFactory {
                    Create(rootType, childrenTotalCount, isFiltred) {
                        return new FilterStateManager(rootType, childrenTotalCount, isFiltred);
                    }
                }
                FilterStateManagerModule.FilterStateManagerFactory = FilterStateManagerFactory;
                class FilterStateManager {
                    constructor(rootType, childrenTotalCount, _isFiltred) {
                        this._isFiltred = _isFiltred;
                        this._root = this.GetEmptyRootItem(rootType);
                        this._root.ChildrenTotalCount = childrenTotalCount;
                        this._root.AllItemsLookup = {};
                        this._root.AllItemsLookup[this._root.UniqueName] = this._root;
                    }
                    get Root() { return this._root; }
                    ;
                    get IsFiltred() { return this._isFiltred; }
                    ;
                    GetEmptyRootItem(rootType) {
                        return new ExtendedFilterItem("#", null, -1, -1, -1, this, rootType);
                    }
                    AddNodes(sortedParents, targetNode, isSelected, autoRefresh, iteratorFactory = new BackwardTreeTraversalIteratorFactory()) {
                        var affectedNodes = new AffectedNodesSet();
                        let iterator = iteratorFactory.Create(sortedParents);
                        while (iterator.MoveNext()) {
                            this.AddNode(iterator.Current, isSelected, false, affectedNodes, autoRefresh);
                        }
                        this.AddNode(targetNode, isSelected, true, affectedNodes, autoRefresh);
                        return affectedNodes;
                    }
                    AddNode(node, isSelected, isTargetNode, affectedNodesSet, autoRefresh) {
                        const existingNode = this._root.AllItemsLookup[node.UniqueName];
                        const existingParentNode = this._root.AllItemsLookup[node.ParentUniqueName];
                        if (!existingNode) {
                            if (existingParentNode) {
                                existingParentNode.AddChild(node, isSelected, isTargetNode);
                                if (isTargetNode) {
                                    node.HandleSelectionChange(isSelected, isTargetNode, affectedNodesSet, autoRefresh);
                                }
                            }
                            else {
                                throw new Error("Can not add node to not existing parent.");
                            }
                            return false;
                        }
                        else {
                            if (isTargetNode) {
                                existingNode.HandleSelectionChange(isSelected, true, affectedNodesSet, autoRefresh);
                            }
                        }
                        return true;
                    }
                    Reset(isSelect) {
                        this._root.RemoveAllChildren();
                        this._root.Type = isSelect ? Controls.FilterControlModule.FilterStateManagerModule.Common.FilterType.Excluded : Controls.FilterControlModule.FilterStateManagerModule.Common.FilterType.Included;
                        return AffectedNodesSet.Empty.Add("#");
                    }
                    GetState() { return this._root; }
                    Serialize() {
                        const result = TreeHelpers.Convert(this._root, x => x.ChildrenArray, x => x.Children, (current) => {
                            const result = { Type: current.Type, UniqueName: current.UniqueName, Children: [] };
                            return result;
                        });
                        return result;
                    }
                    Deserialize(serializedRoot, rootElementsCount, cleanedStateInfo, clean = true) {
                        var lookup = {};
                        this._root = TreeHelpers.Convert(serializedRoot, x => x.Children, x => null, (current, parent, cp, level) => {
                            var newChildrenTotalCount = -1;
                            var parentUniqueName = parent ? parent.UniqueName : null;
                            if (clean) {
                                if (parent) {
                                    let refreshedNode = cleanedStateInfo.ExistingMembersHierarchyLookup[current.UniqueName];
                                    if (refreshedNode) {
                                        newChildrenTotalCount = refreshedNode.data.childrenTotalCount;
                                    }
                                    else {
                                        return null;
                                    }
                                }
                                else {
                                    newChildrenTotalCount = rootElementsCount;
                                }
                            }
                            const result = new ExtendedFilterItem(current.UniqueName, parentUniqueName, newChildrenTotalCount, -1, level - 1, this, current.Type);
                            result.AllItemsLookup = lookup;
                            lookup[result.UniqueName] = result;
                            return result;
                        }, (parent, child) => parent.Children[child.UniqueName] = child);
                        this.Refresh();
                        console.log("DESERIALIZED STATE:");
                        this.Print();
                        return this;
                    }
                    GetSelectionStatus(sortedParents, id, iteratorFactory = new ForwardTreeTraversalIteratorFactory()) {
                        let status = null;
                        let currentParent;
                        let currentChildUniqueName = id;
                        if (!this._root.ChildrenArray.length) {
                            return this.Root.Type === Controls.FilterControlModule.FilterStateManagerModule.Common.FilterType.Excluded ? Controls.FilterControlModule.FilterStateManagerModule.Common.SelectionMode.Selected : Controls.FilterControlModule.FilterStateManagerModule.Common.SelectionMode.Deselected;
                        }
                        let iterator = iteratorFactory.Create(sortedParents);
                        while (iterator.MoveNext()) {
                            const currentParentUniqueName = iterator.Current;
                            currentParent = this._root.AllItemsLookup[currentParentUniqueName];
                            if (currentParent) {
                                status = currentParent.GetSelectionStatus(currentChildUniqueName);
                                break;
                            }
                            else {
                                currentChildUniqueName = currentParentUniqueName;
                            }
                        }
                        if (!status) {
                            status = this.GetSelectionStatus(["#"], currentChildUniqueName);
                        }
                        return status;
                    }
                    GetAllNodeSelectionStatus() {
                        return this._root.GetSelectionMode();
                    }
                    static GetLeafs(root) {
                        if (!root)
                            return [];
                        var result = [];
                        TreeHelpers.TraversePreorder(root, x => x.Children, (current) => {
                            if (!current.Children || !current.Children.length) {
                                result.push(current.UniqueName);
                            }
                            return true;
                        }, new ForwardTreeTraversalIteratorFactory());
                        return result;
                    }
                    DeepCopy(rootChildrenTotalCount) {
                        return new FilterStateManager(this.GetRootType(), rootChildrenTotalCount, this.IsFiltred).Deserialize(this.Serialize(), rootChildrenTotalCount, null, false);
                    }
                    Print() {
                        console.log("#:", this._root);
                        console.log("LOOKUP:", this._root.AllItemsLookup);
                        var text = "";
                        var writeLevelIndent = (text, level) => {
                            for (let i = 0; i < level; i++) {
                                text = text + "| ";
                            }
                            return text;
                        };
                        TreeHelpers.TraversePreorder(this._root, x => Object.keys(x.Children).map(key => x.Children[key]), (current, parent, level) => {
                            text = writeLevelIndent(text, level);
                            text += "|";
                            text += "-";
                            text += this.PrintFilterItem(current);
                            text += " [";
                            text += "L:" + current.Level + " ";
                            text += "C:" + current.ChildrenTotalCount + " ";
                            text += current.FiltredChildrenTotalCount ? "FC:" + current.FiltredChildrenTotalCount : "";
                            text += "]";
                            text += "\n";
                            return true;
                        }, new ForwardTreeTraversalIteratorFactory());
                        console.log(text);
                    }
                    PrintFilterItem(filterItem) {
                        let type = "";
                        switch (filterItem.Type) {
                            case Controls.FilterControlModule.FilterStateManagerModule.Common.FilterType.Included:
                                type = type + "(I)";
                                break;
                            case Controls.FilterControlModule.FilterStateManagerModule.Common.FilterType.Excluded:
                                type = type + "(E)";
                                break;
                            default:
                        }
                        return filterItem.UniqueName + type;
                    }
                    CreateItem(id, parentUniqueName, childrenCount, filtredChildrenTotalCount, level) {
                        return new ExtendedFilterItem(id, parentUniqueName, childrenCount, filtredChildrenTotalCount, level, this);
                    }
                    GetRootType() { return this._root.Type; }
                    UpdateFilteredChildrensTotalCount(existingElementsChildrenCountLookup, nodesWithUpdatedCount) {
                        var nodeWithUpdatedCounts = [];
                        for (var key in nodesWithUpdatedCount) {
                            if (nodesWithUpdatedCount.hasOwnProperty(key)) {
                                if (nodesWithUpdatedCount.hasOwnProperty(key)) {
                                    let item = this._root.AllItemsLookup[key];
                                    if (item) {
                                        item.FiltredChildrenTotalCount = existingElementsChildrenCountLookup[key].ChildrenCount;
                                        nodeWithUpdatedCounts.push(item.UniqueName);
                                    }
                                }
                            }
                        }
                        console.log(`%cNODE WITH UPDATED COUNTS: ${nodeWithUpdatedCounts}`, 'background: #222; color: yellow');
                    }
                    Contains(uniqueName) {
                        return Boolean(this._root.AllItemsLookup[uniqueName]);
                    }
                    CloneBranch(uniqueName, withChildren) {
                        let filterItem = this._root.AllItemsLookup[uniqueName];
                        return filterItem.Clone(withChildren);
                    }
                    IsEmpty() {
                        return this.Root.CurrentChildrenCount === 0;
                    }
                    RevertSelection() {
                        this.Root.RevertSelection();
                    }
                    Refresh() {
                        var t0 = performance.now();
                        TreeHelpers.TraversePostOrder(this.Root, x => x.ChildrenArray, (current, parent) => {
                            let selectionMode = current.GetSelectionMode();
                            if (selectionMode !== Controls.FilterControlModule.FilterStateManagerModule.Common.SelectionMode.Undetermined) {
                                var isSelect = selectionMode === Controls.FilterControlModule.FilterStateManagerModule.Common.SelectionMode.Selected;
                                current.ChangeTargetType(isSelect);
                                current.RemoveAllChildren();
                                if (parent) {
                                    current.RegisterOrUnregisterInParent(isSelect, true);
                                }
                            }
                            return true;
                        });
                        var t1 = performance.now();
                        console.info("Call to Refresh took " + (t1 - t0) + " milliseconds.");
                    }
                }
                FilterStateManagerModule.FilterStateManager = FilterStateManager;
            })(FilterStateManagerModule = FilterControlModule.FilterStateManagerModule || (FilterControlModule.FilterStateManagerModule = {}));
        })(FilterControlModule = Controls.FilterControlModule || (Controls.FilterControlModule = {}));
    })(Controls = Comarch.Controls || (Comarch.Controls = {}));
})(Comarch || (Comarch = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmlsdGVyU3RhdGVNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRmlsdGVyU3RhdGVNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQVUsT0FBTyxDQWlUaEI7QUFqVEQsV0FBVSxPQUFPO0lBQUMsSUFBQSxRQUFRLENBaVR6QjtJQWpUaUIsV0FBQSxRQUFRO1FBQUMsSUFBQSxtQkFBbUIsQ0FpVDdDO1FBalQwQixXQUFBLG1CQUFtQjtZQUFDLElBQUEsd0JBQXdCLENBaVR0RTtZQWpUOEMsV0FBQSx3QkFBd0I7Z0JBQ25FLElBQU8sV0FBVyxHQUFHLFFBQUEsS0FBSyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUM7Z0JBQ2pELElBQU8sbUNBQW1DLEdBQUcsUUFBQSxLQUFLLENBQUMsU0FBUyxDQUFDLG1DQUFtQyxDQUFDO2dCQUNqRyxJQUFPLGdCQUFnQixHQUFHLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFJdEUsSUFBTyxvQ0FBb0MsR0FBRyxRQUFBLEtBQUssQ0FBQyxTQUFTLENBQUMsb0NBQW9DLENBQUM7Z0JBS25HO29CQUNJLE1BQU0sQ0FBQyxRQUFpRixFQUFFLGtCQUEwQixFQUFFLFNBQWtCO3dCQUNwSSxNQUFNLENBQUMsSUFBSSxrQkFBa0IsQ0FBQyxRQUFRLEVBQUUsa0JBQWtCLEVBQUUsU0FBUyxDQUFDLENBQUM7b0JBQzNFLENBQUM7aUJBQ0o7Z0JBSmEsa0RBQXlCLDRCQUl0QyxDQUFBO2dCQTZCRDtvQkFLSSxZQUFZLFFBQWlGLEVBQUUsa0JBQTBCLEVBQVcsVUFBbUI7d0JBQW5CLGVBQVUsR0FBVixVQUFVLENBQVM7d0JBQ25KLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUM3QyxJQUFJLENBQUMsS0FBSyxDQUFDLGtCQUFrQixHQUFHLGtCQUFrQixDQUFDO3dCQUNuRCxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUM7d0JBQy9CLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztvQkFDbEUsQ0FBQztvQkFSRCxJQUFJLElBQUksS0FBd0IsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUEsQ0FBQSxDQUFDO29CQUFBLENBQUM7b0JBQ25ELElBQUksU0FBUyxLQUFhLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFBLENBQUEsQ0FBQztvQkFBQSxDQUFDO29CQVN6QyxnQkFBZ0IsQ0FBQyxRQUFpRjt3QkFDdkcsTUFBTSxDQUFDLElBQUksa0JBQWtCLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBQ3hFLENBQUM7b0JBRUQsUUFBUSxDQUFDLGFBQW1DLEVBQUUsVUFBOEIsRUFBRSxVQUFtQixFQUFDLFdBQW1CLEVBQUMsa0JBQWtFLElBQUksb0NBQW9DLEVBQUU7d0JBQzlOLElBQUksYUFBYSxHQUFHLElBQUksZ0JBQWdCLEVBQUUsQ0FBQzt3QkFDM0MsSUFBSSxRQUFRLEdBQUcsZUFBZSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQzt3QkFDckQsT0FBTyxRQUFRLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQzs0QkFDekIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFDLFdBQVcsQ0FBQyxDQUFDO3dCQUNqRixDQUFDO3dCQUVELElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFDLFdBQVcsQ0FBQyxDQUFDO3dCQUN0RSxNQUFNLENBQUMsYUFBYSxDQUFDO29CQUN6QixDQUFDO29CQUVPLE9BQU8sQ0FBQyxJQUF3QixFQUFFLFVBQW1CLEVBQUUsWUFBcUIsRUFBRSxnQkFBa0MsRUFBQyxXQUFtQjt3QkFDeEksTUFBTSxZQUFZLEdBQXVCLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQzt3QkFDcEYsTUFBTSxrQkFBa0IsR0FBdUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7d0JBQ2hHLEVBQUUsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQzs0QkFDaEIsRUFBRSxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDO2dDQUNyQixrQkFBa0IsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxZQUFZLENBQUMsQ0FBQztnQ0FDNUQsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztvQ0FDZixJQUFJLENBQUMscUJBQXFCLENBQUMsVUFBVSxFQUFFLFlBQVksRUFBRSxnQkFBZ0IsRUFBQyxXQUFXLENBQUMsQ0FBQztnQ0FDdkYsQ0FBQzs0QkFDTCxDQUFDOzRCQUFDLElBQUksQ0FBQyxDQUFDO2dDQUNKLE1BQU0sSUFBSSxLQUFLLENBQUMsMENBQTBDLENBQUMsQ0FBQzs0QkFDaEUsQ0FBQzs0QkFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO3dCQUNqQixDQUFDO3dCQUFDLElBQUksQ0FBQyxDQUFDOzRCQUNKLEVBQUUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7Z0NBQ2YsWUFBWSxDQUFDLHFCQUFxQixDQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUMsV0FBVyxDQUFDLENBQUM7NEJBQ3ZGLENBQUM7d0JBQ0wsQ0FBQzt3QkFFRCxNQUFNLENBQUMsSUFBSSxDQUFDO29CQUNoQixDQUFDO29CQUVELEtBQUssQ0FBQyxRQUFpQjt3QkFDbkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO3dCQUMvQixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLHdCQUF3QixDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDO3dCQUNqTSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDM0MsQ0FBQztvQkFFTSxRQUFRLEtBQXdCLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztvQkFFM0QsU0FBUzt3QkFDTCxNQUFNLE1BQU0sR0FBRyxXQUFXLENBQUMsT0FBTyxDQUErRixJQUFJLENBQUMsS0FBSyxFQUN2SSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxhQUFhLEVBQ3BCLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFDZixDQUFDLE9BQU8sRUFBRSxFQUFFOzRCQUNSLE1BQU0sTUFBTSxHQUFHLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBOEUsQ0FBQzs0QkFDaEssTUFBTSxDQUFDLE1BQU0sQ0FBQzt3QkFDbEIsQ0FBQyxDQUFDLENBQUM7d0JBQ1AsTUFBTSxDQUFDLE1BQU0sQ0FBQztvQkFDbEIsQ0FBQztvQkFFRCxXQUFXLENBQUMsY0FBd0YsRUFBRSxpQkFBeUIsRUFBRSxnQkFBbUMsRUFBRSxRQUFlLElBQUk7d0JBQ3JMLElBQUksTUFBTSxHQUEyRixFQUFFLENBQUM7d0JBQ3hHLElBQUksQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBK0YsY0FBYyxFQUN6SSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQ2YsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQ1QsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRTs0QkFDM0IsSUFBSSxxQkFBcUIsR0FBRyxDQUFDLENBQUMsQ0FBQzs0QkFDL0IsSUFBSSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQzs0QkFDekQsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQ0FDUixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29DQUNULElBQUksYUFBYSxHQUFHLGdCQUFnQixDQUFDLDhCQUE4QixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztvQ0FDeEYsRUFBRSxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQzt3Q0FDaEIscUJBQXFCLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztvQ0FDbEUsQ0FBQztvQ0FBQyxJQUFJLENBQUMsQ0FBQzt3Q0FFSixNQUFNLENBQUMsSUFBSSxDQUFDO29DQUNoQixDQUFDO2dDQUNMLENBQUM7Z0NBQUMsSUFBSSxDQUFDLENBQUM7b0NBQ0oscUJBQXFCLEdBQUcsaUJBQWlCLENBQUM7Z0NBQzlDLENBQUM7NEJBQ0wsQ0FBQzs0QkFDRCxNQUFNLE1BQU0sR0FBRyxJQUFJLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsZ0JBQWdCLEVBQUUscUJBQXFCLEVBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxHQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDOzRCQUNySSxNQUFNLENBQUMsY0FBYyxHQUFHLE1BQU0sQ0FBQzs0QkFDL0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxNQUFNLENBQUM7NEJBQ25DLE1BQU0sQ0FBQyxNQUFNLENBQUM7d0JBQ2xCLENBQUMsRUFDRCxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEtBQUssQ0FDL0QsQ0FBQzt3QkFDRixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7d0JBQ2YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO3dCQUNuQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7d0JBQ2IsTUFBTSxDQUFDLElBQUksQ0FBQztvQkFDaEIsQ0FBQztvQkFFRCxrQkFBa0IsQ0FBQyxhQUF1QixFQUFFLEVBQVUsRUFBQyxrQkFBc0QsSUFBSSxtQ0FBbUMsRUFBRTt3QkFFbEosSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDO3dCQUNsQixJQUFJLGFBQWlDLENBQUM7d0JBQ3RDLElBQUksc0JBQXNCLEdBQUcsRUFBRSxDQUFDO3dCQUNoQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7NEJBQ25DLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsbUJBQW1CLENBQUMsd0JBQXdCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLHdCQUF3QixDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDO3dCQUM3UixDQUFDO3dCQUVELElBQUksUUFBUSxHQUFHLGVBQWUsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7d0JBQ3JELE9BQU8sUUFBUSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUM7NEJBQ3pCLE1BQU0sdUJBQXVCLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQzs0QkFDakQsYUFBYSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLHVCQUF1QixDQUFDLENBQUM7NEJBQ25FLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7Z0NBQ2hCLE1BQU0sR0FBRyxhQUFhLENBQUMsa0JBQWtCLENBQUMsc0JBQXNCLENBQUMsQ0FBQztnQ0FDbEUsS0FBSyxDQUFDOzRCQUNWLENBQUM7NEJBQUMsSUFBSSxDQUFDLENBQUM7Z0NBQ0osc0JBQXNCLEdBQUcsdUJBQXVCLENBQUM7NEJBQ3JELENBQUM7d0JBQ0wsQ0FBQzt3QkFDRCxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7NEJBQ1YsTUFBTSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLHNCQUFzQixDQUFDLENBQUM7d0JBQ3BFLENBQUM7d0JBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQztvQkFDbEIsQ0FBQztvQkFFRCx5QkFBeUI7d0JBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLENBQUM7b0JBQ3pDLENBQUM7b0JBRUQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUE4RTt3QkFDMUYsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7NEJBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQzt3QkFDckIsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO3dCQUNoQixXQUFXLENBQUMsZ0JBQWdCLENBQTJFLElBQUksRUFDdkcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUNmLENBQUMsT0FBTyxFQUFFLEVBQUU7NEJBQ1IsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dDQUNoRCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQzs0QkFDcEMsQ0FBQzs0QkFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO3dCQUNoQixDQUFDLEVBQ0QsSUFBSSxtQ0FBbUMsRUFBNEUsQ0FBQyxDQUFDO3dCQUN6SCxNQUFNLENBQUMsTUFBTSxDQUFDO29CQUNsQixDQUFDO29CQUdELFFBQVEsQ0FBQyxzQkFBOEI7d0JBQ25DLE1BQU0sQ0FBQyxJQUFJLGtCQUFrQixDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsRUFBRSxzQkFBc0IsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsRUFBRSxzQkFBc0IsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7b0JBQ2pLLENBQUM7b0JBRUQsS0FBSzt3QkFDRCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7d0JBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7d0JBQ2xELElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQzt3QkFDZCxJQUFJLGdCQUFnQixHQUFHLENBQUMsSUFBWSxFQUFFLEtBQWEsRUFBRSxFQUFFOzRCQUNuRCxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dDQUM3QixJQUFJLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQzs0QkFDdkIsQ0FBQzs0QkFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO3dCQUNoQixDQUFDLENBQUM7d0JBQ0YsV0FBVyxDQUFDLGdCQUFnQixDQUFxQixJQUFJLENBQUMsS0FBSyxFQUN2RCxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsRUFDeEQsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFOzRCQUN2QixJQUFJLEdBQUcsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDOzRCQUNyQyxJQUFJLElBQUksR0FBRyxDQUFDOzRCQUNaLElBQUksSUFBSSxHQUFHLENBQUM7NEJBQ1osSUFBSSxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUM7NEJBQ3RDLElBQUksSUFBSSxJQUFJLENBQUM7NEJBQ2IsSUFBSSxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQzs0QkFDbkMsSUFBSSxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsa0JBQWtCLEdBQUMsR0FBRyxDQUFDOzRCQUM5QyxJQUFJLElBQUksT0FBTyxDQUFDLHlCQUF5QixDQUFBLENBQUMsQ0FBQSxLQUFLLEdBQUcsT0FBTyxDQUFDLHlCQUF5QixDQUFBLENBQUMsQ0FBQSxFQUFFLENBQUM7NEJBQ3ZGLElBQUksSUFBSSxHQUFHLENBQUM7NEJBQ1osSUFBSSxJQUFJLElBQUksQ0FBQzs0QkFDYixNQUFNLENBQUMsSUFBSSxDQUFDO3dCQUNoQixDQUFDLEVBQ0QsSUFBSSxtQ0FBbUMsRUFBc0IsQ0FDaEUsQ0FBQzt3QkFDRixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUN0QixDQUFDO29CQUVELGVBQWUsQ0FBQyxVQUE4Qjt3QkFDMUMsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO3dCQUNkLE1BQU0sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDOzRCQUMxQixLQUFLLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFFBQVE7Z0NBQ2pGLElBQUksR0FBRyxJQUFJLEdBQUcsS0FBSyxDQUFDO2dDQUNwQixLQUFLLENBQUM7NEJBQ1YsS0FBSyxRQUFRLENBQUMsbUJBQW1CLENBQUMsd0JBQXdCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRO2dDQUNqRixJQUFJLEdBQUcsSUFBSSxHQUFHLEtBQUssQ0FBQztnQ0FDcEIsS0FBSyxDQUFDOzRCQUNWLFFBQVE7d0JBQ1IsQ0FBQzt3QkFDRCxNQUFNLENBQUMsVUFBVSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7b0JBQ3hDLENBQUM7b0JBR0QsVUFBVSxDQUFDLEVBQVUsRUFBRSxnQkFBd0IsRUFBRSxhQUFxQixFQUFDLHlCQUFnQyxFQUFFLEtBQWE7d0JBQ2xILE1BQU0sQ0FBQyxJQUFJLGtCQUFrQixDQUFDLEVBQUUsRUFBRSxnQkFBZ0IsRUFBRSxhQUFhLEVBQUMseUJBQXlCLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO29CQUM5RyxDQUFDO29CQUVELFdBQVcsS0FBOEUsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFFbEgsaUNBQWlDLENBQUMsbUNBQTZELEVBQUMscUJBQXVDO3dCQUNuSSxJQUFJLHFCQUFxQixHQUFHLEVBQUUsQ0FBQzt3QkFDL0IsR0FBRyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUkscUJBQXFCLENBQUMsQ0FBQyxDQUFDOzRCQUNwQyxFQUFFLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dDQUM1QyxFQUFFLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO29DQUM1QyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQ0FDMUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzt3Q0FDUCxJQUFJLENBQUMseUJBQXlCLEdBQUcsbUNBQW1DLENBQUMsR0FBRyxDQUFDLENBQUMsYUFBYSxDQUFDO3dDQUN4RixxQkFBcUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO29DQUNoRCxDQUFDO2dDQUNMLENBQUM7NEJBRUwsQ0FBQzt3QkFDTCxDQUFDO3dCQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLHFCQUFxQixFQUFFLEVBQUUsaUNBQWlDLENBQUMsQ0FBQztvQkFFM0csQ0FBQztvQkFFRCxRQUFRLENBQUMsVUFBa0I7d0JBQ3ZCLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztvQkFDMUQsQ0FBQztvQkFFRCxXQUFXLENBQUMsVUFBa0IsRUFBQyxZQUFvQjt3QkFDL0MsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7d0JBQ3ZELE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO29CQUMxQyxDQUFDO29CQUVELE9BQU87d0JBQ0gsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEtBQUssQ0FBQyxDQUFDO29CQUNoRCxDQUFDO29CQUVELGVBQWU7d0JBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztvQkFDaEMsQ0FBQztvQkFFRCxPQUFPO3dCQUNILElBQUksRUFBRSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQzt3QkFDM0IsV0FBVyxDQUFDLGlCQUFpQixDQUFxQixJQUFJLENBQUMsSUFBSSxFQUN2RCxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxhQUFhLEVBQ3BCLENBQUMsT0FBTyxFQUFDLE1BQU0sRUFBRSxFQUFFOzRCQUNoQixJQUFJLGFBQWEsR0FBRyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQzs0QkFDMUMsRUFBRSxDQUFDLENBQUMsYUFBYSxLQUFLLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7Z0NBQzVHLElBQUksUUFBUSxHQUFHLGFBQWEsS0FBSyxRQUFRLENBQUMsbUJBQW1CLENBQUMsd0JBQXdCLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUM7Z0NBQ3JILE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQ0FDbkMsT0FBTyxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0NBQzVCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7b0NBQ1QsT0FBTyxDQUFDLDRCQUE0QixDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztnQ0FDekQsQ0FBQzs0QkFDTCxDQUFDOzRCQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7d0JBQ2hCLENBQUMsQ0FDUixDQUFDO3dCQUNGLElBQUksRUFBRSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQzt3QkFDM0IsT0FBTyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDO29CQUN6RSxDQUFDO2lCQUNKO2dCQW5RWSwyQ0FBa0IscUJBbVE5QixDQUFBO1lBQ0wsQ0FBQyxFQWpUOEMsd0JBQXdCLEdBQXhCLDRDQUF3QixLQUF4Qiw0Q0FBd0IsUUFpVHRFO1FBQUQsQ0FBQyxFQWpUMEIsbUJBQW1CLEdBQW5CLDRCQUFtQixLQUFuQiw0QkFBbUIsUUFpVDdDO0lBQUQsQ0FBQyxFQWpUaUIsUUFBUSxHQUFSLGdCQUFRLEtBQVIsZ0JBQVEsUUFpVHpCO0FBQUQsQ0FBQyxFQWpUUyxPQUFPLEtBQVAsT0FBTyxRQWlUaEIiLCJzb3VyY2VzQ29udGVudCI6WyJuYW1lc3BhY2UgQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZSB7XHJcbiAgICBpbXBvcnQgVHJlZUhlbHBlcnMgPSBVdGlscy5UcmVlVXRpbHMuVHJlZUhlbHBlcnM7XHJcbiAgICBpbXBvcnQgRm9yd2FyZFRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3RvcnkgPSBVdGlscy5UcmVlVXRpbHMuRm9yd2FyZFRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3Rvcnk7XHJcbiAgICBpbXBvcnQgQWZmZWN0ZWROb2Rlc1NldCA9IEZpbHRlckNvbnRyb2xNb2R1bGUuQ29tbW9uLkFmZmVjdGVkTm9kZXNTZXQ7XHJcbiAgICBpbXBvcnQgSUNsZWFuZWRTdGF0ZUluZm8gPSBGaWx0ZXJDb250cm9sTW9kdWxlLkNvbW1vbi5JQ2xlYW5lZFN0YXRlSW5mbztcclxuICAgIGltcG9ydCBJQ2hpbGRyZW5Db3VudEluZm9Mb29rdXAgPSBGaWx0ZXJDb250cm9sTW9kdWxlLkNvbW1vbi5JQ2hpbGRyZW5Db3VudEluZm9Mb29rdXA7XHJcbiAgICBpbXBvcnQgSVRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3RvcnkgPSBVdGlscy5UcmVlVXRpbHMuSVRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3Rvcnk7XHJcbiAgICBpbXBvcnQgQmFja3dhcmRUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5ID0gVXRpbHMuVHJlZVV0aWxzLkJhY2t3YXJkVHJlZVRyYXZlcnNhbEl0ZXJhdG9yRmFjdG9yeTtcclxuICAgIGltcG9ydCBJTWVtYmVyTm9kZUxvb2t1cCA9IEZpbHRlckNvbnRyb2xNb2R1bGUuQ29tbW9uLklNZW1iZXJOb2RlTG9va3VwO1xyXG5cclxuICAgXHJcbiAgICBcclxuICAgIGV4cG9ydCAgY2xhc3MgRmlsdGVyU3RhdGVNYW5hZ2VyRmFjdG9yeSBpbXBsZW1lbnRzIElGaWx0ZXJTdGF0ZU1hbmFnZXJGYWN0b3J5IHtcclxuICAgICAgICBDcmVhdGUocm9vdFR5cGU6IENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vbi5GaWx0ZXJUeXBlLCBjaGlsZHJlblRvdGFsQ291bnQ6IG51bWJlciwgaXNGaWx0cmVkOiBib29sZWFuKTogSUZpbHRlclN0YXRlTWFuYWdlciB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmlsdGVyU3RhdGVNYW5hZ2VyKHJvb3RUeXBlLCBjaGlsZHJlblRvdGFsQ291bnQsIGlzRmlsdHJlZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRmlsdGVyU3RhdGVNYW5hZ2VyRmFjdG9yeSB7XHJcbiAgICAgICAgQ3JlYXRlKHJvb3RUeXBlOiBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uRmlsdGVyVHlwZSwgY2hpbGRyZW5Ub3RhbENvdW50OiBudW1iZXIsIGlzRmlsdHJlZDogYm9vbGVhbik6SUZpbHRlclN0YXRlTWFuYWdlcjtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElGaWx0ZXJTdGF0ZU1hbmFnZXIge1xyXG4gICAgICAgIElzRmlsdHJlZDogYm9vbGVhbjtcclxuICAgICAgICBBZGROb2Rlcyhzb3J0ZWRQYXJlbnRzOiBFeHRlbmRlZEZpbHRlckl0ZW1bXSwgdGFyZ2V0Tm9kZTogRXh0ZW5kZWRGaWx0ZXJJdGVtLCBpc1NlbGVjdGVkOiBib29sZWFuLGF1dG9SZWZyZXNoOmJvb2xlYW4saXRlcmF0b3JGYWN0b3J5PzpJVHJlZVRyYXZlcnNhbEl0ZXJhdG9yRmFjdG9yeTxFeHRlbmRlZEZpbHRlckl0ZW0+KTogQWZmZWN0ZWROb2Rlc1NldDtcclxuICAgICAgICBSZXNldChpc1NlbGVjdDogYm9vbGVhbik7XHJcbiAgICAgICAgR2V0U3RhdGUoKTpFeHRlbmRlZEZpbHRlckl0ZW07XHJcbiAgICAgICAgU2VyaWFsaXplKCk6IENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vbi5JRmlsdGVySXRlbTtcclxuICAgICAgICBEZXNlcmlhbGl6ZShzZXJpYWxpemVkUm9vdDogQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLklGaWx0ZXJJdGVtLCByb290RWxlbWVudHNDb3VudDogbnVtYmVyLCBjbGVhbmVkU3RhdGVJbmZvOiBJQ2xlYW5lZFN0YXRlSW5mbyk7XHJcbiAgICAgICAgR2V0U2VsZWN0aW9uU3RhdHVzKHNvcnRlZFBhcmVudHM6IHN0cmluZ1tdLCBpZDogc3RyaW5nLGl0ZXJhdG9yRmFjdG9yeT86SVRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3Rvcnk8c3RyaW5nPik6IENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vblxyXG4gICAgICAgICAgICAuU2VsZWN0aW9uTW9kZTtcclxuICAgICAgICBQcmludCgpO1xyXG4gICAgICAgIENyZWF0ZUl0ZW0oaWQ6IHN0cmluZywgcGFyZW50VW5pcXVlTmFtZTogc3RyaW5nLCBjaGlsZHJlbkNvdW50OiBudW1iZXIsZmlsdHJlZENoaWxkcmVuVG90YWxDb3VudDpudW1iZXIsIGxldmVsOiBudW1iZXIpOiBFeHRlbmRlZEZpbHRlckl0ZW07XHJcbiAgICAgICAgUmVmcmVzaCgpO1xyXG4gICAgICAgIFJldmVydFNlbGVjdGlvbigpO1xyXG4gICAgICAgIElzRW1wdHkoKTogYm9vbGVhbjtcclxuICAgICAgICBDbG9uZUJyYW5jaCh1bmlxdWVOYW1lOiBzdHJpbmcsd2l0aENoaWxkcmVuOmJvb2xlYW4pOkV4dGVuZGVkRmlsdGVySXRlbTtcclxuICAgICAgICBDb250YWlucyh1bmlxdWVOYW1lOiBzdHJpbmcpOmJvb2xlYW47XHJcbiAgICAgICAgR2V0Um9vdFR5cGUoKTogQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLkZpbHRlclR5cGU7XHJcbiAgICAgICAgVXBkYXRlRmlsdGVyZWRDaGlsZHJlbnNUb3RhbENvdW50KGV4aXN0aW5nRWxlbWVudHNDaGlsZHJlbkNvdW50TG9va3VwOiBJQ2hpbGRyZW5Db3VudEluZm9Mb29rdXAsbm9kZXNXaXRoVXBkYXRlZENvdW50OklNZW1iZXJOb2RlTG9va3VwKTtcclxuICAgICAgICBHZXRBbGxOb2RlU2VsZWN0aW9uU3RhdHVzKCk6IENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vbi5TZWxlY3Rpb25Nb2RlO1xyXG5cclxuICAgIH1cclxuICAgIFxyXG4gICAgZXhwb3J0IGNsYXNzIEZpbHRlclN0YXRlTWFuYWdlciBpbXBsZW1lbnRzIElGaWx0ZXJTdGF0ZU1hbmFnZXIge1xyXG4gICAgICAgIHByaXZhdGUgX3Jvb3Q6IEV4dGVuZGVkRmlsdGVySXRlbTtcclxuICAgICAgICBnZXQgUm9vdCgpOiBFeHRlbmRlZEZpbHRlckl0ZW0ge3JldHVybiB0aGlzLl9yb290fTtcclxuICAgICAgICBnZXQgSXNGaWx0cmVkKCk6IGJvb2xlYW4ge3JldHVybiB0aGlzLl9pc0ZpbHRyZWR9O1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3Rvcihyb290VHlwZTogQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLkZpbHRlclR5cGUsIGNoaWxkcmVuVG90YWxDb3VudDogbnVtYmVyLCBwcml2YXRlICBfaXNGaWx0cmVkOiBib29sZWFuKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Jvb3QgPSB0aGlzLkdldEVtcHR5Um9vdEl0ZW0ocm9vdFR5cGUpO1xyXG4gICAgICAgICAgICB0aGlzLl9yb290LkNoaWxkcmVuVG90YWxDb3VudCA9IGNoaWxkcmVuVG90YWxDb3VudDtcclxuICAgICAgICAgICAgdGhpcy5fcm9vdC5BbGxJdGVtc0xvb2t1cCA9IHt9O1xyXG4gICAgICAgICAgICB0aGlzLl9yb290LkFsbEl0ZW1zTG9va3VwW3RoaXMuX3Jvb3QuVW5pcXVlTmFtZV0gPSB0aGlzLl9yb290O1xyXG4gICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgcHJpdmF0ZSAgR2V0RW1wdHlSb290SXRlbShyb290VHlwZTogQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLkZpbHRlclR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBFeHRlbmRlZEZpbHRlckl0ZW0oXCIjXCIsIG51bGwsIC0xLCAtMSwtMSwgdGhpcywgcm9vdFR5cGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgQWRkTm9kZXMoc29ydGVkUGFyZW50czogRXh0ZW5kZWRGaWx0ZXJJdGVtW10sIHRhcmdldE5vZGU6IEV4dGVuZGVkRmlsdGVySXRlbSwgaXNTZWxlY3RlZDogYm9vbGVhbixhdXRvUmVmcmVzaDpib29sZWFuLGl0ZXJhdG9yRmFjdG9yeTpJVHJlZVRyYXZlcnNhbEl0ZXJhdG9yRmFjdG9yeTxFeHRlbmRlZEZpbHRlckl0ZW0+PW5ldyBCYWNrd2FyZFRyZWVUcmF2ZXJzYWxJdGVyYXRvckZhY3RvcnkoKSk6IEFmZmVjdGVkTm9kZXNTZXQge1xyXG4gICAgICAgICAgICB2YXIgYWZmZWN0ZWROb2RlcyA9IG5ldyBBZmZlY3RlZE5vZGVzU2V0KCk7XHJcbiAgICAgICAgICAgIGxldCBpdGVyYXRvciA9IGl0ZXJhdG9yRmFjdG9yeS5DcmVhdGUoc29ydGVkUGFyZW50cyk7XHJcbiAgICAgICAgICAgIHdoaWxlIChpdGVyYXRvci5Nb3ZlTmV4dCgpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLkFkZE5vZGUoaXRlcmF0b3IuQ3VycmVudCwgaXNTZWxlY3RlZCwgZmFsc2UsIGFmZmVjdGVkTm9kZXMsYXV0b1JlZnJlc2gpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLkFkZE5vZGUodGFyZ2V0Tm9kZSwgaXNTZWxlY3RlZCwgdHJ1ZSwgYWZmZWN0ZWROb2RlcyxhdXRvUmVmcmVzaCk7XHJcbiAgICAgICAgICAgIHJldHVybiBhZmZlY3RlZE5vZGVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBBZGROb2RlKG5vZGU6IEV4dGVuZGVkRmlsdGVySXRlbSwgaXNTZWxlY3RlZDogYm9vbGVhbiwgaXNUYXJnZXROb2RlOiBib29sZWFuLCBhZmZlY3RlZE5vZGVzU2V0OiBBZmZlY3RlZE5vZGVzU2V0LGF1dG9SZWZyZXNoOmJvb2xlYW4pOiBib29sZWFuIHtcclxuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdOb2RlOiBFeHRlbmRlZEZpbHRlckl0ZW0gPSB0aGlzLl9yb290LkFsbEl0ZW1zTG9va3VwW25vZGUuVW5pcXVlTmFtZV07XHJcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nUGFyZW50Tm9kZTogRXh0ZW5kZWRGaWx0ZXJJdGVtID0gdGhpcy5fcm9vdC5BbGxJdGVtc0xvb2t1cFtub2RlLlBhcmVudFVuaXF1ZU5hbWVdO1xyXG4gICAgICAgICAgICBpZiAoIWV4aXN0aW5nTm9kZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nUGFyZW50Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nUGFyZW50Tm9kZS5BZGRDaGlsZChub2RlLCBpc1NlbGVjdGVkLCBpc1RhcmdldE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1RhcmdldE5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5IYW5kbGVTZWxlY3Rpb25DaGFuZ2UoaXNTZWxlY3RlZCwgaXNUYXJnZXROb2RlLCBhZmZlY3RlZE5vZGVzU2V0LGF1dG9SZWZyZXNoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbiBub3QgYWRkIG5vZGUgdG8gbm90IGV4aXN0aW5nIHBhcmVudC5cIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNUYXJnZXROb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdOb2RlLkhhbmRsZVNlbGVjdGlvbkNoYW5nZShpc1NlbGVjdGVkLCB0cnVlLCBhZmZlY3RlZE5vZGVzU2V0LGF1dG9SZWZyZXNoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIFJlc2V0KGlzU2VsZWN0OiBib29sZWFuKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Jvb3QuUmVtb3ZlQWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICAgICAgdGhpcy5fcm9vdC5UeXBlID0gaXNTZWxlY3QgPyBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uRmlsdGVyVHlwZS5FeGNsdWRlZCA6IENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vbi5GaWx0ZXJUeXBlLkluY2x1ZGVkO1xyXG4gICAgICAgICAgICByZXR1cm4gQWZmZWN0ZWROb2Rlc1NldC5FbXB0eS5BZGQoXCIjXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEdldFN0YXRlKCk6RXh0ZW5kZWRGaWx0ZXJJdGVtIHsgcmV0dXJuIHRoaXMuX3Jvb3Q7IH1cclxuXHJcbiAgICAgICAgU2VyaWFsaXplKCk6IENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vbi5JRmlsdGVySXRlbSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFRyZWVIZWxwZXJzLkNvbnZlcnQ8RXh0ZW5kZWRGaWx0ZXJJdGVtLCBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uSUZpbHRlckl0ZW0+KHRoaXMuX3Jvb3QsXHJcbiAgICAgICAgICAgICAgICB4ID0+IHguQ2hpbGRyZW5BcnJheSxcclxuICAgICAgICAgICAgICAgIHggPT4geC5DaGlsZHJlbixcclxuICAgICAgICAgICAgICAgIChjdXJyZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0geyBUeXBlOiBjdXJyZW50LlR5cGUsIFVuaXF1ZU5hbWU6IGN1cnJlbnQuVW5pcXVlTmFtZSwgQ2hpbGRyZW46IFtdIH0gYXMgQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLklGaWx0ZXJJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIERlc2VyaWFsaXplKHNlcmlhbGl6ZWRSb290OiBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uSUZpbHRlckl0ZW0sIHJvb3RFbGVtZW50c0NvdW50OiBudW1iZXIsIGNsZWFuZWRTdGF0ZUluZm86IElDbGVhbmVkU3RhdGVJbmZvLCBjbGVhbjogYm9vbGVhbj10cnVlKSB7XHJcbiAgICAgICAgICAgIHZhciBsb29rdXA6IENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vbi5JRXh0ZW5kZWRGaWx0ZXJJdGVtTG9va3VwID0ge307XHJcbiAgICAgICAgICAgIHRoaXMuX3Jvb3QgPSBUcmVlSGVscGVycy5Db252ZXJ0PENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vbi5JRmlsdGVySXRlbSwgRXh0ZW5kZWRGaWx0ZXJJdGVtPihzZXJpYWxpemVkUm9vdCxcclxuICAgICAgICAgICAgICAgIHggPT4geC5DaGlsZHJlbixcclxuICAgICAgICAgICAgICAgIHggPT4gbnVsbCxcclxuICAgICAgICAgICAgICAgIChjdXJyZW50LCBwYXJlbnQsIGNwLCBsZXZlbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdDaGlsZHJlblRvdGFsQ291bnQgPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50VW5pcXVlTmFtZSA9IHBhcmVudCA/IHBhcmVudC5VbmlxdWVOYW1lIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2xlYW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlZnJlc2hlZE5vZGUgPSBjbGVhbmVkU3RhdGVJbmZvLkV4aXN0aW5nTWVtYmVyc0hpZXJhcmNoeUxvb2t1cFtjdXJyZW50LlVuaXF1ZU5hbWVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlZnJlc2hlZE5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdDaGlsZHJlblRvdGFsQ291bnQgPSByZWZyZXNoZWROb2RlLmRhdGEuY2hpbGRyZW5Ub3RhbENvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3JlbW92aW5nIG5vdCBleGlzdGluZyBub2Rlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGRyZW5Ub3RhbENvdW50ID0gcm9vdEVsZW1lbnRzQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IEV4dGVuZGVkRmlsdGVySXRlbShjdXJyZW50LlVuaXF1ZU5hbWUsIHBhcmVudFVuaXF1ZU5hbWUsIG5ld0NoaWxkcmVuVG90YWxDb3VudCwtMSwgbGV2ZWwgLSAxLCB0aGlzLCBjdXJyZW50LlR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5BbGxJdGVtc0xvb2t1cCA9IGxvb2t1cDtcclxuICAgICAgICAgICAgICAgICAgICBsb29rdXBbcmVzdWx0LlVuaXF1ZU5hbWVdID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgKHBhcmVudCwgY2hpbGQpID0+IHBhcmVudC5DaGlsZHJlbltjaGlsZC5VbmlxdWVOYW1lXSA9IGNoaWxkXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuUmVmcmVzaCgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRFU0VSSUFMSVpFRCBTVEFURTpcIik7XHJcbiAgICAgICAgICAgIHRoaXMuUHJpbnQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBHZXRTZWxlY3Rpb25TdGF0dXMoc29ydGVkUGFyZW50czogc3RyaW5nW10sIGlkOiBzdHJpbmcsaXRlcmF0b3JGYWN0b3J5OklUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5PHN0cmluZz49bmV3IEZvcndhcmRUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5KCkpOiBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb25cclxuICAgICAgICAgICAgLlNlbGVjdGlvbk1vZGUge1xyXG4gICAgICAgICAgICBsZXQgc3RhdHVzID0gbnVsbDtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRQYXJlbnQ6IEV4dGVuZGVkRmlsdGVySXRlbTtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRDaGlsZFVuaXF1ZU5hbWUgPSBpZDtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLl9yb290LkNoaWxkcmVuQXJyYXkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Sb290LlR5cGUgPT09IENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vbi5GaWx0ZXJUeXBlLkV4Y2x1ZGVkID8gQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLlNlbGVjdGlvbk1vZGUuU2VsZWN0ZWQgOiBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uU2VsZWN0aW9uTW9kZS5EZXNlbGVjdGVkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgaXRlcmF0b3IgPSBpdGVyYXRvckZhY3RvcnkuQ3JlYXRlKHNvcnRlZFBhcmVudHMpO1xyXG4gICAgICAgICAgICB3aGlsZSAoaXRlcmF0b3IuTW92ZU5leHQoKSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFBhcmVudFVuaXF1ZU5hbWUgPSBpdGVyYXRvci5DdXJyZW50O1xyXG4gICAgICAgICAgICAgICAgY3VycmVudFBhcmVudCA9IHRoaXMuX3Jvb3QuQWxsSXRlbXNMb29rdXBbY3VycmVudFBhcmVudFVuaXF1ZU5hbWVdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRQYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBjdXJyZW50UGFyZW50LkdldFNlbGVjdGlvblN0YXR1cyhjdXJyZW50Q2hpbGRVbmlxdWVOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudENoaWxkVW5pcXVlTmFtZSA9IGN1cnJlbnRQYXJlbnRVbmlxdWVOYW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICBzdGF0dXMgPSB0aGlzLkdldFNlbGVjdGlvblN0YXR1cyhbXCIjXCJdLCBjdXJyZW50Q2hpbGRVbmlxdWVOYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXR1cztcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgR2V0QWxsTm9kZVNlbGVjdGlvblN0YXR1cygpOiBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uU2VsZWN0aW9uTW9kZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yb290LkdldFNlbGVjdGlvbk1vZGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN0YXRpYyBHZXRMZWFmcyhyb290OiBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uSUZpbHRlckl0ZW0pOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgICAgIGlmICghcm9vdCkgcmV0dXJuIFtdO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgIFRyZWVIZWxwZXJzLlRyYXZlcnNlUHJlb3JkZXI8Q29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLklGaWx0ZXJJdGVtPihyb290LFxyXG4gICAgICAgICAgICAgICAgeCA9PiB4LkNoaWxkcmVuLFxyXG4gICAgICAgICAgICAgICAgKGN1cnJlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnQuQ2hpbGRyZW4gfHwgIWN1cnJlbnQuQ2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGN1cnJlbnQuVW5pcXVlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIG5ldyBGb3J3YXJkVHJlZVRyYXZlcnNhbEl0ZXJhdG9yRmFjdG9yeTxDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uSUZpbHRlckl0ZW0+KCkpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIERlZXBDb3B5KHJvb3RDaGlsZHJlblRvdGFsQ291bnQ6IG51bWJlcik6IEZpbHRlclN0YXRlTWFuYWdlciB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmlsdGVyU3RhdGVNYW5hZ2VyKHRoaXMuR2V0Um9vdFR5cGUoKSwgcm9vdENoaWxkcmVuVG90YWxDb3VudCwgdGhpcy5Jc0ZpbHRyZWQpLkRlc2VyaWFsaXplKHRoaXMuU2VyaWFsaXplKCksIHJvb3RDaGlsZHJlblRvdGFsQ291bnQsIG51bGwsIGZhbHNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFByaW50KCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiM6XCIsIHRoaXMuX3Jvb3QpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkxPT0tVUDpcIiwgdGhpcy5fcm9vdC5BbGxJdGVtc0xvb2t1cCk7XHJcbiAgICAgICAgICAgIHZhciB0ZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgdmFyIHdyaXRlTGV2ZWxJbmRlbnQgPSAodGV4dDogc3RyaW5nLCBsZXZlbDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxldmVsOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dCArIFwifCBcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0O1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBUcmVlSGVscGVycy5UcmF2ZXJzZVByZW9yZGVyPEV4dGVuZGVkRmlsdGVySXRlbT4odGhpcy5fcm9vdCxcclxuICAgICAgICAgICAgICAgIHggPT4gT2JqZWN0LmtleXMoeC5DaGlsZHJlbikubWFwKGtleSA9PiB4LkNoaWxkcmVuW2tleV0pLFxyXG4gICAgICAgICAgICAgICAgKGN1cnJlbnQsIHBhcmVudCwgbGV2ZWwpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gd3JpdGVMZXZlbEluZGVudCh0ZXh0LCBsZXZlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCArPSBcInxcIjtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IFwiLVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQgKz0gdGhpcy5QcmludEZpbHRlckl0ZW0oY3VycmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCArPSBcIiBbXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCArPSBcIkw6XCIgKyBjdXJyZW50LkxldmVsICsgXCIgXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCArPSBcIkM6XCIgKyBjdXJyZW50LkNoaWxkcmVuVG90YWxDb3VudCtcIiBcIjtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IGN1cnJlbnQuRmlsdHJlZENoaWxkcmVuVG90YWxDb3VudD9cIkZDOlwiICsgY3VycmVudC5GaWx0cmVkQ2hpbGRyZW5Ub3RhbENvdW50OlwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCArPSBcIl1cIjtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IFwiXFxuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgbmV3IEZvcndhcmRUcmVlVHJhdmVyc2FsSXRlcmF0b3JGYWN0b3J5PEV4dGVuZGVkRmlsdGVySXRlbT4oKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0ZXh0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFByaW50RmlsdGVySXRlbShmaWx0ZXJJdGVtOiBFeHRlbmRlZEZpbHRlckl0ZW0pOiBzdHJpbmcge1xyXG4gICAgICAgICAgICBsZXQgdHlwZSA9IFwiXCI7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoZmlsdGVySXRlbS5UeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLkZpbHRlclR5cGUuSW5jbHVkZWQ6XHJcbiAgICAgICAgICAgICAgICB0eXBlID0gdHlwZSArIFwiKEkpXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uRmlsdGVyVHlwZS5FeGNsdWRlZDpcclxuICAgICAgICAgICAgICAgIHR5cGUgPSB0eXBlICsgXCIoRSlcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJJdGVtLlVuaXF1ZU5hbWUgKyB0eXBlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIENyZWF0ZUl0ZW0oaWQ6IHN0cmluZywgcGFyZW50VW5pcXVlTmFtZTogc3RyaW5nLCBjaGlsZHJlbkNvdW50OiBudW1iZXIsZmlsdHJlZENoaWxkcmVuVG90YWxDb3VudDpudW1iZXIsIGxldmVsOiBudW1iZXIpOiBFeHRlbmRlZEZpbHRlckl0ZW0ge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEV4dGVuZGVkRmlsdGVySXRlbShpZCwgcGFyZW50VW5pcXVlTmFtZSwgY2hpbGRyZW5Db3VudCxmaWx0cmVkQ2hpbGRyZW5Ub3RhbENvdW50LCBsZXZlbCwgdGhpcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBHZXRSb290VHlwZSgpOiBDb250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uRmlsdGVyVHlwZSB7IHJldHVybiB0aGlzLl9yb290LlR5cGU7IH1cclxuICAgICAgICBcclxuICAgICAgICBVcGRhdGVGaWx0ZXJlZENoaWxkcmVuc1RvdGFsQ291bnQoZXhpc3RpbmdFbGVtZW50c0NoaWxkcmVuQ291bnRMb29rdXA6IElDaGlsZHJlbkNvdW50SW5mb0xvb2t1cCxub2Rlc1dpdGhVcGRhdGVkQ291bnQ6SU1lbWJlck5vZGVMb29rdXApIHtcclxuICAgICAgICAgICAgdmFyIG5vZGVXaXRoVXBkYXRlZENvdW50cyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbm9kZXNXaXRoVXBkYXRlZENvdW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZXNXaXRoVXBkYXRlZENvdW50Lmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZXNXaXRoVXBkYXRlZENvdW50Lmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLl9yb290LkFsbEl0ZW1zTG9va3VwW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLkZpbHRyZWRDaGlsZHJlblRvdGFsQ291bnQgPSBleGlzdGluZ0VsZW1lbnRzQ2hpbGRyZW5Db3VudExvb2t1cFtrZXldLkNoaWxkcmVuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlV2l0aFVwZGF0ZWRDb3VudHMucHVzaChpdGVtLlVuaXF1ZU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgJWNOT0RFIFdJVEggVVBEQVRFRCBDT1VOVFM6ICR7bm9kZVdpdGhVcGRhdGVkQ291bnRzfWAsICdiYWNrZ3JvdW5kOiAjMjIyOyBjb2xvcjogeWVsbG93Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgQ29udGFpbnModW5pcXVlTmFtZTogc3RyaW5nKTpib29sZWFuIHtcclxuICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5fcm9vdC5BbGxJdGVtc0xvb2t1cFt1bmlxdWVOYW1lXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBDbG9uZUJyYW5jaCh1bmlxdWVOYW1lOiBzdHJpbmcsd2l0aENoaWxkcmVuOmJvb2xlYW4pOkV4dGVuZGVkRmlsdGVySXRlbSB7XHJcbiAgICAgICAgICAgIGxldCBmaWx0ZXJJdGVtID0gdGhpcy5fcm9vdC5BbGxJdGVtc0xvb2t1cFt1bmlxdWVOYW1lXTtcclxuICAgICAgICAgICAgcmV0dXJuIGZpbHRlckl0ZW0uQ2xvbmUod2l0aENoaWxkcmVuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgSXNFbXB0eSgpOiBib29sZWFuIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuUm9vdC5DdXJyZW50Q2hpbGRyZW5Db3VudCA9PT0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgUmV2ZXJ0U2VsZWN0aW9uKCkge1xyXG4gICAgICAgICAgICB0aGlzLlJvb3QuUmV2ZXJ0U2VsZWN0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBSZWZyZXNoKCkge1xyXG4gICAgICAgICAgICB2YXIgdDAgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgICAgICAgICAgVHJlZUhlbHBlcnMuVHJhdmVyc2VQb3N0T3JkZXI8RXh0ZW5kZWRGaWx0ZXJJdGVtPih0aGlzLlJvb3QsXHJcbiAgICAgICAgICAgICAgICB4ID0+IHguQ2hpbGRyZW5BcnJheSxcclxuICAgICAgICAgICAgICAgIChjdXJyZW50LHBhcmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdGlvbk1vZGUgPSBjdXJyZW50LkdldFNlbGVjdGlvbk1vZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbk1vZGUgIT09IENvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyTW9kdWxlLkNvbW1vbi5TZWxlY3Rpb25Nb2RlLlVuZGV0ZXJtaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzU2VsZWN0ID0gc2VsZWN0aW9uTW9kZSA9PT0gQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLlNlbGVjdGlvbk1vZGUuU2VsZWN0ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LkNoYW5nZVRhcmdldFR5cGUoaXNTZWxlY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC5SZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQuUmVnaXN0ZXJPclVucmVnaXN0ZXJJblBhcmVudChpc1NlbGVjdCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB2YXIgdDEgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiQ2FsbCB0byBSZWZyZXNoIHRvb2sgXCIgKyAodDEgLSB0MCkgKyBcIiBtaWxsaXNlY29uZHMuXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuIl19