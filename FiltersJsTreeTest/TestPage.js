var TestPageModule;
(function (TestPageModule) {
    var FilterControl = Comarch.Controls.FilterControlModule.FilterControl;
    var AjaxHelper = AjaxHelperModule.AjaxHelper;
    var FilterControlControlViewFactory = Comarch.Controls.FilterControlModule.FilterControlControlViewFactory;
    var FilterStateManagerFactory = Comarch.Controls.FilterControlModule.FilterStateManagerModule.FilterStateManagerFactory;
    var FilterControlServiceMockFactory = Comarch.Controls.FilterControlModule.MockServiceModule.Service.FilterControlServiceMockFactory;
    var FilterControlServiceFactory = Comarch.Controls.FilterControlModule.FilterServiceModule.Service.FilterControlServiceFactory;
    class TestPage {
        constructor() {
            this._dataPackageSize = 2;
            this._maxTotalElementsCount = 40;
            this._currentWindow = 0;
            console.log("TestTree created.");
            this.Init();
            $("#packageSize").on("keyup change", () => {
                this._dataPackageSize = parseInt($("#packageSize").val());
                this.UpdateOptions();
            });
            $("#totalElementsCount").on("keyup change", () => {
                this._maxTotalElementsCount = parseInt($("#totalElementsCount").val());
                this.UpdateOptions();
            });
            $("#currentWindow").on("keyup change", () => {
                this._currentWindow = parseInt($("#currentWindow").val());
                this.UpdateOptions();
            });
            $("#changeConnection").click(() => this.Reload(false));
            $("#mockConnection").click(() => this.Reload(true));
            $("#loadState").click(this.OnLoadState.bind(this));
            $("#saveState").click(this.OnSaveState.bind(this));
            $("#disableLogs").click(this.OnDisableLogs.bind(this));
            $("#enableLogs").click(this.OnEnableLogs.bind(this));
        }
        get $JstreeContainer() {
            return $("#jstreeContainer");
        }
        get ConnectionString() {
            return $("#connectionStringTxt").val();
        }
        get FieldUniqueName() {
            return $("#fieldUniqueNameTxt").val();
        }
        async Init() {
            $("#packageSize").val(this._dataPackageSize);
            $("#totalElementsCount").val(this._maxTotalElementsCount);
            $("#currentWindow").val(this._currentWindow);
            this._filterControl = new FilterControl(this.GetOptions(), new FilterControlControlViewFactory(), this.GetServiceFactory(true), new FilterStateManagerFactory());
            this.Reload(true);
        }
        async Reload(mock) {
            this._isMock = mock;
            this._filterControl.ServiceFactory = this.GetServiceFactory(mock);
            this.UpdateOptions();
            await this._filterControl.Connect(this.ConnectionString, this.FieldUniqueName, this._state);
            console.log("FILTER CONTROL READY");
        }
        UpdateOptions() {
            this._filterControl.Options.Merge(this.GetOptions());
        }
        async OnLoadState() {
            const state = await AjaxHelper.GetData({ url: "api/State/Load" });
            const cleanedState = await AjaxHelper.GetData({ url: "api/State/LoadCleanedState" });
            this._state = JSON.parse(state);
            window["_fakeCleanedState"] = JSON.parse(cleanedState);
            console.log("LOADED STATE:", this._state);
            this.Reload(true);
        }
        async OnSaveState() {
            let cleanedStateInfo = {
                ExistingMembersHierarchyLookup: {}
            };
            if (this._isMock) {
                cleanedStateInfo = {
                    ExistingMembersHierarchyLookup: this._filterControl["_service"].AllMembersLookup
                };
            }
            const state = JSON.stringify(this._filterControl.GetState());
            const cleanState = JSON.stringify(cleanedStateInfo);
            await AjaxHelper.PostData({ url: "api/State/Save", data: { StateString: state, CleanedStateString: cleanState } });
            console.log("SAVED STATE:", state);
        }
        OnDisableLogs() {
            window["_orginalConsole"] = console;
            const newConsole = {};
            newConsole["log"] = function () { };
            newConsole["info"] = function () { window["_orginalConsole"].info(arguments); };
            console = newConsole;
        }
        OnEnableLogs() {
            console = window["_orginalConsole"];
        }
        GetServiceFactory(mock) {
            if (mock)
                return new FilterControlServiceMockFactory();
            return new FilterControlServiceFactory();
        }
        GetOptions() {
            return {
                $TargetContainer: $("#filterControlContainer"),
                Template: FilterControl.Template,
                Resources: FilterControl.Resources,
                DataPackageSize: this._dataPackageSize,
                MaxTotalElementsCount: this._maxTotalElementsCount,
                CurrentWindow: this._currentWindow
            };
        }
    }
    TestPageModule.TestPage = TestPage;
})(TestPageModule || (TestPageModule = {}));
var page = new TestPageModule.TestPage();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGVzdFBhZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJUZXN0UGFnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFVLGNBQWMsQ0EySXZCO0FBM0lELFdBQVUsY0FBYztJQUNwQixJQUFPLGFBQWEsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLGFBQWEsQ0FBQztJQUMxRSxJQUFPLFVBQVUsR0FBRyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7SUFFaEQsSUFBTywrQkFBK0IsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLCtCQUErQixDQUFDO0lBQzlHLElBQU8seUJBQXlCLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyx3QkFBd0IsQ0FBQyx5QkFBeUIsQ0FBQztJQUczSCxJQUFPLCtCQUErQixHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLCtCQUErQixDQUFDO0lBQ3hJLElBQU8sMkJBQTJCLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsMkJBQTJCLENBQUM7SUFPbEk7UUFvQkk7WUFoQlEscUJBQWdCLEdBQVMsQ0FBQyxDQUFDO1lBQzNCLDJCQUFzQixHQUFTLEVBQUUsQ0FBQztZQUNsQyxtQkFBYyxHQUFRLENBQUMsQ0FBQztZQWU1QixPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBR1osQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxjQUFjLEVBQUMsR0FBRyxFQUFFO2dCQUNyQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO2dCQUMxRCxJQUFJLENBQUMsYUFB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LFNBQVMsRUFBQyxhQUFhLENBQUMsU0FBUztnQkFDakMsZUFBZSxFQUFFLElBQUksQ0FBQyxnQkFBZ0I7Z0JBQ3RDLHFCQUFxQixFQUFFLElBQUksQ0FBQyxzQkFBc0I7Z0JBQ2xELGFBQWEsRUFBRSxJQUFJLENBQUMsY0FBYzthQUNyQyxDQUFDO1FBQ04sQ0FBQztLQUNKO0lBMUhZLHVCQUFRLFdBMEhwQixDQUFBO0FBQ0wsQ0FBQyxFQTNJUyxjQUFjLEtBQWQsY0FBYyxRQTJJdkI7QUFFRCxJQUFJLElBQUksR0FBRyxJQUFJLGNBQWMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIm5hbWVzcGFjZSBUZXN0UGFnZU1vZHVsZSB7XHJcbiAgICBpbXBvcnQgRmlsdGVyQ29udHJvbCA9IENvbWFyY2guQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJDb250cm9sO1xyXG4gICAgaW1wb3J0IEFqYXhIZWxwZXIgPSBBamF4SGVscGVyTW9kdWxlLkFqYXhIZWxwZXI7XHJcbiAgICBpbXBvcnQgSUNsZWFuZWRTdGF0ZUluZm8gPSBDb21hcmNoLkNvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuQ29tbW9uLklDbGVhbmVkU3RhdGVJbmZvO1xyXG4gICAgaW1wb3J0IEZpbHRlckNvbnRyb2xDb250cm9sVmlld0ZhY3RvcnkgPSBDb21hcmNoLkNvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyQ29udHJvbENvbnRyb2xWaWV3RmFjdG9yeTtcclxuICAgIGltcG9ydCBGaWx0ZXJTdGF0ZU1hbmFnZXJGYWN0b3J5ID0gQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJGYWN0b3J5O1xyXG4gICAgaW1wb3J0IElGaWx0ZXJJdGVtID0gQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclN0YXRlTWFuYWdlck1vZHVsZS5Db21tb24uSUZpbHRlckl0ZW07XHJcbiAgICBpbXBvcnQgTW9ja1NlcnZpY2UgPSBDb21hcmNoLkNvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuTW9ja1NlcnZpY2VNb2R1bGUuU2VydmljZS5Nb2NrU2VydmljZTtcclxuICAgIGltcG9ydCBGaWx0ZXJDb250cm9sU2VydmljZU1vY2tGYWN0b3J5ID0gQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLk1vY2tTZXJ2aWNlTW9kdWxlLlNlcnZpY2UuRmlsdGVyQ29udHJvbFNlcnZpY2VNb2NrRmFjdG9yeTtcclxuICAgIGltcG9ydCBGaWx0ZXJDb250cm9sU2VydmljZUZhY3RvcnkgPSBDb21hcmNoLkNvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyU2VydmljZU1vZHVsZS5TZXJ2aWNlLkZpbHRlckNvbnRyb2xTZXJ2aWNlRmFjdG9yeTtcclxuXHJcbiAgICBpbnRlcmZhY2UgSVN0YXRlUmVxdWVzdCB7XHJcbiAgICAgICAgU3RhdGVTdHJpbmc6IHN0cmluZztcclxuICAgICAgICBDbGVhbmVkU3RhdGVTdHJpbmc6IHN0cmluZztcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgY2xhc3MgVGVzdFBhZ2Uge1xyXG4gICAgICAgIF9maWx0ZXJDb250cm9sOiBGaWx0ZXJDb250cm9sO1xyXG4gICAgICAgIF9zdGF0ZTogSUZpbHRlckl0ZW07XHJcbiAgICAgICAgX2lzTW9jazogYm9vbGVhbjtcclxuICAgICAgICBwcml2YXRlIF9kYXRhUGFja2FnZVNpemU6IG51bWJlcj0yO1xyXG4gICAgICAgIHByaXZhdGUgX21heFRvdGFsRWxlbWVudHNDb3VudDogbnVtYmVyPTQwO1xyXG4gICAgICAgIHByaXZhdGUgX2N1cnJlbnRXaW5kb3c6bnVtYmVyPTA7XHJcblxyXG4gICAgICAgIGdldCAkSnN0cmVlQ29udGFpbmVyKCk6IEpRdWVyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkKFwiI2pzdHJlZUNvbnRhaW5lclwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGdldCBDb25uZWN0aW9uU3RyaW5nKCk6IHN0cmluZyB7XHJcbiAgICAgICAgICAgIHJldHVybiAkKFwiI2Nvbm5lY3Rpb25TdHJpbmdUeHRcIikudmFsKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBnZXQgRmllbGRVbmlxdWVOYW1lKCk6IHN0cmluZyB7XHJcbiAgICAgICAgICAgIHJldHVybiAkKFwiI2ZpZWxkVW5pcXVlTmFtZVR4dFwiKS52YWwoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRlc3RUcmVlIGNyZWF0ZWQuXCIpO1xyXG4gICAgICAgICAgICB0aGlzLkluaXQoKTtcclxuXHJcblxyXG4gICAgICAgICAgICAkKFwiI3BhY2thZ2VTaXplXCIpLm9uKFwia2V5dXAgY2hhbmdlXCIsKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZGF0YVBhY2thZ2VTaXplID0gcGFyc2VJbnQoJChcIiNwYWNrYWdlU2l6ZVwiKS52YWwoKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLlVwZGF0ZU9wdGlvbnMoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICQoXCIjdG90YWxFbGVtZW50c0NvdW50XCIpLm9uKFwia2V5dXAgY2hhbmdlXCIsKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbWF4VG90YWxFbGVtZW50c0NvdW50ID0gcGFyc2VJbnQoJChcIiN0b3RhbEVsZW1lbnRzQ291bnRcIikudmFsKCkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVPcHRpb25zKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAkKFwiI2N1cnJlbnRXaW5kb3dcIikub24oXCJrZXl1cCBjaGFuZ2VcIiwoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50V2luZG93ID0gIHBhcnNlSW50KCQoXCIjY3VycmVudFdpbmRvd1wiKS52YWwoKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLlVwZGF0ZU9wdGlvbnMoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKFwiI2NoYW5nZUNvbm5lY3Rpb25cIikuY2xpY2soKCkgPT4gdGhpcy5SZWxvYWQoZmFsc2UpKTtcclxuICAgICAgICAgICAgJChcIiNtb2NrQ29ubmVjdGlvblwiKS5jbGljaygoKSA9PiB0aGlzLlJlbG9hZCh0cnVlKSk7XHJcbiAgICAgICAgICAgICQoXCIjbG9hZFN0YXRlXCIpLmNsaWNrKHRoaXMuT25Mb2FkU3RhdGUuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgICQoXCIjc2F2ZVN0YXRlXCIpLmNsaWNrKHRoaXMuT25TYXZlU3RhdGUuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgICQoXCIjZGlzYWJsZUxvZ3NcIikuY2xpY2sodGhpcy5PbkRpc2FibGVMb2dzLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICAkKFwiI2VuYWJsZUxvZ3NcIikuY2xpY2sodGhpcy5PbkVuYWJsZUxvZ3MuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhc3luYyBJbml0KCkge1xyXG4gICAgICAgICAgICQoXCIjcGFja2FnZVNpemVcIikudmFsKHRoaXMuX2RhdGFQYWNrYWdlU2l6ZSk7XHJcbiAgICAgICAgICAgICQoXCIjdG90YWxFbGVtZW50c0NvdW50XCIpLnZhbCh0aGlzLl9tYXhUb3RhbEVsZW1lbnRzQ291bnQpO1xyXG4gICAgICAgICAgICAkKFwiI2N1cnJlbnRXaW5kb3dcIikudmFsKHRoaXMuX2N1cnJlbnRXaW5kb3cpO1xyXG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJDb250cm9sID0gbmV3IEZpbHRlckNvbnRyb2wodGhpcy5HZXRPcHRpb25zKCksbmV3IEZpbHRlckNvbnRyb2xDb250cm9sVmlld0ZhY3RvcnkoKSwgdGhpcy5HZXRTZXJ2aWNlRmFjdG9yeSh0cnVlKSwgbmV3IEZpbHRlclN0YXRlTWFuYWdlckZhY3RvcnkoKSk7XHJcbiAgICAgICAgICAgIHRoaXMuUmVsb2FkKHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBhc3luYyBSZWxvYWQobW9jazogYm9vbGVhbikge1xyXG4gICAgICAgICAgICB0aGlzLl9pc01vY2sgPSBtb2NrO1xyXG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJDb250cm9sLlNlcnZpY2VGYWN0b3J5ID0gdGhpcy5HZXRTZXJ2aWNlRmFjdG9yeShtb2NrKTtcclxuICAgICAgICAgICAgdGhpcy5VcGRhdGVPcHRpb25zKCk7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2ZpbHRlckNvbnRyb2wuQ29ubmVjdCh0aGlzLkNvbm5lY3Rpb25TdHJpbmcsIHRoaXMuRmllbGRVbmlxdWVOYW1lLCB0aGlzLl9zdGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRklMVEVSIENPTlRST0wgUkVBRFlcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIFVwZGF0ZU9wdGlvbnMoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2ZpbHRlckNvbnRyb2wuT3B0aW9ucy5NZXJnZSh0aGlzLkdldE9wdGlvbnMoKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGFzeW5jIE9uTG9hZFN0YXRlKCkge1xyXG4gICAgICAgICAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IEFqYXhIZWxwZXIuR2V0RGF0YTxzdHJpbmc+KHsgdXJsOiBcImFwaS9TdGF0ZS9Mb2FkXCIgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNsZWFuZWRTdGF0ZSA9IGF3YWl0IEFqYXhIZWxwZXIuR2V0RGF0YTxzdHJpbmc+KHsgdXJsOiBcImFwaS9TdGF0ZS9Mb2FkQ2xlYW5lZFN0YXRlXCIgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlID0gSlNPTi5wYXJzZShzdGF0ZSBhcyBhbnkpO1xyXG4gICAgICAgICAgICB3aW5kb3dbXCJfZmFrZUNsZWFuZWRTdGF0ZVwiXSA9IEpTT04ucGFyc2UoY2xlYW5lZFN0YXRlIGFzIGFueSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTE9BREVEIFNUQVRFOlwiLCB0aGlzLl9zdGF0ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuUmVsb2FkKHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBhc3luYyBPblNhdmVTdGF0ZSgpIHtcclxuICAgICAgICAgICAgbGV0IGNsZWFuZWRTdGF0ZUluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICBFeGlzdGluZ01lbWJlcnNIaWVyYXJjaHlMb29rdXA6IHt9XHJcbiAgICAgICAgICAgIH0gYXMgSUNsZWFuZWRTdGF0ZUluZm87XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5faXNNb2NrKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhbmVkU3RhdGVJbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIEV4aXN0aW5nTWVtYmVyc0hpZXJhcmNoeUxvb2t1cDogKHRoaXMuX2ZpbHRlckNvbnRyb2xbXCJfc2VydmljZVwiXSBhcyBNb2NrU2VydmljZSkuQWxsTWVtYmVyc0xvb2t1cFxyXG4gICAgICAgICAgICAgICAgfSBhcyBJQ2xlYW5lZFN0YXRlSW5mbztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSBKU09OLnN0cmluZ2lmeSh0aGlzLl9maWx0ZXJDb250cm9sLkdldFN0YXRlKCkpO1xyXG4gICAgICAgICAgICBjb25zdCBjbGVhblN0YXRlID0gSlNPTi5zdHJpbmdpZnkoY2xlYW5lZFN0YXRlSW5mbyk7XHJcblxyXG4gICAgICAgICAgICBhd2FpdCBBamF4SGVscGVyLlBvc3REYXRhKHsgdXJsOiBcImFwaS9TdGF0ZS9TYXZlXCIsIGRhdGE6IHsgU3RhdGVTdHJpbmc6IHN0YXRlLCBDbGVhbmVkU3RhdGVTdHJpbmc6IGNsZWFuU3RhdGUgfSBhcyBJU3RhdGVSZXF1ZXN0IH0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNBVkVEIFNUQVRFOlwiLCBzdGF0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBPbkRpc2FibGVMb2dzKCkge1xyXG4gICAgICAgICAgICB3aW5kb3dbXCJfb3JnaW5hbENvbnNvbGVcIl0gPSBjb25zb2xlO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbmV3Q29uc29sZSA9IHt9O1xyXG4gICAgICAgICAgICBuZXdDb25zb2xlW1wibG9nXCJdID0gZnVuY3Rpb24oKSB7fTtcclxuICAgICAgICAgICAgbmV3Q29uc29sZVtcImluZm9cIl0gPSBmdW5jdGlvbigpIHsgd2luZG93W1wiX29yZ2luYWxDb25zb2xlXCJdLmluZm8oYXJndW1lbnRzKSB9O1xyXG5cclxuICAgICAgICAgICAgY29uc29sZSA9IG5ld0NvbnNvbGUgYXMgYW55O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgT25FbmFibGVMb2dzKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlID0gd2luZG93W1wiX29yZ2luYWxDb25zb2xlXCJdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgR2V0U2VydmljZUZhY3RvcnkobW9jazogYm9vbGVhbik6IENvbWFyY2guQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5Db21tb24uSUZpbHRlckNvbnRyb2xTZXJ2aWNlRmFjdG9yeSB7XHJcbiAgICAgICAgICAgIGlmIChtb2NrKSByZXR1cm4gbmV3IEZpbHRlckNvbnRyb2xTZXJ2aWNlTW9ja0ZhY3RvcnkoKTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWx0ZXJDb250cm9sU2VydmljZUZhY3RvcnkoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIEdldE9wdGlvbnMoKTogQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLklPcHRpb25zIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICRUYXJnZXRDb250YWluZXI6JChcIiNmaWx0ZXJDb250cm9sQ29udGFpbmVyXCIpLFxyXG4gICAgICAgICAgICAgICAgVGVtcGxhdGU6RmlsdGVyQ29udHJvbC5UZW1wbGF0ZSxcclxuICAgICAgICAgICAgICAgIFJlc291cmNlczpGaWx0ZXJDb250cm9sLlJlc291cmNlcyxcclxuICAgICAgICAgICAgICAgIERhdGFQYWNrYWdlU2l6ZTogdGhpcy5fZGF0YVBhY2thZ2VTaXplLFxyXG4gICAgICAgICAgICAgICAgTWF4VG90YWxFbGVtZW50c0NvdW50OiB0aGlzLl9tYXhUb3RhbEVsZW1lbnRzQ291bnQsXHJcbiAgICAgICAgICAgICAgICBDdXJyZW50V2luZG93OiB0aGlzLl9jdXJyZW50V2luZG93XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG52YXIgcGFnZSA9IG5ldyBUZXN0UGFnZU1vZHVsZS5UZXN0UGFnZSgpOyJdfQ==