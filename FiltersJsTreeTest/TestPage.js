var TestPageModule;
(function (TestPageModule) {
    var FilterControl = Comarch.Controls.FilterControlModule.FilterControl;
    var AjaxHelper = AjaxHelperModule.AjaxHelper;
    var FilterControlControlViewFactory = Comarch.Controls.FilterControlModule.FilterControlControlViewFactory;
    var FilterStateManagerFactory = Comarch.Controls.FilterControlModule.FilterStateManagerModule.FilterStateManagerFactory;
    var FilterControlServiceMockFactory = Comarch.Controls.FilterControlModule.MockServiceModule.Service.FilterControlServiceMockFactory;
    var FilterControlServiceFactory = Comarch.Controls.FilterControlModule.FilterServiceModule.Service.FilterControlServiceFactory;
    class TestPage {
        constructor() {
            this._dataPackageSize = 2;
            this._maxTotalElementsCount = 40;
            this._currentWindow = 0;
            console.log("TestTree created.");
            this.Init();
            $("#packageSize").on("keyup change", () => {
                this._dataPackageSize = parseInt($("#packageSize").val());
                this.UpdateOptions();
            });
            $("#totalElementsCount").on("keyup change", () => {
                this._maxTotalElementsCount = parseInt($("#totalElementsCount").val());
                this.UpdateOptions();
            });
            $("#currentWindow").on("keyup change", () => {
                this._currentWindow = parseInt($("#currentWindow").val());
                this.UpdateOptions();
            });
            $("#changeConnection").click(() => this.Reload(false));
            $("#mockConnection").click(() => this.Reload(true));
            $("#loadState").click(this.OnLoadState.bind(this));
            $("#saveState").click(this.OnSaveState.bind(this));
            $("#disableLogs").click(this.OnDisableLogs.bind(this));
            $("#enableLogs").click(this.OnEnableLogs.bind(this));
        }
        get $JstreeContainer() {
            return $("#jstreeContainer");
        }
        get ConnectionString() {
            return $("#connectionStringTxt").val();
        }
        get FieldUniqueName() {
            return $("#fieldUniqueNameTxt").val();
        }
        async Init() {
            $("#packageSize").val(this._dataPackageSize);
            $("#totalElementsCount").val(this._maxTotalElementsCount);
            $("#currentWindow").val(this._currentWindow);
            this._filterControl = new FilterControl(this.GetOptions(), new FilterControlControlViewFactory(), this.GetServiceFactory(true), new FilterStateManagerFactory());
            this.Reload(true);
        }
        async Reload(mock) {
            this._isMock = mock;
            this._filterControl.ServiceFactory = this.GetServiceFactory(mock);
            this.UpdateOptions();
            await this._filterControl.Connect(this.ConnectionString, this.FieldUniqueName, this._state);
            console.log("FILTER CONTROL READY");
        }
        UpdateOptions() {
            this._filterControl.Options.Merge(this.GetOptions());
        }
        async OnLoadState() {
            const state = await AjaxHelper.GetData({ url: "api/State/Load" });
            const cleanedState = await AjaxHelper.GetData({ url: "api/State/LoadCleanedState" });
            this._state = JSON.parse(state);
            window["_fakeCleanedState"] = JSON.parse(cleanedState);
            console.log("LOADED STATE:", this._state);
            this.Reload(true);
        }
        async OnSaveState() {
            let cleanedStateInfo = {
                ExistingMembersHierarchyLookup: {}
            };
            if (this._isMock) {
                cleanedStateInfo = {
                    ExistingMembersHierarchyLookup: this._filterControl["_service"].AllMembersLookup
                };
            }
            const state = JSON.stringify(this._filterControl.GetState());
            const cleanState = JSON.stringify(cleanedStateInfo);
            await AjaxHelper.PostData({ url: "api/State/Save", data: { StateString: state, CleanedStateString: cleanState } });
            console.log("SAVED STATE:", state);
        }
        OnDisableLogs() {
            window["_orginalConsole"] = console;
            const newConsole = {};
            newConsole["log"] = function () { };
            newConsole["info"] = function () { window["_orginalConsole"].info(arguments); };
            console = newConsole;
        }
        OnEnableLogs() {
            console = window["_orginalConsole"];
        }
        GetServiceFactory(mock) {
            if (mock)
                return new FilterControlServiceMockFactory();
            return new FilterControlServiceFactory();
        }
        GetOptions() {
            return {
                $TargetContainer: $("#filterControlContainer"),
                Template: FilterControl.Template,
                Resources: FilterControl.Resources,
                DataPackageSize: this._dataPackageSize,
                MaxTotalElementsCount: this._maxTotalElementsCount,
                CurrentWindow: this._currentWindow
            };
        }
    }
    TestPageModule.TestPage = TestPage;
})(TestPageModule || (TestPageModule = {}));
var page = new TestPageModule.TestPage();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGVzdFBhZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJUZXN0UGFnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFVLGNBQWMsQ0EySXZCO0FBM0lELFdBQVUsY0FBYztJQUNwQixJQUFPLGFBQWEsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLGFBQWEsQ0FBQztJQUMxRSxJQUFPLFVBQVUsR0FBRyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7SUFFaEQsSUFBTywrQkFBK0IsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLCtCQUErQixDQUFDO0lBQzlHLElBQU8seUJBQXlCLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyx3QkFBd0IsQ0FBQyx5QkFBeUIsQ0FBQztJQUczSCxJQUFPLCtCQUErQixHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLCtCQUErQixDQUFDO0lBQ3hJLElBQU8sMkJBQTJCLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsMkJBQTJCLENBQUM7SUFPbEk7UUFvQkk7WUFoQlEscUJBQWdCLEdBQVMsQ0FBQyxDQUFDO1lBQzNCLDJCQUFzQixHQUFTLEVBQUUsQ0FBQztZQUNsQyxtQkFBYyxHQUFRLENBQUMsQ0FBQztZQWU1QixPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBR1osQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxjQUFjLEVBQUMsR0FBRyxFQUFFO2dCQUNyQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO2dCQUMxRCxJQUFJLENBQUMsYUFB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QUFnQixFQUFDLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQztnQkFDN0MsUUFBUSxFQUFDLGFBQWEsQ0FBQyxRQUFRO2dCQUMvQixTQUFTLEVBQUMsYUFBYSxDQUFDLFNBQVM7Z0JBQ2pDLGVBQWUsRUFBRSxJQUFJLENBQUMsZ0JBQWdCO2dCQUN0QyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsc0JBQXNCO2dCQUNsRCxhQUFhLEVBQUUsSUFBSSxDQUFDLGNBQWM7YUFDckMsQ0FBQztRQUNOLENBQUM7S0FDSjtJQTFIWSx1QkFBUSxXQTBIcEIsQ0FBQTtBQUNMLENBQUMsRUEzSVMsY0FBYyxLQUFkLGNBQWMsUUEySXZCO0FBRUQsSUFBSSxJQUFJLEdBQUcsSUFBSSxjQUFjLENBQUMsUUFBUSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJuYW1lc3BhY2UgVGVzdFBhZ2VNb2R1bGUge1xyXG4gICAgaW1wb3J0IEZpbHRlckNvbnRyb2wgPSBDb21hcmNoLkNvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuRmlsdGVyQ29udHJvbDtcclxuICAgIGltcG9ydCBBamF4SGVscGVyID0gQWpheEhlbHBlck1vZHVsZS5BamF4SGVscGVyO1xyXG4gICAgaW1wb3J0IElDbGVhbmVkU3RhdGVJbmZvID0gQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkNvbW1vbi5JQ2xlYW5lZFN0YXRlSW5mbztcclxuICAgIGltcG9ydCBGaWx0ZXJDb250cm9sQ29udHJvbFZpZXdGYWN0b3J5ID0gQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlckNvbnRyb2xDb250cm9sVmlld0ZhY3Rvcnk7XHJcbiAgICBpbXBvcnQgRmlsdGVyU3RhdGVNYW5hZ2VyRmFjdG9yeSA9IENvbWFyY2guQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuRmlsdGVyU3RhdGVNYW5hZ2VyRmFjdG9yeTtcclxuICAgIGltcG9ydCBJRmlsdGVySXRlbSA9IENvbWFyY2guQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5GaWx0ZXJTdGF0ZU1hbmFnZXJNb2R1bGUuQ29tbW9uLklGaWx0ZXJJdGVtO1xyXG4gICAgaW1wb3J0IE1vY2tTZXJ2aWNlID0gQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLk1vY2tTZXJ2aWNlTW9kdWxlLlNlcnZpY2UuTW9ja1NlcnZpY2U7XHJcbiAgICBpbXBvcnQgRmlsdGVyQ29udHJvbFNlcnZpY2VNb2NrRmFjdG9yeSA9IENvbWFyY2guQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5Nb2NrU2VydmljZU1vZHVsZS5TZXJ2aWNlLkZpbHRlckNvbnRyb2xTZXJ2aWNlTW9ja0ZhY3Rvcnk7XHJcbiAgICBpbXBvcnQgRmlsdGVyQ29udHJvbFNlcnZpY2VGYWN0b3J5ID0gQ29tYXJjaC5Db250cm9scy5GaWx0ZXJDb250cm9sTW9kdWxlLkZpbHRlclNlcnZpY2VNb2R1bGUuU2VydmljZS5GaWx0ZXJDb250cm9sU2VydmljZUZhY3Rvcnk7XHJcblxyXG4gICAgaW50ZXJmYWNlIElTdGF0ZVJlcXVlc3Qge1xyXG4gICAgICAgIFN0YXRlU3RyaW5nOiBzdHJpbmc7XHJcbiAgICAgICAgQ2xlYW5lZFN0YXRlU3RyaW5nOiBzdHJpbmc7XHJcbiAgICB9XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIFRlc3RQYWdlIHtcclxuICAgICAgICBfZmlsdGVyQ29udHJvbDogRmlsdGVyQ29udHJvbDtcclxuICAgICAgICBfc3RhdGU6IElGaWx0ZXJJdGVtO1xyXG4gICAgICAgIF9pc01vY2s6IGJvb2xlYW47XHJcbiAgICAgICAgcHJpdmF0ZSBfZGF0YVBhY2thZ2VTaXplOiBudW1iZXI9MjtcclxuICAgICAgICBwcml2YXRlIF9tYXhUb3RhbEVsZW1lbnRzQ291bnQ6IG51bWJlcj00MDtcclxuICAgICAgICBwcml2YXRlIF9jdXJyZW50V2luZG93Om51bWJlcj0wO1xyXG5cclxuICAgICAgICBnZXQgJEpzdHJlZUNvbnRhaW5lcigpOiBKUXVlcnkge1xyXG4gICAgICAgICAgICByZXR1cm4gJChcIiNqc3RyZWVDb250YWluZXJcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBnZXQgQ29ubmVjdGlvblN0cmluZygpOiBzdHJpbmcge1xyXG4gICAgICAgICAgICByZXR1cm4gJChcIiNjb25uZWN0aW9uU3RyaW5nVHh0XCIpLnZhbCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0IEZpZWxkVW5pcXVlTmFtZSgpOiBzdHJpbmcge1xyXG4gICAgICAgICAgICByZXR1cm4gJChcIiNmaWVsZFVuaXF1ZU5hbWVUeHRcIikudmFsKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUZXN0VHJlZSBjcmVhdGVkLlwiKTtcclxuICAgICAgICAgICAgdGhpcy5Jbml0KCk7XHJcblxyXG5cclxuICAgICAgICAgICAgJChcIiNwYWNrYWdlU2l6ZVwiKS5vbihcImtleXVwIGNoYW5nZVwiLCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2RhdGFQYWNrYWdlU2l6ZSA9IHBhcnNlSW50KCQoXCIjcGFja2FnZVNpemVcIikudmFsKCkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVPcHRpb25zKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAkKFwiI3RvdGFsRWxlbWVudHNDb3VudFwiKS5vbihcImtleXVwIGNoYW5nZVwiLCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21heFRvdGFsRWxlbWVudHNDb3VudCA9IHBhcnNlSW50KCQoXCIjdG90YWxFbGVtZW50c0NvdW50XCIpLnZhbCgpKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuVXBkYXRlT3B0aW9ucygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgJChcIiNjdXJyZW50V2luZG93XCIpLm9uKFwia2V5dXAgY2hhbmdlXCIsKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFdpbmRvdyA9ICBwYXJzZUludCgkKFwiI2N1cnJlbnRXaW5kb3dcIikudmFsKCkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVPcHRpb25zKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChcIiNjaGFuZ2VDb25uZWN0aW9uXCIpLmNsaWNrKCgpID0+IHRoaXMuUmVsb2FkKGZhbHNlKSk7XHJcbiAgICAgICAgICAgICQoXCIjbW9ja0Nvbm5lY3Rpb25cIikuY2xpY2soKCkgPT4gdGhpcy5SZWxvYWQodHJ1ZSkpO1xyXG4gICAgICAgICAgICAkKFwiI2xvYWRTdGF0ZVwiKS5jbGljayh0aGlzLk9uTG9hZFN0YXRlLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICAkKFwiI3NhdmVTdGF0ZVwiKS5jbGljayh0aGlzLk9uU2F2ZVN0YXRlLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICAkKFwiI2Rpc2FibGVMb2dzXCIpLmNsaWNrKHRoaXMuT25EaXNhYmxlTG9ncy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgJChcIiNlbmFibGVMb2dzXCIpLmNsaWNrKHRoaXMuT25FbmFibGVMb2dzLmJpbmQodGhpcykpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYXN5bmMgSW5pdCgpIHtcclxuICAgICAgICAgICAkKFwiI3BhY2thZ2VTaXplXCIpLnZhbCh0aGlzLl9kYXRhUGFja2FnZVNpemUpO1xyXG4gICAgICAgICAgICAkKFwiI3RvdGFsRWxlbWVudHNDb3VudFwiKS52YWwodGhpcy5fbWF4VG90YWxFbGVtZW50c0NvdW50KTtcclxuICAgICAgICAgICAgJChcIiNjdXJyZW50V2luZG93XCIpLnZhbCh0aGlzLl9jdXJyZW50V2luZG93KTtcclxuICAgICAgICAgICAgdGhpcy5fZmlsdGVyQ29udHJvbCA9IG5ldyBGaWx0ZXJDb250cm9sKHRoaXMuR2V0T3B0aW9ucygpLG5ldyBGaWx0ZXJDb250cm9sQ29udHJvbFZpZXdGYWN0b3J5KCksIHRoaXMuR2V0U2VydmljZUZhY3RvcnkodHJ1ZSksIG5ldyBGaWx0ZXJTdGF0ZU1hbmFnZXJGYWN0b3J5KCkpO1xyXG4gICAgICAgICAgICB0aGlzLlJlbG9hZCh0cnVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgYXN5bmMgUmVsb2FkKG1vY2s6IGJvb2xlYW4pIHtcclxuICAgICAgICAgICAgdGhpcy5faXNNb2NrID0gbW9jaztcclxuICAgICAgICAgICAgdGhpcy5fZmlsdGVyQ29udHJvbC5TZXJ2aWNlRmFjdG9yeSA9IHRoaXMuR2V0U2VydmljZUZhY3RvcnkobW9jayk7XHJcbiAgICAgICAgICAgIHRoaXMuVXBkYXRlT3B0aW9ucygpO1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9maWx0ZXJDb250cm9sLkNvbm5lY3QodGhpcy5Db25uZWN0aW9uU3RyaW5nLCB0aGlzLkZpZWxkVW5pcXVlTmFtZSwgdGhpcy5fc3RhdGUpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkZJTFRFUiBDT05UUk9MIFJFQURZXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBVcGRhdGVPcHRpb25zKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9maWx0ZXJDb250cm9sLk9wdGlvbnMuTWVyZ2UodGhpcy5HZXRPcHRpb25zKCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBhc3luYyBPbkxvYWRTdGF0ZSgpIHtcclxuICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSBhd2FpdCBBamF4SGVscGVyLkdldERhdGE8c3RyaW5nPih7IHVybDogXCJhcGkvU3RhdGUvTG9hZFwiIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBjbGVhbmVkU3RhdGUgPSBhd2FpdCBBamF4SGVscGVyLkdldERhdGE8c3RyaW5nPih7IHVybDogXCJhcGkvU3RhdGUvTG9hZENsZWFuZWRTdGF0ZVwiIH0pO1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZSA9IEpTT04ucGFyc2Uoc3RhdGUgYXMgYW55KTtcclxuICAgICAgICAgICAgd2luZG93W1wiX2Zha2VDbGVhbmVkU3RhdGVcIl0gPSBKU09OLnBhcnNlKGNsZWFuZWRTdGF0ZSBhcyBhbnkpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkxPQURFRCBTVEFURTpcIiwgdGhpcy5fc3RhdGUpO1xyXG4gICAgICAgICAgICB0aGlzLlJlbG9hZCh0cnVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgYXN5bmMgT25TYXZlU3RhdGUoKSB7XHJcbiAgICAgICAgICAgIGxldCBjbGVhbmVkU3RhdGVJbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgRXhpc3RpbmdNZW1iZXJzSGllcmFyY2h5TG9va3VwOiB7fVxyXG4gICAgICAgICAgICB9IGFzIElDbGVhbmVkU3RhdGVJbmZvO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX2lzTW9jaykge1xyXG4gICAgICAgICAgICAgICAgY2xlYW5lZFN0YXRlSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICBFeGlzdGluZ01lbWJlcnNIaWVyYXJjaHlMb29rdXA6ICh0aGlzLl9maWx0ZXJDb250cm9sW1wiX3NlcnZpY2VcIl0gYXMgTW9ja1NlcnZpY2UpLkFsbE1lbWJlcnNMb29rdXBcclxuICAgICAgICAgICAgICAgIH0gYXMgSUNsZWFuZWRTdGF0ZUluZm87XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gSlNPTi5zdHJpbmdpZnkodGhpcy5fZmlsdGVyQ29udHJvbC5HZXRTdGF0ZSgpKTtcclxuICAgICAgICAgICAgY29uc3QgY2xlYW5TdGF0ZSA9IEpTT04uc3RyaW5naWZ5KGNsZWFuZWRTdGF0ZUluZm8pO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgQWpheEhlbHBlci5Qb3N0RGF0YSh7IHVybDogXCJhcGkvU3RhdGUvU2F2ZVwiLCBkYXRhOiB7IFN0YXRlU3RyaW5nOiBzdGF0ZSwgQ2xlYW5lZFN0YXRlU3RyaW5nOiBjbGVhblN0YXRlIH0gYXMgSVN0YXRlUmVxdWVzdCB9KTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTQVZFRCBTVEFURTpcIiwgc3RhdGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgT25EaXNhYmxlTG9ncygpIHtcclxuICAgICAgICAgICAgd2luZG93W1wiX29yZ2luYWxDb25zb2xlXCJdID0gY29uc29sZTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG5ld0NvbnNvbGUgPSB7fTtcclxuICAgICAgICAgICAgbmV3Q29uc29sZVtcImxvZ1wiXSA9IGZ1bmN0aW9uKCkge307XHJcbiAgICAgICAgICAgIG5ld0NvbnNvbGVbXCJpbmZvXCJdID0gZnVuY3Rpb24oKSB7IHdpbmRvd1tcIl9vcmdpbmFsQ29uc29sZVwiXS5pbmZvKGFyZ3VtZW50cykgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUgPSBuZXdDb25zb2xlIGFzIGFueTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIE9uRW5hYmxlTG9ncygpIHtcclxuICAgICAgICAgICAgY29uc29sZSA9IHdpbmRvd1tcIl9vcmdpbmFsQ29uc29sZVwiXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIEdldFNlcnZpY2VGYWN0b3J5KG1vY2s6IGJvb2xlYW4pOiBDb21hcmNoLkNvbnRyb2xzLkZpbHRlckNvbnRyb2xNb2R1bGUuQ29tbW9uLklGaWx0ZXJDb250cm9sU2VydmljZUZhY3Rvcnkge1xyXG4gICAgICAgICAgICBpZiAobW9jaykgcmV0dXJuIG5ldyBGaWx0ZXJDb250cm9sU2VydmljZU1vY2tGYWN0b3J5KCk7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmlsdGVyQ29udHJvbFNlcnZpY2VGYWN0b3J5KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBHZXRPcHRpb25zKCk6IENvbWFyY2guQ29udHJvbHMuRmlsdGVyQ29udHJvbE1vZHVsZS5JT3B0aW9ucyB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAkVGFyZ2V0Q29udGFpbmVyOiQoXCIjZmlsdGVyQ29udHJvbENvbnRhaW5lclwiKSxcclxuICAgICAgICAgICAgICAgIFRlbXBsYXRlOkZpbHRlckNvbnRyb2wuVGVtcGxhdGUsXHJcbiAgICAgICAgICAgICAgICBSZXNvdXJjZXM6RmlsdGVyQ29udHJvbC5SZXNvdXJjZXMsXHJcbiAgICAgICAgICAgICAgICBEYXRhUGFja2FnZVNpemU6IHRoaXMuX2RhdGFQYWNrYWdlU2l6ZSxcclxuICAgICAgICAgICAgICAgIE1heFRvdGFsRWxlbWVudHNDb3VudDogdGhpcy5fbWF4VG90YWxFbGVtZW50c0NvdW50LFxyXG4gICAgICAgICAgICAgICAgQ3VycmVudFdpbmRvdzogdGhpcy5fY3VycmVudFdpbmRvd1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxudmFyIHBhZ2UgPSBuZXcgVGVzdFBhZ2VNb2R1bGUuVGVzdFBhZ2UoKTsiXX0=